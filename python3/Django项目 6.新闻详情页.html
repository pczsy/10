<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Django项目 6.新闻详情页' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Django项目 6.新闻详情页</center></div><div class='banquan'>原文出处:本文由博客园博主Tmclri提供。<br/>
原文连接:https://www.cnblogs.com/Tmclri/p/11552702.html</div><br>
    <h2 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">一、功能需求分析</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.功能</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">新闻详情</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">加载评论功能</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">添加评论功能</span></p>
</li>
</ol>
<h2 class="md-end-block md-heading"><span class="md-plain">二、新闻详情页</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.业务流程分析</span></h4>
<p class="md-end-block md-p"><span class="md-plain">业务流程：</span></p>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断前端传递新闻id是否为空，是否为整数，是否存在</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">2.接口设计</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">GET</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/news/&lt;int:news_id&gt;/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">url路径参数</span></span></td>
</tr>
</tbody>
</table>
<ol class="ol-list" start="2">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">参数说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">参数名</span></span></th><th><span class="td-span"><span class="md-plain">类型</span></span></th><th><span class="td-span"><span class="md-plain">是否必须</span></span></th><th><span class="td-span"><span class="md-plain">描述</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">news_id</span></span></td>
<td><span class="td-span"><span class="md-plain">整数</span></span></td>
<td><span class="td-span"><span class="md-plain">是</span></span></td>
<td><span class="td-span"><span class="md-plain">新闻id</span></span></td>
</tr>
</tbody>
</table>
<ol class="ol-list" start="3">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">返回结果：</span></p>
<p class="md-end-block md-p"><span class="md-plain">html页面，直接通过模板渲染的方式实现</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">3.后端代码</span></h4>
<p class="md-end-block md-p"><span class="md-plain">视图</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/views.py中定义如下视图</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> NewDetailView(View):
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> get(self, request, news_id):
        news </span>= News.objects.select_related(<span style="color: #800000;">'</span><span style="color: #800000;">tag</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">author</span><span style="color: #800000;">'</span><span style="color: #000000;">).only(
            </span><span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">content</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">tag__name</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">author__username</span><span style="color: #800000;">'</span><span style="color: #000000;">).filter(
            is_delete</span>=False, id=<span style="color: #000000;">news_id).first()
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> news:
            </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">news/news_detail.html</span><span style="color: #800000;">'</span>, context=<span style="color: #000000;">{
                </span><span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span><span style="color: #000000;">: news,
            })
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> HttpResponseNotFound(<span style="color: #800000;">'</span><span style="color: #800000;">&lt;h1&gt;Page not found&lt;/h1&gt;</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 快捷方式</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 1. 去数据库获取新闻数据</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> news_queryset = News.objects.select_related('tag', 'author').only('title', 'content', 'update_time', 'tag__name', 'author__username')</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> news = get_object_or_404(news_queryset, is_delete=False, id=news_id)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> 2. 返回渲染页面</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> return render(request, 'news/news_detail.html', context={'news': news})</span></pre>
</div>
<p>路由</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/urls.py中定义如下路由</span>
<span style="color: #000000;">
urlpatterns </span>=<span style="color: #000000;"> [
</span><span style="color: #008000;">#</span><span style="color: #008000;">....</span>
    path(<span style="color: #800000;">'</span><span style="color: #800000;">news/&lt;int:news_id&gt;/</span><span style="color: #800000;">'</span>, views.NewDetailView.as_view(), name=<span style="color: #800000;">'</span><span style="color: #800000;">news_detail</span><span style="color: #800000;">'</span><span style="color: #000000;">)
]</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">4.前端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain md-expand">html</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> templates/news/news_detail.html </span><span style="color: #008000;">--&gt;</span><span style="color: #000000;">
{% extends 'base/base.html' %}
{% load static %}
{% block title %}文章详情{% endblock %}
{% block link %}
 </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="{% static 'css/news/news-detail.css' %}"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
{% endblock %}

{% block main_contain %}
        </span><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news-contain start  </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-contain"</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h1 </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-title"</span><span style="color: #0000ff;">&gt;</span>{{ news.title }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-info"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-info-left"</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-author"</span><span style="color: #0000ff;">&gt;</span>{{ news.author.username }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-pub-time"</span><span style="color: #0000ff;">&gt;</span>{{ news.update_time }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-type"</span><span style="color: #0000ff;">&gt;</span>{{ news.tag.name }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-content"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
        {{ news.content|safe }}
      </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-contain"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub clearfix"</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="new-comment"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
            文章评论(</span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-count"</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">)
          </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control please-login-comment"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="display:none;"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请登录后参加评论"</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control logged-comment"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请填写评论"</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-btn"</span><span style="color: #0000ff;">&gt;</span>发表评论<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-list"</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-item"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-info clearfix"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">img </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../images/avatar.jpeg"</span><span style="color: #ff0000;"> alt</span><span style="color: #0000ff;">="avatar"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="comment-avatar"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-user"</span><span style="color: #0000ff;">&gt;</span>评论人<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub-time"</span><span style="color: #0000ff;">&gt;</span>1小时前<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-content"</span><span style="color: #0000ff;">&gt;</span>这是一条评论<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-item"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-info clearfix"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">img </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../images/avatar.jpeg"</span><span style="color: #ff0000;"> alt</span><span style="color: #0000ff;">="avatar"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="comment-avatar"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-user"</span><span style="color: #0000ff;">&gt;</span>评论人<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub-time"</span><span style="color: #0000ff;">&gt;</span>1小时前<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-content"</span><span style="color: #0000ff;">&gt;</span>这是一条评论<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news-contain end  </span><span style="color: #008000;">--&gt;</span><span style="color: #000000;">
{% endblock %}
{% block script %}
{% endblock %}</span></pre>
</div>
<p>css</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">/*</span><span style="color: #008000;"> 为文章内容添加样式 </span><span style="color: #008000;">*/</span>
<span style="color: #008000;">/*</span><span style="color: #008000;"> 在static/css/news/news-detail.css文件中需要添加如下内容：</span><span style="color: #008000;">*/</span><span style="color: #800000;">

.news-content p </span>{<span style="color: #ff0000;">
    font-size</span>:<span style="color: #0000ff;"> 16px</span>;<span style="color: #ff0000;">
    line-height</span>:<span style="color: #0000ff;"> 26px</span>;<span style="color: #ff0000;">
    text-align</span>:<span style="color: #0000ff;"> justify</span>;<span style="color: #ff0000;">
    word-wrap</span>:<span style="color: #0000ff;"> break-word</span>;<span style="color: #ff0000;">
    padding</span>:<span style="color: #0000ff;"> 3px 0
</span>}</pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain md-expand">三、加载新闻评论</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.接口设计</span></h4>
<p class="md-end-block md-p"><span class="md-plain">新闻详情页，直接渲染新闻评论</span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">2.后端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">模型代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 本项目设计二级评论，修改Comments模型，添加一个parent字段</span>
parent = models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">self</span><span style="color: #800000;">'</span>, on_delete=models.CASCADE, null=True)</pre>
</div>
<p class="md-end-block md-p"><span class="md-plain">修改模型后一定要及时迁移</span></p>
<p class="md-end-block md-p md-focus"><span class="md-plain md-expand">导入数据,文件见我的文件中的<a id="" href="https://files.cnblogs.com/files/Tmclri/sql%E6%95%B0%E6%8D%AE%E5%8C%85.rar">sql数据包.rar</a></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"># 导入测试数据tb_comments_20181222.sql
# 一定要保证tb_users中有id为1,</span><span style="color: #800080;">2</span><span style="color: #000000;">,3的三个用户，不然导入测试数据会报错
mysql </span>-u用户名 -p -D 数据库名&lt; tb_comments_20181222.sql</pre>
</div>
<p><span class="md-plain" style="color: #ff6600;">注意: 如果你想删除有外键关联的表是不能在navicat中用查询-新建查询的命令truncate table_name 来删除表中所有数据的,只能重新弄过</span></p>
<p>&nbsp;</p>
<p><span class="md-plain">视图代码<span style="color: #000000;"></span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 修改news/views.py中的NewsDetailView视图</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> NewDetailView(View):
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> get(self, request, news_id):
        news </span>= News.objects.select_related(<span style="color: #800000;">'</span><span style="color: #800000;">tag</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">author</span><span style="color: #800000;">'</span><span style="color: #000000;">).only(
            </span><span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">content</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">tag__name</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">author__username</span><span style="color: #800000;">'</span><span style="color: #000000;">).filter(
            is_delete</span>=False, id=<span style="color: #000000;">news_id).first()
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> news:
            comments </span>= Comments.objects.select_related(<span style="color: #800000;">'</span><span style="color: #800000;">author</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">parent</span><span style="color: #800000;">'</span><span style="color: #000000;">).only(
                </span><span style="color: #800000;">'</span><span style="color: #800000;">content</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">author__username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">parent__author__username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">parent__content</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">parent__update_time</span><span style="color: #800000;">'</span>).filter(is_delete=False, news_id=<span style="color: #000000;">news_id)
            </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">news/news_detail.html</span><span style="color: #800000;">'</span>, context=<span style="color: #000000;">{
                </span><span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span><span style="color: #000000;">: news,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">comments</span><span style="color: #800000;">'</span><span style="color: #000000;">: comments
            })
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> HttpResponseNotFound(<span style="color: #800000;">'</span><span style="color: #800000;">&lt;h1&gt;Page not found&lt;/h1&gt;</span><span style="color: #800000;">'</span>)</pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">3.前端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">css</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">/*</span><span style="color: #008000;"> 在static/css/news/news-detail.css中添加如下代码： </span><span style="color: #008000;">*/</span><span style="color: #800000;">
.comment-list .comment-item </span>{
  <span style="color: #008000;">/*</span><span style="color: #008000;">把这条样式注释掉</span><span style="color: #008000;">*/</span>
  <span style="color: #008000;">/*</span><span style="color: #008000;">border-bottom: 1px solid #ddd;</span><span style="color: #008000;">*/</span><span style="color: #ff0000;">
  margin-bottom</span>:<span style="color: #0000ff;"> 30px</span>;
}
<span style="color: #008000;">/*</span><span style="color: #008000;"> ========= 为父评论添加样式 start============ </span><span style="color: #008000;">*/</span><span style="color: #800000;">
.left_float</span>{<span style="color: #ff0000;">
    float</span>:<span style="color: #0000ff;">left</span>;
}<span style="color: #800000;">

.right_float</span>{<span style="color: #ff0000;">
    float</span>:<span style="color: #0000ff;">right</span>;
}<span style="color: #800000;">

.parent_comment_text</span>{<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;">698px</span>;<span style="color: #ff0000;">
    padding</span>:<span style="color: #0000ff;">8px</span>;<span style="color: #ff0000;">
    background</span>:<span style="color: #0000ff;"> #f4facf</span>;<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;">10px 0 0 60px</span>;
}<span style="color: #800000;">

.comment_time</span>{<span style="color: #ff0000;">
    font-size</span>:<span style="color: #0000ff;">12px</span>;<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;">#999</span>;<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;">10px 0 0 60px</span>;
}<span style="color: #800000;">

.parent_comment_text .parent_username</span>{<span style="color: #ff0000;">
    font-size</span>:<span style="color: #0000ff;">12px</span>;<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;">#000</span>;<span style="color: #ff0000;">
    display</span>:<span style="color: #0000ff;">inline-block</span>;
}<span style="color: #800000;">
.parent_comment_text .comment_time</span>{<span style="color: #ff0000;">
   display</span>:<span style="color: #0000ff;"> inline-block</span>;<span style="color: #ff0000;">
   float</span>:<span style="color: #0000ff;">right</span>;
}<span style="color: #800000;">

.parent_comment_text .parent_content_text</span>{<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;">#666</span>;<span style="color: #ff0000;">
    font-size</span>:<span style="color: #0000ff;">14px</span>;<span style="color: #ff0000;">
    margin-top</span>:<span style="color: #0000ff;"> 20px</span>;
}<span style="color: #800000;">

.reply_a_tag</span>{<span style="color: #ff0000;">
    font-size</span>:<span style="color: #0000ff;">12px</span>;<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;">#999</span>;<span style="color: #ff0000;">
    text-indent</span>:<span style="color: #0000ff;">20px</span>;<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;">10px 0 0 20px</span>;<span style="color: #ff0000;">
    background</span>:<span style="color: #0000ff;">url('/static/images/content_icon.png') left center no-repeat</span>;
}<span style="color: #800000;">

.reply_form</span>{<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;">718px</span>;<span style="color: #ff0000;">
    overflow</span>:<span style="color: #0000ff;">hidden</span>;<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;">10px 0 0 60px</span>;<span style="color: #ff0000;">
    display</span>:<span style="color: #0000ff;">none</span>;
}<span style="color: #800000;">

.reply_input</span>{<span style="color: #ff0000;">
    float</span>:<span style="color: #0000ff;">left</span>;<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;">692px</span>;<span style="color: #ff0000;">
    height</span>:<span style="color: #0000ff;">30px</span>;<span style="color: #ff0000;">
    border-radius</span>:<span style="color: #0000ff;">4px</span>;<span style="color: #ff0000;">
    padding</span>:<span style="color: #0000ff;">10px</span>;<span style="color: #ff0000;">
    outline</span>:<span style="color: #0000ff;">none</span>;<span style="color: #ff0000;">
    border</span>:<span style="color: #0000ff;">1px solid #2185ed</span>;
}<span style="color: #800000;">

.reply_btn,.reply_cancel</span>{<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;">40px</span>;<span style="color: #ff0000;">
    height</span>:<span style="color: #0000ff;">23px</span>;<span style="color: #ff0000;">
    background</span>:<span style="color: #0000ff;">#76b6f4</span>;<span style="color: #ff0000;">
    border</span>:<span style="color: #0000ff;">0px</span>;<span style="color: #ff0000;">
    border-radius</span>:<span style="color: #0000ff;">2px</span>;<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;">#fff</span>;<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;">10px 5px 0 10px</span>;<span style="color: #ff0000;">
    cursor</span>:<span style="color: #0000ff;">pointer</span>;
}<span style="color: #800000;">

.reply_cancel</span>{<span style="color: #ff0000;">
    background</span>:<span style="color: #0000ff;">#fff</span>;<span style="color: #ff0000;">
    color</span>:<span style="color: #0000ff;"> #909090</span>;
}
<span style="color: #008000;">/*</span><span style="color: #008000;"> ========= 为父评论添加样式 end============ </span><span style="color: #008000;">*/</span></pre>
</div>
<p>将content_icon.png图片放到static/images/中</p>
<p>&nbsp;</p>
<p>html</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 在templates/news/news_detail.html文件中class="comment-contain"里面加入如下代码： </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-contain"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub clearfix"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="new-comment"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                    文章评论(</span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-count"</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">)
                </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control please-login-comment"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="display:none;"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请登录后参加评论"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control logged-comment"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请填写评论"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-btn"</span><span style="color: #0000ff;">&gt;</span>发表评论<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-list"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% for comment in comments %}
                    </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-item"</span><span style="color: #0000ff;">&gt;</span>
                        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-info clearfix"</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">img </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="/static/images/avatar.jpeg"</span><span style="color: #ff0000;"> alt</span><span style="color: #0000ff;">="avatar"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="comment-avatar"</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-user"</span><span style="color: #0000ff;">&gt;</span>{{ comment.author.username }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub-time"</span><span style="color: #0000ff;">&gt;</span>{{ comment.update_time }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
                        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
                        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-content"</span><span style="color: #0000ff;">&gt;</span>{{ comment.content }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">

                        {% if comment.parent %}
                            </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="parent_comment_text"</span><span style="color: #0000ff;">&gt;</span>
                                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="parent_username"</span><span style="color: #0000ff;">&gt;</span>{{ comment.parent.author }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
                                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment_time"</span><span style="color: #0000ff;">&gt;</span>{{ comment.parent.update_time }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>

                                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="parent_content_text"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                                    {{ comment.parent.content }}
                                </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>

                            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                        {% endif %}

                        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:void(0);"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="reply_a_tag right_float"</span><span style="color: #0000ff;">&gt;</span>回复<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
                        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">form </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="reply_form left_float"</span><span style="color: #ff0000;"> comment-id</span><span style="color: #0000ff;">="{{ comment.id }}"</span><span style="color: #ff0000;">
                              news-id</span><span style="color: #0000ff;">="{{ comment.news_id }}"</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">textarea </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="reply_input"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">textarea</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="button"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="回复"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="reply_btn right_float"</span><span style="color: #0000ff;">&gt;</span>
                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="reset"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">=""</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="取消"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="reply_cancel right_float"</span><span style="color: #0000ff;">&gt;</span>
                        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">form</span><span style="color: #0000ff;">&gt;</span>

                    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% endfor comments %}

            </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>js代码</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 在static/js/news/news_detail.js中加入如下代码：</span>
<span style="color: #000000;">
$(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
  $(</span>'.comment-list').delegate('a,input', 'click', <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">获取回复按钮的class属性</span>
    let sClassValue = $(<span style="color: #0000ff;">this</span>).prop('class'<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 如果点击的是回复按钮，就显示输入框</span>
    <span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_a_tag') &gt;= 0<span style="color: #000000;">) {
      $(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">).next().toggle();
    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 如果点击的是取消按钮，就隐藏输入框</span>
    <span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_cancel') &gt;= 0<span style="color: #000000;">) {
      $(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">).parent().toggle();
    }

    </span><span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_btn') &gt;= 0<span style="color: #000000;">) {
      </span><span style="color: #008000;">//</span><span style="color: #008000;"> 评论</span>
<span style="color: #000000;">    }
  });
 
});</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain md-expand">四、添加新闻评论功能</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.业务流程分析</span></h4>
<p class="md-end-block md-p"><span class="md-plain">业务处理流程：</span></p>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断用户是否登录</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断前端传的新闻id是否为空，是否我整数，是否存在</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断评论内容是否为空</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断是否有父评论，父评论id是否与新闻id匹配</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">保存新闻评论</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">2.接口设计</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">POST</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/news/&lt;int:news_id&gt;/comment/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">url路径参数,表单参数</span></span></td>
</tr>
</tbody>
</table>
<ol class="ol-list" start="2">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">参数说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">参数名</span></span></th><th><span class="td-span"><span class="md-plain">类型</span></span></th><th><span class="td-span"><span class="md-plain">是否必须</span></span></th><th><span class="td-span"><span class="md-plain">描述</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">news_id</span></span></td>
<td><span class="td-span"><span class="md-plain">整数</span></span></td>
<td><span class="td-span"><span class="md-plain">是</span></span></td>
<td><span class="td-span"><span class="md-plain">新闻id</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">content</span></span></td>
<td><span class="td-span"><span class="md-plain">字符串</span></span></td>
<td><span class="td-span"><span class="md-plain">是</span></span></td>
<td><span class="td-span"><span class="md-plain">新闻评论内容</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">parent_id</span></span></td>
<td><span class="td-span"><span class="md-plain">整数</span></span></td>
<td><span class="td-span"><span class="md-plain">否</span></span></td>
<td><span class="td-span"><span class="md-plain">父评论id</span></span></td>
</tr>
</tbody>
</table>
<p class="md-end-block md-p"><span class="md-plain">注意：post请求需要携带csrftoken</span></p>
<ol class="ol-list" start="3">
<li class="md-list-item md-focus-container">
<p class="md-end-block md-p md-focus"><span class="md-plain">返回结果：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
    </span><span style="color: #800000;">"</span><span style="color: #800000;">errno</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">0</span><span style="color: #800000;">"</span><span style="color: #000000;">,
    </span><span style="color: #800000;">"</span><span style="color: #800000;">errmsg</span><span style="color: #800000;">"</span>: <span style="color: #800000;">""</span><span style="color: #000000;">,
    </span><span style="color: #800000;">"</span><span style="color: #800000;">data</span><span style="color: #800000;">"</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">"</span><span style="color: #800000;">news_id</span><span style="color: #800000;">"</span>: <span style="color: #800080;">1170</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">content_id</span><span style="color: #800000;">"</span>: <span style="color: #800080;">3569</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">content</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">评论比较中肯。</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">author</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">admin</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">update_time</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">2019年08月19日 16:00</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">parent</span><span style="color: #800000;">"</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">"</span><span style="color: #800000;">news_id</span><span style="color: #800000;">"</span>: <span style="color: #800080;">1170</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">content_id</span><span style="color: #800000;">"</span>: <span style="color: #800080;">893</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">content</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">行文思路简单肤浅，文章结构平面呆板。</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">author</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">xinlan</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">update_time</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">2018年12月21日 11:17</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">parent</span><span style="color: #800000;">"</span>: <span style="color: #0000ff;">null</span><span style="color: #000000;">
        }
    }
}</span></pre>
</div>
<p>&nbsp;</p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">3.后端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">视图代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/views.py中编写如下视图</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> NewsCommentView(View):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    添加评论视图
    url: /news/&lt;int:news_id&gt;/comment/
    </span><span style="color: #800000;">"""</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> post(self, request, news_id):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 是否登录</span>
        <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> request.user.is_authenticated:
            </span><span style="color: #0000ff;">return</span> json_response(errno=Code.SESSIONERR, errmsg=<span style="color: #000000;">error_map[Code.SESSIONERR])
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 新闻是否存在</span>
        <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span> News.objects.only(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>).filter(is_delete=False, id=<span style="color: #000000;">news_id).exists():
            </span><span style="color: #0000ff;">return</span> json_response(errno=Code.PARAMERR, errmsg=<span style="color: #800000;">'</span><span style="color: #800000;">新闻不存在！</span><span style="color: #800000;">'</span><span style="color: #000000;">)

        content </span>= request.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">content</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 内容是否为空</span>
        <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> content:
            </span><span style="color: #0000ff;">return</span> json_response(errno=Code.PARAMERR, errmsg=<span style="color: #800000;">'</span><span style="color: #800000;">评论内容不能为空！</span><span style="color: #800000;">'</span><span style="color: #000000;">)

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 父id是否正常</span>
        parent_id = request.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">parent_id</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> parent_id:
            </span><span style="color: #0000ff;">try</span><span style="color: #000000;">:
                parent_id </span>=<span style="color: #000000;"> int(parent_id)
                </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span> Comments.objects.only(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>).filter(is_delete=False, id=parent_id, news_id=<span style="color: #000000;">news_id).exists():
                    </span><span style="color: #0000ff;">return</span> json_response(errno=Code.PARAMERR, errmsg=<span style="color: #000000;">error_map[Code.PARAMERR])
            </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
                logger.info(</span><span style="color: #800000;">'</span><span style="color: #800000;">前端传递过来的parent_id异常\n{}</span><span style="color: #800000;">'</span><span style="color: #000000;">.format(e))
                </span><span style="color: #0000ff;">return</span> json_response(errno=Code.PARAMERR, errmsg=<span style="color: #800000;">'</span><span style="color: #800000;">未知异常</span><span style="color: #800000;">'</span><span style="color: #000000;">)

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 保存到数据库</span>
        new_comment =<span style="color: #000000;"> Comments()
        new_comment.content </span>=<span style="color: #000000;"> content
        new_comment.news_id </span>=<span style="color: #000000;"> news_id
        new_comment.author </span>=<span style="color: #000000;"> request.user
        new_comment.parent_id </span>= parent_id <span style="color: #0000ff;">if</span> parent_id <span style="color: #0000ff;">else</span><span style="color: #000000;"> None
        new_comment.save()

        </span><span style="color: #0000ff;">return</span> json_response(data=new_comment.to_dict_data())</pre>
</div>
<p>序列化comment对象(也就是在上面代码的结尾处用到的方法to_dict_data的书写), 这里我们只实现了2层评论关系,无法多个嵌套</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/models.py的Comment模型中添加如下方法，用来序列化</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> to_dict_data(self):
    comment_dict </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">news_id</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.news_id,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">content_id</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.id,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">content</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.content,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">author</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.author.username,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">update_time</span><span style="color: #800000;">'</span>: self.update_time.astimezone().strftime(<span style="color: #800000;">'</span><span style="color: #800000;">%Y年%m月%d日 %H:%M</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        </span><span style="color: #800000;">'</span><span style="color: #800000;">parent</span><span style="color: #800000;">'</span>: self.parent.to_dict_data() <span style="color: #0000ff;">if</span> self.parent <span style="color: #0000ff;">else</span><span style="color: #000000;"> None
    }
    </span><span style="color: #0000ff;">return</span> comment_dict</pre>
</div>
<p>路由</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/urls.py中添加如下路由</span>
path(<span style="color: #800000;">'</span><span style="color: #800000;">news/&lt;int:news_id&gt;/comment/</span><span style="color: #800000;">'</span>, views.NewsCommentView.as_view(), name=<span style="color: #800000;">'</span><span style="color: #800000;">news_comment</span><span style="color: #800000;">'</span>),</pre>
</div>
<h4 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">4.前端代码</span></h4>
<p class="md-end-block md-p"><span class="md-plain">html</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 修改templates/news/news_detail.html中评论部分代码如下 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news comment start </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-contain"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-pub clearfix"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="new-comment"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                    文章评论(</span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-count"</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">)
                </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% if user.is_authenticated %}

                </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control logged-comment"</span><span style="color: #ff0000;"> news-id</span><span style="color: #0000ff;">="{{ news.id }}"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请填写评论"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% else %}
                </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-control please-login-comment"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请登录后参加评论"</span><span style="color: #ff0000;"> readonly</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% endif %}
                </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="comment-btn"</span><span style="color: #0000ff;">&gt;</span>发表评论<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                {% csrf_token %}
            </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
           
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news comment end </span><span style="color: #008000;">--&gt;</span></pre>
</div>
<p>js代码</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 修改static/js/news/news_detail.js中的代码如下</span><span style="color: #008000;">
//</span><span style="color: #008000;"> 修改static/js/news/news_detail.js中的代码如下</span>
$(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 对评论进行评论</span>
    $('.comment-list').delegate('a,input', 'click', <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">获取回复按钮的class属性</span>
        let sClassValue = $(<span style="color: #0000ff;">this</span>).prop('class'<span style="color: #000000;">);
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 如果点击的是回复按钮，就显示输入框</span>
        <span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_a_tag') &gt;= 0<span style="color: #000000;">) {
            $(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">).next().toggle();
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 如果点击的是取消按钮，就隐藏输入框</span>
        <span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_cancel') &gt;= 0<span style="color: #000000;">) {
            $(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">).parent().toggle();
        }

        </span><span style="color: #0000ff;">if</span> (sClassValue.indexOf('reply_btn') &gt;= 0<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> 评论</span>
            let $<span style="color: #0000ff;">this</span> = $(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
            let news_id </span>= $<span style="color: #0000ff;">this</span>.parent().attr('news-id'<span style="color: #000000;">);
            let parent_id </span>= $<span style="color: #0000ff;">this</span>.parent().attr('comment-id'<span style="color: #000000;">);
            let content </span>= $<span style="color: #0000ff;">this</span><span style="color: #000000;">.prev().val();
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">content) {
                message.showError(</span>'请输入评论内容！'<span style="color: #000000;">);
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">
            }
            $
                .ajax({
                    url: </span>'/news/' + news_id + '/comment/'<span style="color: #000000;">,
                    type: </span>'POST'<span style="color: #000000;">,
                    data: {
                        content: content,
                        parent_id: parent_id
                    },
                    dataType: </span>"json"<span style="color: #000000;">
                })

                .done((res) </span>=&gt;<span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">if</span> (res.errno === '0'<span style="color: #000000;">) {
                        let comment </span>=<span style="color: #000000;"> res.data;
                        let html_comment </span>= `&lt;li class="comment-item"&gt;
            &lt;div class="comment-info clearfix"&gt;
              &lt;img src="/static/images/avatar.jpeg" alt="avatar" class="comment-avatar"&gt;
              &lt;span class="comment-user"&gt;${comment.author}&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class="comment-content"&gt;${comment.content}&lt;/div&gt;

                &lt;div class="parent_comment_text"&gt;
                  &lt;div class="parent_username"&gt;${comment.parent.author}&lt;/div&gt;
                  &lt;div class="comment_time"&gt;${comment.parent.update_time}&lt;/div&gt;
                  &lt;div class="parent_content_text"&gt;<span style="color: #000000;">
                    ${comment.parent.content}
                  </span>&lt;/div&gt;
                &lt;/div&gt;

              &lt;div class="comment_time left_float"&gt;${comment.update_time}&lt;/div&gt;
              &lt;a href="javascript:;" class="reply_a_tag right_float"&gt;回复&lt;/a&gt;
              &lt;form class="reply_form left_float" comment-id="${comment.content_id}" news-id="${comment.news_id}"&gt;
                &lt;textarea class="reply_input"&gt;&lt;/textarea&gt;
                &lt;input type="button" value="回复" class="reply_btn right_float"&gt;
                &lt;input type="reset" name="" value="取消" class="reply_cancel right_float"&gt;
              &lt;/form&gt;

          &lt;/li&gt;`;
                        message.showSuccess('评论成功！'<span style="color: #000000;">);
                        setTimeout(() </span>=&gt;<span style="color: #000000;"> {
                            $(</span>'.comment-list'<span style="color: #000000;">).prepend(html_comment);
                        }, </span>800<span style="color: #000000;">);

                        $</span><span style="color: #0000ff;">this</span>.prev().val('');   <span style="color: #008000;">//</span><span style="color: #008000;"> 清空输入框</span>
                        $<span style="color: #0000ff;">this</span>.parent().hide();  <span style="color: #008000;">//</span><span style="color: #008000;"> 关闭评论框</span>
                    } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (res.errno === '4101'<span style="color: #000000;">) {
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 用户未登录</span>
<span style="color: #000000;">                        message.showError(res.errmsg);
                        setTimeout(() </span>=&gt;<span style="color: #000000;"> {
                            window.location.href </span>= '/user/login/'<span style="color: #000000;">
                        }, </span>800<span style="color: #000000;">)
                    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 失败</span>
<span style="color: #000000;">                        message.showError(res.errmsg)
                    }
                })
                .fail(() </span>=&gt;<span style="color: #000000;"> {
                    message.showError(</span>'服务器超时，请重试'<span style="color: #000000;">)
                })
        }
    });
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 对新闻评论</span>
    let $newsComment = $('.logged-comment input');            <span style="color: #008000;">//</span><span style="color: #008000;"> 新闻评论框</span>
    let $sendComment = $('.comment-pub .comment-btn');           <span style="color: #008000;">//</span><span style="color: #008000;"> 新闻评论按钮</span>
<span style="color: #000000;">
    $sendComment.click(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

        let $</span><span style="color: #0000ff;">this</span> = $(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span> ($<span style="color: #0000ff;">this</span>.prev().hasClass('please-login-comment'<span style="color: #000000;">)) {
            message.showError(</span>'未登录，请登录后再评论！'<span style="color: #000000;">);
            setTimeout(() </span>=&gt;<span style="color: #000000;"> {
                window.location.href </span>= '/user/login/'<span style="color: #000000;">
            }, </span>800<span style="color: #000000;">);
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;">
        }
        let news_id </span>= $<span style="color: #0000ff;">this</span>.prev().attr('news-id'<span style="color: #000000;">);
        let content </span>=<span style="color: #000000;"> $newsComment.val();
        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">content) {
            message.showError(</span>'请输入评论内容！'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;">
        }
        $
            .ajax({
                url: </span>'/news/' + news_id + '/comment/'<span style="color: #000000;">,
                type: </span>'POST'<span style="color: #000000;">,
                data: {
                    content: content
                },
                dataType: </span>'json'<span style="color: #000000;">
            })
            .done((res) </span>=&gt;<span style="color: #000000;"> {
                </span><span style="color: #0000ff;">if</span> (res.errno === '0'<span style="color: #000000;">) {
                    let comment </span>=<span style="color: #000000;"> res.data;
                    let html_comment </span>= `&lt;li class="comment-item"&gt;
            &lt;div class="comment-info clearfix"&gt;
              &lt;img src="/static/images/avatar.jpeg" alt="avatar" class="comment-avatar"&gt;
              &lt;span class="comment-user"&gt;${comment.author}&lt;/span&gt;
              &lt;span class="comment-pub-time"&gt;${ comment.update_time }&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class="comment-content"&gt;${comment.content}&lt;/div&gt;

              &lt;a href="javascript:;" class="reply_a_tag right_float"&gt;回复&lt;/a&gt;
              &lt;form class="reply_form left_float" comment-id="${comment.content_id}" news-id="${comment.news_id}"&gt;
                &lt;textarea class="reply_input"&gt;&lt;/textarea&gt;
                &lt;input type="button" value="回复" class="reply_btn right_float"&gt;
                &lt;input type="reset" name="" value="取消" class="reply_cancel right_float"&gt;
              &lt;/form&gt;

          &lt;/li&gt;`;
                    message.showSuccess('评论成功！'<span style="color: #000000;">);
                    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
                        $(</span>".comment-list"<span style="color: #000000;">).prepend(html_comment);
                    }, </span>800<span style="color: #000000;">);

                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 清空</span>
                    $newsComment.val(''<span style="color: #000000;">);

                } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (res.errno === '4101'<span style="color: #000000;">) {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 用户未登录</span>
<span style="color: #000000;">                    message.showError(res.errmsg);
                    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
                        window.location.href </span>= '/user/login/'<span style="color: #000000;">
                    }, </span>800<span style="color: #000000;">)

                } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    message.showError(res.errmsg);
                }
            })

            .fail(() </span>=&gt;<span style="color: #000000;"> {
                message.showError(</span>'服务器超时，请重试！'<span style="color: #000000;">);
            })

    })


});</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>