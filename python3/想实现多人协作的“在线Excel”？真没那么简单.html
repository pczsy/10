<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修想实现多人协作的“在线Excel”？真没那么简单' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>想实现多人协作的“在线Excel”？真没那么简单</center></div><div class='banquan'>原文出处:本文由博客园博主葡萄城技术团队提供。<br/>
原文连接:https://www.cnblogs.com/powertoolsteam/p/onlineexcel.html</div><br>
    <blockquote>
<p>本文由葡萄城技术团队原创并首发</p>
<p>转载请注明出处：<a href="https://www.grapecity.com.cn/" target="_blank">葡萄城官网</a>，葡萄城为开发者提供专业的开发工具、解决方案和服务，赋能开发者。</p>
</blockquote>
<p>&nbsp;</p>
<p>Excel是我们办公中常用的工具 ，它几乎能为我们处理大部分数据，友好的交互界面、丰富的公式函数和易于上手的图表为我们在数据统计方面提供了不小的帮助，但经过一段时期运行，就会出现下面的情况：</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单0.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>这样多分枝的混乱状况就会难以保证文档的安全性及权威性。</p>
<p>于是聪明的小伙伴想到了一个解决方案，共享出一份Excel文档，根据人员的职级不同，设置仅可只读和编辑的权限，同时根据为不同人制定不同规则，例如：张某每天十点编辑，王某每天十一点编辑的方式来解决冲突的问题。这种方式很聪明，从流程上解决了多副本的问题，但不能同时编辑的问题依然没有被解决，如果一个部门的人足够多，这样分时的策略可能需要花一天时间才能完成一份Excel的编辑。</p>
<p>所以多人协作在线文档的需求也变得越发变得强烈，因为在日常工作中，与团队的其他人进行文档协作是一种再常见不过的工作方式。由于工作分工、工作进展的不同，团队内部的信息往往需要及时同步，然而伴随着团队经营规模的不断扩大，在线协同、多人协作，以及软件项目管理等问题将会接踵而至，成为制约企业高效发展的瓶颈。</p>
<p>而这些问题，通常表现为：</p>
<ol>
<li>跨部门、地区沟通协作的不便</li>
<li>过度依赖文件、文件夹共享的形式，不能确保文档的安全性</li>
<li>没法纪录和体现职工对文本文档的意见和评价</li>
<li>文档记录发生变更时，无法及时通知到相关部门和员工</li>
<li>文档无法在线协同编辑，缺失必要的流程管控</li>
<li>多人共同编辑一个文档，无法留存修改记录和历史版本</li>
</ol>
<p>&nbsp;</p>
<p>针对上述问题，现在在市面上，已经有了很多这类多人协作的工具，例如：国外的Google Docs、Office365，及国内的腾讯文档、石墨文档、有道云协作等。</p>
<p>因为这篇文章我们的目的是想向大家从企业IT管理者的角度出发深入研究协同办公系统的形式、基础和难点等实现原理，所以成品软件我们在这不做过多赘述。那我们正式开始吧。</p>
<h3>多人协作的形式：历史与发展</h3>
<p>多人协作的历史十分悠久，起源于静态的多人协作模式，即每个人先完成自己的工作，然后再进行汇总。</p>
<h4>多人协作的初期：静态协作</h4>
<ul>
<li>递增式协作
<ul>
<li>邮件：你来我往</li>
<li>论坛：跟帖回复</li>
</ul>
</li>
<li>独占式协作
<ul>
<li>文档传递</li>
<li>微软VSS</li>
</ul>
</li>
<li>合并式协作
<ul>
<li>SVN</li>
<li>Git</li>
<li>diff，patch，merge指令</li>
</ul>
</li>
</ul>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单1.png" alt="" /></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">常见的静态多人协作方式</p>
<h4>多人协作的发展期：从静态到动态</h4>
<ul>
<li>静态协作的比喻
<ul>
<li>拼接画</li>
<li>积木</li>
</ul>
</li>
<li>静态协作的特点
<ul>
<li>多版本</li>
<li>块操作</li>
<li>有协作动作</li>
</ul>
</li>
<li>静态协作的缺点
<ul>
<li>版本碎片化</li>
<li>缺乏时效性</li>
<li>协作动作成本高</li>
</ul>
</li>
</ul>
<p>静态多人协作的成本，会随着加入人数和项目的复杂度呈几何级数的增长。因此，对于企业来说，急需一种无协作动作、唯一版本、版本可控的无协作成本模式，即动态多人协作模式。</p>
<h4>多人协作的蓬勃期：动态</h4>
<ul>
<li>动态协作的比喻
<ul>
<li>一起画黑板</li>
</ul>
</li>
<li>动态协作的特点
<ul>
<li>唯一版本</li>
<li>原子操作</li>
<li>无协作动作</li>
</ul>
</li>
<li>动态协作的优点
<ul>
<li>版本可控</li>
<li>实时</li>
<li>无协作成本</li>
</ul>
</li>
<li>典型产品
<ul>
<li>Office Online</li>
<li>石墨</li>
<li>OnlyOffice</li>
</ul>
</li>
</ul>
<h3>多人协作的基础：原理与架构</h3>
<p>任何信息，无论其是什么展现形式，如果要做到多人实时编辑与展现，只需要实现以下三步而已：</p>
<ol start="1">
<li>操作化</li>
<li>可传输</li>
<li>可还原</li>
</ol>
<p style="text-align: center;"><img src="./images/想实现多人协作的“在线Excel”？真没那么简单2.png" alt="" width="671" height="183" /></p>
<p style="text-align: center;" align="center">举例说明多人协作的实现方式</p>
<h4>操作化</h4>
<p>操作化，指任何信息都可以转换为一组操作的集合。很容易理解，但它仍有不少值得思考的点：</p>
<ul>
<li>分割与组合
<ul>
<li>如何保证：信息的所有变化都可以分解为操作的集合？反之，操作如何覆盖出信息的所有变化？</li>
<li>分割的颗粒度如何决定？
<ul>
<li>粗一点？</li>
<li>细一点？</li>
<li>如何兼顾解释性与扩展性？</li>
</ul>
</li>
</ul>
</li>
<li>绝对操作与相对操作
<ul>
<li>绝对操作
<ul>
<li>针孔打印机的完美世界</li>
<li>打印机时代的编辑噩梦</li>
</ul>
</li>
<li>相对操作
<ul>
<li>4K电视不是梦</li>
<li>为什么数字电视稳定性不如模拟电视</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="2">
<ul>
<li>绝对操作与相对操作比喻：时间与空间的互换</li>
</ul>
</ol>
<h4>可传输</h4>
<p>可传输，就是指操作有办法通过网络传输给其他终端。实现动态多人协作，需要考虑以下几点：</p>
<ul>
<li>传输内容
<ul>
<li>原始文本
<ul>
<li>清晰</li>
<li>冗余</li>
</ul>
</li>
<li>压缩技术
<ul>
<li>逻辑压缩</li>
<li>协议压缩</li>
<li>手动压缩</li>
</ul>
</li>
</ul>
</li>
<li>网络协议
<ul>
<li>Socket
<ul>
<li>TCP</li>
<li>UDP</li>
</ul>
</li>
<li>HTTP</li>
<li>WebSocket</li>
</ul>
</li>
<li>QoS（Quality of Service，服务质量）
<ul>
<li>
<p>快速失败</p>
</li>
<li>
<p>自动回滚</p>
</li>
<li>
<p>自动重连</p>
</li>
<li>自动恢复</li>
</ul>
</li>
</ul>
<h4>可还原</h4>
<p>可还原，就是指接收到来自网络的操作消息后，可以在本地完全一致地再次执行该操作。可还原包括了：</p>
<ol start="1">
<li>绝对操作的还原</li>
<ul>
<li>控制体积</li>
<li>合理的提示</li>
</ul>
<li>相对操作的还原</li>
<ul>
<li>严格的顺序性</li>
<li>从源头保障顺序性</li>
<li>顺序性的补救</li>
</ul>
<li>本地操作的还原</li>
<ul>
<li>过滤收到的操作集合</li>
<li>从源头细化操作颗粒</li>
<li>本地保存本地执行</li>
</ul>
<li>无入侵的还原</li>
<ul>
<li>定义入侵</li>
<li>排除入侵</li>
<li>千人千面</li>
</ul>
</ol>
<h3>多人协作的难点：乱序与冲突</h3>
<h4>乱序</h4>
<p>乱序的表现形式如下图，小明在客户端执行了一系列操作，传递到服务器时发生乱序，导致小花看到了截然不同的信息：</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单3.png" alt="" width="684" height="392" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>为了解决乱序问题，可以尝试以下方法：</p>
<h5>1. 用性能换取顺序正确&mdash;&mdash;基于协议</h5>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单4.png" alt="" width="691" height="403" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5><span lang="EN-US">2. <span lang="ZH-TW">用性能换取顺序正确&mdash;&mdash;基于回执</span></span></h5>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单5.png" alt="" width="692" height="411" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5>两种方法的优缺点</h5>
<ol start="1">
<li>基于协议</li>
</ol>
<ul>
<li>优点
<ul>
<li>可靠，历经考验</li>
<li>简单，无需开发</li>
</ul>
</li>
<li>缺点
<ul>
<li>资源开销高</li>
<li>必须整套使用</li>
</ul>
</li>
<li>优点
<ul>
<li>自主可控，按需开发</li>
<li>资源开销可控</li>
</ul>
</li>
<li>缺点
<ul>
<li>需要自己投入开发</li>
<li>应用层逻辑控制使得网络复杂度向外蔓延</li>
<li>复杂度带来维护成本</li>
</ul>
</li>
</ul>
<ol start="2">
<li>基于回执</li>
</ol>
<p>&nbsp;</p>
<h5>基于乱序处理方法的总结</h5>
<p>网络不是绝对可靠的，为了实现相对可靠，需要付出一定的代价，企业需要考虑的是：如何衡量所付出的代价与产出成正比。</p>
<h4>冲突</h4>
<p>比乱序更高级的一种表现形式，存在多向、多维度等问题。</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/想实现多人协作的“在线Excel”？真没那么简单6.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h4>如何避免错误的蔓延？</h4>
<p>原则：任何一次不一致，都会导致后续的操作基于错误的信息进行，从而不断扩大错误，造成无法收拾的结果。<strong>因此，不一致是不能被容忍的。</strong></p>
<p>解决办法：</p>
<ol start="1">
<li>严格一致性：独占</li>
<li>最终一致性：检查与修复</li>
<li>非技术手段：设计与提示</li>
</ol>
<h5>严格的一致性</h5>
<p>独占就是同一时间同一范围只能由一人操作。</p>
<ol start="1">
<li>范围</li>
<ol start="1">
<li>整个表格，类似VSS</li>
<li>工作表</li>
<li>单元格范围</li>
</ol>
<li>排他性</li>
<ol start="1">
<li>独占冲突时，必有一方被弹开</li>
<li>直到占有者解开，不然无法占用</li>
<li>占用前无法操作</li>
<li>原理和锁基本一致</li>
</ol>
<li>优点</li>
<ol start="1">
<li>可以确保严格一致性，不会产生多版本的错误累积</li>
<li>比起修复恢复这类弥补手段，一开始就不出错的成本最低</li>
<li>逻辑清楚简单，开发维护成本低</li>
</ol>
<li>缺点</li>
<ol start="1">
<li>静态协作的味道</li>
<li>独占动作严重影响体验</li>
<li>大幅降低协作效率</li>
</ol>
<li>需对表格实现的 功能</li>
<ol start="1">
<li>锁定工作表</li>
<li>锁定单元格</li>
</ol></ol>
<h5>最终一致性</h5>
<p>基于唯一正确顺序，察觉客户端的错误，撤销错误操作后重新执行正确的操作。</p>
<ol start="1">
<li>唯一正确</li>
<ol start="1">
<li>服务器到达顺序</li>
<li>协作边界分流</li>
<li>P2P+选举算法</li>
</ol>
<li>察觉错误</li>
<ol start="1">
<li>服务器回执id</li>
<li>服务器回执操作，MS</li>
</ol>
<li>撤销错误</li>
<ol start="1">
<li>撤销到错误发生前的一步操作的结果</li>
<li>保存副本实现撤销功能</li>
<li>利用操作版本快照</li>
</ol>
<li>重新执行</li>
<ol start="1">
<li>操作队列需保存</li>
<li>区分好无感知执行与显式执行</li>
</ol></ol>
<h4>&nbsp;</h4>
<h4>针对多人协作难点的总结</h4>
<p>如何实现Excel相关功能是需要开发人员需要花时间去研究的，另外为了满足需求，适配多设备和平台的兼容性也非常重要。</p>
<p>另外，多人协作表格的本质还具有如下本质和特点：</p>
<ul>
<li>&nbsp;Server &ndash; Clients 中心系统，类似数值敏感的小型网游</li>
<li>任何这类系统都是在体验和正确性中寻求平衡</li>
<li>表格的数值敏感性高于网游，数据操作和存储的挑战更大</li>
<li>表格的计算复杂度更高，尤其涉及复杂公式嵌套与全量统计筛选</li>
<li>Web存在天花板，所以复杂的页游并不多见，端游较多</li>
</ul>
<p>&nbsp;</p>
<p>最后，假如您想了解更多如何实现多人协作平台相关的内容，欢迎参加2019年12月18日（周三） 14点由上海佳软CTO带来的一场线上直播：<span style="color: #003366;"><a href="https://live.vhall.com/483759540"><span style="color: #003366;">https://live.vhall.com/483759540</span></a></span>，相信届时我们都会受益良多的。</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>