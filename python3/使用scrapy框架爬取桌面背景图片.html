<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修使用scrapy框架爬取桌面背景图片' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>使用scrapy框架爬取桌面背景图片</center></div><div class='banquan'>原文出处:本文由博客园博主逍遥bb提供。<br/>
原文连接:https://www.cnblogs.com/xybbb/p/11417733.html</div><br>
    <h3><span style="font-family: 宋体; font-size: 12px;">目标数据： zol桌面壁纸，[风景] [1920*1080] 分类下19页每个图册的图片</span></h3>
<p><span style="font-family: 宋体; font-size: 12px; color: #ff9900;">items.py</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('a3906002-2ae3-43e5-8bb4-bc0c2c42e077')"><img id="code_img_closed_a3906002-2ae3-43e5-8bb4-bc0c2c42e077" class="code_img_closed" src="./images/使用scrapy框架爬取桌面背景图片0.png" alt="" /><img id="code_img_opened_a3906002-2ae3-43e5-8bb4-bc0c2c42e077" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a3906002-2ae3-43e5-8bb4-bc0c2c42e077',event)" src="./images/使用scrapy框架爬取桌面背景图片1.png" alt="" />
<div id="cnblogs_code_open_a3906002-2ae3-43e5-8bb4-bc0c2c42e077" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> scrapy
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Zol2Item(scrapy.Item):
</span><span style="color: #008080;"> 5</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> define the fields for your item here like:</span>
<span style="color: #008080;"> 6</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> name = scrapy.Field()</span>
<span style="color: #008080;"> 7</span>     image_urls =<span style="color: #000000;"> scrapy.Field()
</span><span style="color: #008080;"> 8</span>     images =<span style="color: #000000;"> scrapy.Field()
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     image_title = scrapy.Field()</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体; font-size: 12px; color: #ff9900;">pipelines.py&nbsp;</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('2225bbf8-8fce-437c-ba11-03b99c33edde')"><img id="code_img_closed_2225bbf8-8fce-437c-ba11-03b99c33edde" class="code_img_closed" src="./images/使用scrapy框架爬取桌面背景图片0.png" alt="" /><img id="code_img_opened_2225bbf8-8fce-437c-ba11-03b99c33edde" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2225bbf8-8fce-437c-ba11-03b99c33edde',event)" src="./images/使用scrapy框架爬取桌面背景图片1.png" alt="" />
<div id="cnblogs_code_open_2225bbf8-8fce-437c-ba11-03b99c33edde" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">from</span> scrapy <span style="color: #0000ff;">import</span><span style="color: #000000;"> Request
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">from</span> scrapy.pipelines.images <span style="color: #0000ff;">import</span><span style="color: #000000;"> ImagesPipeline
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ZolPipeline(ImagesPipeline):
</span><span style="color: #008080;"> 5</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> num = 1</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_media_requests(self, item, info):
</span><span style="color: #008080;"> 7</span>         image_url = item[<span style="color: #800000;">"</span><span style="color: #800000;">image_urls</span><span style="color: #800000;">"</span><span style="color: #000000;">]
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> image_url:
</span><span style="color: #008080;"> 9</span>             <span style="color: #008000;">#</span><span style="color: #008000;"> self.num + 1</span>
<span style="color: #008080;">10</span>             <span style="color: #0000ff;">yield</span> Request(url=image_url, meta={<span style="color: #800000;">"</span><span style="color: #800000;">item</span><span style="color: #800000;">"</span><span style="color: #000000;">: item})
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">def</span> file_path(self, request, response=None, info=<span style="color: #000000;">None):
</span><span style="color: #008080;">13</span>         <span style="color: #008000;">#</span><span style="color: #008000;"># start of deprecation warning block (can be removed in the future)</span>
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">def</span><span style="color: #000000;"> _warn():
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">from</span> scrapy.exceptions <span style="color: #0000ff;">import</span><span style="color: #000000;"> ScrapyDeprecationWarning
</span><span style="color: #008080;">16</span>             <span style="color: #0000ff;">import</span><span style="color: #000000;"> warnings
</span><span style="color: #008080;">17</span>             warnings.warn(<span style="color: #800000;">'</span><span style="color: #800000;">ImagesPipeline.image_key(url) and file_key(url) methods are deprecated, </span><span style="color: #800000;">'</span>
<span style="color: #008080;">18</span>                           <span style="color: #800000;">'</span><span style="color: #800000;">please use file_path(request, response=None, info=None) instead</span><span style="color: #800000;">'</span><span style="color: #000000;">,
</span><span style="color: #008080;">19</span>                           category=ScrapyDeprecationWarning, stacklevel=1<span style="color: #000000;">)
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> check if called from image_key or file_key with url as first argument</span>
<span style="color: #008080;">22</span>         <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> isinstance(request, Request):
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            _warn()
</span><span style="color: #008080;">24</span>             url =<span style="color: #000000;"> request
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">else</span><span style="color: #000000;">:
</span><span style="color: #008080;">26</span>             url =<span style="color: #000000;"> request.url
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> detect if file_key() or image_key() methods have been overridden</span>
<span style="color: #008080;">29</span>         <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span> hasattr(self.file_key, <span style="color: #800000;">'</span><span style="color: #800000;">_base</span><span style="color: #800000;">'</span><span style="color: #000000;">):
</span><span style="color: #008080;">30</span> <span style="color: #000000;">            _warn()
</span><span style="color: #008080;">31</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> self.file_key(url)
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">elif</span> <span style="color: #0000ff;">not</span> hasattr(self.image_key, <span style="color: #800000;">'</span><span style="color: #800000;">_base</span><span style="color: #800000;">'</span><span style="color: #000000;">):
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            _warn()
</span><span style="color: #008080;">34</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> self.image_key(url)
</span><span style="color: #008080;">35</span>         <span style="color: #008000;">#</span><span style="color: #008000;"># end of deprecation warning block</span>
<span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span>         <span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">desk/{}.jpg</span><span style="color: #800000;">'</span>.format(request.meta[<span style="color: #800000;">"</span><span style="color: #800000;">item</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">image_title</span><span style="color: #800000;">"</span>])</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体; font-size: 12px; color: #ff9900;">middlewares.py</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('775a6f61-4cdd-43ad-a486-cbbbc4f35adb')"><img id="code_img_closed_775a6f61-4cdd-43ad-a486-cbbbc4f35adb" class="code_img_closed" src="./images/使用scrapy框架爬取桌面背景图片0.png" alt="" /><img id="code_img_opened_775a6f61-4cdd-43ad-a486-cbbbc4f35adb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('775a6f61-4cdd-43ad-a486-cbbbc4f35adb',event)" src="./images/使用scrapy框架爬取桌面背景图片1.png" alt="" />
<div id="cnblogs_code_open_775a6f61-4cdd-43ad-a486-cbbbc4f35adb" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">from</span> scrapy <span style="color: #0000ff;">import</span><span style="color: #000000;"> signals
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">from</span> zol2.useragents <span style="color: #0000ff;">import</span><span style="color: #000000;"> agents
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Zol2SpiderMiddleware(object):
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> Not all methods need to be defined. If a method is not defined,</span>
<span style="color: #008080;"> 7</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> scrapy acts as if the spider middleware does not modify the</span>
<span style="color: #008080;"> 8</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> passed objects.</span>
<span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #000000;">    @classmethod
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> from_crawler(cls, crawler):
</span><span style="color: #008080;">12</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> This method is used by Scrapy to create your spiders.</span>
<span style="color: #008080;">13</span>         s =<span style="color: #000000;"> cls()
</span><span style="color: #008080;">14</span>         crawler.signals.connect(s.spider_opened, signal=<span style="color: #000000;">signals.spider_opened)
</span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> s
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_spider_input(self, response, spider):
</span><span style="color: #008080;">18</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called for each response that goes through the spider</span>
<span style="color: #008080;">19</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> middleware and into the spider.</span>
<span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Should return None or raise an exception.</span>
<span style="color: #008080;">22</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> None
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_spider_output(self, response, result, spider):
</span><span style="color: #008080;">25</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called with the results returned from the Spider, after</span>
<span style="color: #008080;">26</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> it has processed the response.</span>
<span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Must return an iterable of Request, dict or Item objects.</span>
<span style="color: #008080;">29</span>         <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> result:
</span><span style="color: #008080;">30</span>             <span style="color: #0000ff;">yield</span><span style="color: #000000;"> i
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_spider_exception(self, response, exception, spider):
</span><span style="color: #008080;">33</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called when a spider or process_spider_input() method</span>
<span style="color: #008080;">34</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> (from other spider middleware) raises an exception.</span>
<span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Should return either None or an iterable of Response, dict</span>
<span style="color: #008080;">37</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> or Item objects.</span>
<span style="color: #008080;">38</span>         <span style="color: #0000ff;">pass</span>
<span style="color: #008080;">39</span> 
<span style="color: #008080;">40</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_start_requests(self, start_requests, spider):
</span><span style="color: #008080;">41</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called with the start requests of the spider, and works</span>
<span style="color: #008080;">42</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> similarly to the process_spider_output() method, except</span>
<span style="color: #008080;">43</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> that it doesn&rsquo;t have a response associated.</span>
<span style="color: #008080;">44</span> 
<span style="color: #008080;">45</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Must return only requests (not items).</span>
<span style="color: #008080;">46</span>         <span style="color: #0000ff;">for</span> r <span style="color: #0000ff;">in</span><span style="color: #000000;"> start_requests:
</span><span style="color: #008080;">47</span>             <span style="color: #0000ff;">yield</span><span style="color: #000000;"> r
</span><span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> spider_opened(self, spider):
</span><span style="color: #008080;">50</span>         spider.logger.info(<span style="color: #800000;">'</span><span style="color: #800000;">Spider opened: %s</span><span style="color: #800000;">'</span> %<span style="color: #000000;"> spider.name)
</span><span style="color: #008080;">51</span> 
<span style="color: #008080;">52</span> 
<span style="color: #008080;">53</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Zol2DownloaderMiddleware(object):
</span><span style="color: #008080;">54</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> Not all methods need to be defined. If a method is not defined,</span>
<span style="color: #008080;">55</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> scrapy acts as if the downloader middleware does not modify the</span>
<span style="color: #008080;">56</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> passed objects.</span>
<span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span> <span style="color: #000000;">    @classmethod
</span><span style="color: #008080;">59</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> from_crawler(cls, crawler):
</span><span style="color: #008080;">60</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> This method is used by Scrapy to create your spiders.</span>
<span style="color: #008080;">61</span>         s =<span style="color: #000000;"> cls()
</span><span style="color: #008080;">62</span>         crawler.signals.connect(s.spider_opened, signal=<span style="color: #000000;">signals.spider_opened)
</span><span style="color: #008080;">63</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> s
</span><span style="color: #008080;">64</span> 
<span style="color: #008080;">65</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_request(self, request, spider):
</span><span style="color: #008080;">66</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called for each request that goes through the downloader</span>
<span style="color: #008080;">67</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> middleware.</span>
<span style="color: #008080;">68</span> 
<span style="color: #008080;">69</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Must either:</span>
<span style="color: #008080;">70</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return None: continue processing this request</span>
<span style="color: #008080;">71</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - or return a Response object</span>
<span style="color: #008080;">72</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - or return a Request object</span>
<span style="color: #008080;">73</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - or raise IgnoreRequest: process_exception() methods of</span>
<span style="color: #008080;">74</span>         <span style="color: #008000;">#</span><span style="color: #008000;">   installed downloader middleware will be called</span>
<span style="color: #008080;">75</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> None
</span><span style="color: #008080;">76</span> 
<span style="color: #008080;">77</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_response(self, request, response, spider):
</span><span style="color: #008080;">78</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called with the response returned from the downloader.</span>
<span style="color: #008080;">79</span> 
<span style="color: #008080;">80</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Must either;</span>
<span style="color: #008080;">81</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return a Response object</span>
<span style="color: #008080;">82</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return a Request object</span>
<span style="color: #008080;">83</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - or raise IgnoreRequest</span>
<span style="color: #008080;">84</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> response
</span><span style="color: #008080;">85</span> 
<span style="color: #008080;">86</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_exception(self, request, exception, spider):
</span><span style="color: #008080;">87</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Called when a download handler or a process_request()</span>
<span style="color: #008080;">88</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> (from other downloader middleware) raises an exception.</span>
<span style="color: #008080;">89</span> 
<span style="color: #008080;">90</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> Must either:</span>
<span style="color: #008080;">91</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return None: continue processing this exception</span>
<span style="color: #008080;">92</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return a Response object: stops process_exception() chain</span>
<span style="color: #008080;">93</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> - return a Request object: stops process_exception() chain</span>
<span style="color: #008080;">94</span>         <span style="color: #0000ff;">pass</span>
<span style="color: #008080;">95</span> 
<span style="color: #008080;">96</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> spider_opened(self, spider):
</span><span style="color: #008080;">97</span>         spider.logger.info(<span style="color: #800000;">'</span><span style="color: #800000;">Spider opened: %s</span><span style="color: #800000;">'</span> % spider.name)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体; font-size: 12px; color: #ff9900;">settings.py</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('fbd9fcf1-28d8-47a0-bbce-f8856df11fd6')"><img id="code_img_closed_fbd9fcf1-28d8-47a0-bbce-f8856df11fd6" class="code_img_closed" src="./images/使用scrapy框架爬取桌面背景图片0.png" alt="" /><img id="code_img_opened_fbd9fcf1-28d8-47a0-bbce-f8856df11fd6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('fbd9fcf1-28d8-47a0-bbce-f8856df11fd6',event)" src="./images/使用scrapy框架爬取桌面背景图片1.png" alt="" />
<div id="cnblogs_code_open_fbd9fcf1-28d8-47a0-bbce-f8856df11fd6" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>
<span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Scrapy settings for zol2 project</span>
<span style="color: #008080;"> 4</span> <span style="color: #008000;">#
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;">#</span><span style="color: #008000;"> For simplicity, this file contains only settings considered important or</span>
<span style="color: #008080;"> 6</span> <span style="color: #008000;">#</span><span style="color: #008000;"> commonly used. You can find more settings consulting the documentation:</span>
<span style="color: #008080;"> 7</span> <span style="color: #008000;">#
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;">#</span><span style="color: #008000;">     https://doc.scrapy.org/en/latest/topics/settings.html</span>
<span style="color: #008080;"> 9</span> <span style="color: #008000;">#</span><span style="color: #008000;">     https://doc.scrapy.org/en/latest/topics/downloader-middleware.html</span>
<span style="color: #008080;">10</span> <span style="color: #008000;">#</span><span style="color: #008000;">     https://doc.scrapy.org/en/latest/topics/spider-middleware.html</span>
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> BOT_NAME = <span style="color: #800000;">'</span><span style="color: #800000;">zol2</span><span style="color: #800000;">'</span>
<span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> SPIDER_MODULES = [<span style="color: #800000;">'</span><span style="color: #800000;">zol2.spiders</span><span style="color: #800000;">'</span><span style="color: #000000;">]
</span><span style="color: #008080;">15</span> NEWSPIDER_MODULE = <span style="color: #800000;">'</span><span style="color: #800000;">zol2.spiders</span><span style="color: #800000;">'</span>
<span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Crawl responsibly by identifying yourself (and your website) on the user-agent</span>
<span style="color: #008080;">19</span> USER_AGENT = <span style="color: #800000;">'</span><span style="color: #800000;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.75 Safari/537.36</span><span style="color: #800000;">'</span>
<span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Obey robots.txt rules</span>
<span style="color: #008080;">22</span> <span style="color: #008000;">#</span><span style="color: #008000;"> ROBOTSTXT_OBEY = True</span>
<span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Configure maximum concurrent requests performed by Scrapy (default: 16)</span>
<span style="color: #008080;">25</span> <span style="color: #008000;">#</span><span style="color: #008000;">CONCURRENT_REQUESTS = 32</span>
<span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Configure a delay for requests for the same website (default: 0)</span>
<span style="color: #008080;">28</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/settings.html#download-delay</span>
<span style="color: #008080;">29</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See also autothrottle settings and docs</span>
<span style="color: #008080;">30</span> DOWNLOAD_DELAY = 0.5
<span style="color: #008080;">31</span> <span style="color: #008000;">#</span><span style="color: #008000;"> The download delay setting will honor only one of:</span>
<span style="color: #008080;">32</span> <span style="color: #008000;">#</span><span style="color: #008000;">CONCURRENT_REQUESTS_PER_DOMAIN = 16</span>
<span style="color: #008080;">33</span> <span style="color: #008000;">#</span><span style="color: #008000;">CONCURRENT_REQUESTS_PER_IP = 16</span>
<span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Disable cookies (enabled by default)</span>
<span style="color: #008080;">36</span> <span style="color: #008000;">#</span><span style="color: #008000;">COOKIES_ENABLED = False</span>
<span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Disable Telnet Console (enabled by default)</span>
<span style="color: #008080;">39</span> <span style="color: #008000;">#</span><span style="color: #008000;">TELNETCONSOLE_ENABLED = False</span>
<span style="color: #008080;">40</span> 
<span style="color: #008080;">41</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Override the default request headers:</span>
<span style="color: #008080;">42</span> <span style="color: #008000;">#</span><span style="color: #008000;">DEFAULT_REQUEST_HEADERS = {</span>
<span style="color: #008080;">43</span> <span style="color: #008000;">#</span><span style="color: #008000;">   'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',</span>
<span style="color: #008080;">44</span> <span style="color: #008000;">#</span><span style="color: #008000;">   'Accept-Language': 'en',</span>
<span style="color: #008080;">45</span> <span style="color: #008000;">#</span><span style="color: #008000;">}</span>
<span style="color: #008080;">46</span> 
<span style="color: #008080;">47</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable or disable spider middlewares</span>
<span style="color: #008080;">48</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/spider-middleware.html</span>
<span style="color: #008080;">49</span> <span style="color: #008000;">#</span><span style="color: #008000;">SPIDER_MIDDLEWARES = {</span>
<span style="color: #008080;">50</span> <span style="color: #008000;">#</span><span style="color: #008000;">    'zol2.middlewares.Zol2SpiderMiddleware': 543,</span>
<span style="color: #008080;">51</span> <span style="color: #008000;">#</span><span style="color: #008000;">}</span>
<span style="color: #008080;">52</span> 
<span style="color: #008080;">53</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable or disable downloader middlewares</span>
<span style="color: #008080;">54</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/downloader-middleware.html</span>
<span style="color: #008080;">55</span> <span style="color: #008000;">#</span><span style="color: #008000;">DOWNLOADER_MIDDLEWARES = {</span>
<span style="color: #008080;">56</span> <span style="color: #008000;">#</span><span style="color: #008000;">    'zol2.middlewares.Zol2DownloaderMiddleware': 543,</span>
<span style="color: #008080;">57</span> <span style="color: #008000;">#</span><span style="color: #008000;">}</span>
<span style="color: #008080;">58</span> 
<span style="color: #008080;">59</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable or disable extensions</span>
<span style="color: #008080;">60</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/extensions.html</span>
<span style="color: #008080;">61</span> <span style="color: #008000;">#</span><span style="color: #008000;">EXTENSIONS = {</span>
<span style="color: #008080;">62</span> <span style="color: #008000;">#</span><span style="color: #008000;">    'scrapy.extensions.telnet.TelnetConsole': None,</span>
<span style="color: #008080;">63</span> <span style="color: #008000;">#</span><span style="color: #008000;">}</span>
<span style="color: #008080;">64</span> 
<span style="color: #008080;">65</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Configure item pipelines</span>
<span style="color: #008080;">66</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span>
<span style="color: #008080;">67</span> ITEM_PIPELINES =<span style="color: #000000;"> {
</span><span style="color: #008080;">68</span>    <span style="color: #800000;">'</span><span style="color: #800000;">zol2.pipelines.Zol2Pipeline</span><span style="color: #800000;">'</span>: 300<span style="color: #000000;">,
</span><span style="color: #008080;">69</span> <span style="color: #000000;">}
</span><span style="color: #008080;">70</span> IMAGES_STORE = <span style="color: #800000;">"</span><span style="color: #800000;">/home/pyvip/env_spider/zol2/zol2/images</span><span style="color: #800000;">"</span>
<span style="color: #008080;">71</span> 
<span style="color: #008080;">72</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable and configure the AutoThrottle extension (disabled by default)</span>
<span style="color: #008080;">73</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/autothrottle.html</span>
<span style="color: #008080;">74</span> <span style="color: #008000;">#</span><span style="color: #008000;">AUTOTHROTTLE_ENABLED = True</span>
<span style="color: #008080;">75</span> <span style="color: #008000;">#</span><span style="color: #008000;"> The initial download delay</span>
<span style="color: #008080;">76</span> <span style="color: #008000;">#</span><span style="color: #008000;">AUTOTHROTTLE_START_DELAY = 5</span>
<span style="color: #008080;">77</span> <span style="color: #008000;">#</span><span style="color: #008000;"> The maximum download delay to be set in case of high latencies</span>
<span style="color: #008080;">78</span> <span style="color: #008000;">#</span><span style="color: #008000;">AUTOTHROTTLE_MAX_DELAY = 60</span>
<span style="color: #008080;">79</span> <span style="color: #008000;">#</span><span style="color: #008000;"> The average number of requests Scrapy should be sending in parallel to</span>
<span style="color: #008080;">80</span> <span style="color: #008000;">#</span><span style="color: #008000;"> each remote server</span>
<span style="color: #008080;">81</span> <span style="color: #008000;">#</span><span style="color: #008000;">AUTOTHROTTLE_TARGET_CONCURRENCY = 1.0</span>
<span style="color: #008080;">82</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable showing throttling stats for every response received:</span>
<span style="color: #008080;">83</span> <span style="color: #008000;">#</span><span style="color: #008000;">AUTOTHROTTLE_DEBUG = False</span>
<span style="color: #008080;">84</span> 
<span style="color: #008080;">85</span> <span style="color: #008000;">#</span><span style="color: #008000;"> Enable and configure HTTP caching (disabled by default)</span>
<span style="color: #008080;">86</span> <span style="color: #008000;">#</span><span style="color: #008000;"> See https://doc.scrapy.org/en/latest/topics/downloader-middleware.html#httpcache-middleware-settings</span>
<span style="color: #008080;">87</span> <span style="color: #008000;">#</span><span style="color: #008000;">HTTPCACHE_ENABLED = True</span>
<span style="color: #008080;">88</span> <span style="color: #008000;">#</span><span style="color: #008000;">HTTPCACHE_EXPIRATION_SECS = 0</span>
<span style="color: #008080;">89</span> <span style="color: #008000;">#</span><span style="color: #008000;">HTTPCACHE_DIR = 'httpcache'</span>
<span style="color: #008080;">90</span> <span style="color: #008000;">#</span><span style="color: #008000;">HTTPCACHE_IGNORE_HTTP_CODES = []</span>
<span style="color: #008080;">91</span> <span style="color: #008000;">#</span><span style="color: #008000;">HTTPCACHE_STORAGE = 'scrapy.extensions.httpcache.FilesystemCacheStorage'</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体; font-size: 12px; color: #ff9900;">pazol2.py</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('e207ea81-cbb5-48b0-816c-c915fc8cf7e7')"><img id="code_img_closed_e207ea81-cbb5-48b0-816c-c915fc8cf7e7" class="code_img_closed" src="./images/使用scrapy框架爬取桌面背景图片0.png" alt="" /><img id="code_img_opened_e207ea81-cbb5-48b0-816c-c915fc8cf7e7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e207ea81-cbb5-48b0-816c-c915fc8cf7e7',event)" src="./images/使用scrapy框架爬取桌面背景图片1.png" alt="" />
<div id="cnblogs_code_open_e207ea81-cbb5-48b0-816c-c915fc8cf7e7" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> scrapy
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">from</span> scrapy.linkextractors <span style="color: #0000ff;">import</span><span style="color: #000000;"> LinkExtractor
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">from</span> scrapy.spiders <span style="color: #0000ff;">import</span><span style="color: #000000;"> CrawlSpider, Rule
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">from</span> zol2.items <span style="color: #0000ff;">import</span><span style="color: #000000;"> Zol2Item
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Pazol2Spider(CrawlSpider):
</span><span style="color: #008080;"> 8</span>     name = <span style="color: #800000;">'</span><span style="color: #800000;">pazol2</span><span style="color: #800000;">'</span>
<span style="color: #008080;"> 9</span>     <span style="color: #008000;">#</span><span style="color: #008000;"> allowed_domains = ['desk.zol.com.cn']</span>
<span style="color: #008080;">10</span>     start_urls = [<span style="color: #800000;">'</span><span style="color: #800000;">http://desk.zol.com.cn/fengjing/1920x1080/</span><span style="color: #800000;">'</span><span style="color: #000000;">]
</span><span style="color: #008080;">11</span>     front_url = <span style="color: #800000;">"</span><span style="color: #800000;">http://desk.zol.com.cn</span><span style="color: #800000;">"</span>
<span style="color: #008080;">12</span>     num = 1
<span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     rules =<span style="color: #000000;"> (
</span><span style="color: #008080;">15</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> 1.解决翻页</span>
<span style="color: #008080;">16</span>         Rule(LinkExtractor(allow=r<span style="color: #800000;">'</span><span style="color: #800000;">/fengjing/1920x1080/[0-1]?[0-9]?.html</span><span style="color: #800000;">'</span>), callback=<span style="color: #800000;">'</span><span style="color: #800000;">parse_album</span><span style="color: #800000;">'</span>, follow=<span style="color: #000000;">True),
</span><span style="color: #008080;">17</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> 2.进入各个图库的每一张图片页</span>
<span style="color: #008080;">18</span>         Rule(LinkExtractor(allow=r<span style="color: #800000;">'</span><span style="color: #800000;">/bizhi/\d+_\d+_\d+.html</span><span style="color: #800000;">'</span>, restrict_xpaths=(<span style="color: #800000;">"</span><span style="color: #800000;">//div[@class='main']/ul[@class='pic-list2  clearfix']/li</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">//div[@class='photo-list-box']</span><span style="color: #800000;">"</span>)), follow=<span style="color: #000000;">True),
</span><span style="color: #008080;">19</span>         <span style="color: #008000;">#</span><span style="color: #008000;"> 3.点击各个图片1920*1080按钮，获得html</span>
<span style="color: #008080;">20</span>         Rule(LinkExtractor(allow=r<span style="color: #800000;">'</span><span style="color: #800000;">/showpic/1920x1080_\d+_\d+.html</span><span style="color: #800000;">'</span>), callback=<span style="color: #800000;">'</span><span style="color: #800000;">get_img</span><span style="color: #800000;">'</span>, follow=<span style="color: #000000;">True),
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    )
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>     <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_img(self, response):
</span><span style="color: #008080;">24</span>         item =<span style="color: #000000;"> Zol2Item()
</span><span style="color: #008080;">25</span>         item[<span style="color: #800000;">'</span><span style="color: #800000;">image_urls</span><span style="color: #800000;">'</span>] = response.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">//body/img[1]/@src</span><span style="color: #800000;">"</span><span style="color: #000000;">).extract_first()
</span><span style="color: #008080;">26</span>         item[<span style="color: #800000;">'</span><span style="color: #800000;">image_title</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> str(self.num)
</span><span style="color: #008080;">27</span>         self.num += 1
<span style="color: #008080;">28</span>         <span style="color: #0000ff;">yield</span> item</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体; font-size: 12px;">爬取结果</span></p>
<p>&nbsp;<img src="./images/使用scrapy框架爬取桌面背景图片10.png" alt="" width="888" height="619" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;"><span style="font-size: 12px;">共爬取了4517张图片，用时108分钟</span></span></p>
<p><span style="font-family: 宋体;"><span style="font-size: 12px;">放在桌面图库，半小时换一张，美滋滋。</span></span></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>