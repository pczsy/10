<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修python 之 数据库（内置函数、流程控制、索引）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>python 之 数据库（内置函数、流程控制、索引）</center></div><div class='banquan'>原文出处:本文由博客园博主small_white-提供。<br/>
原文连接:https://www.cnblogs.com/mylu/p/11324151.html</div><br>
    <h3 class="md-end-block md-heading md-focus"><span class="md-plain">10.17 内置函数</span></h3>
<p class="md-end-block md-p"><span><strong>强调：</strong><span class="md-plain">mysql内置的函数只能在sql语句中使用</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">#数学函数
</span><span style="color: #ff00ff;">round</span><span style="color: #000000;">(x,y)      #返回参数x的四舍五入的有y位小数的值
</span><span style="color: #ff00ff;">rand</span><span style="color: #000000;">()          #返回０到１内的随机值,可以通过提供一个参数(种子)使rand()随机数生成器生成一个指定的值。
​
#加密函数
md5()           #计算字符串str的MD5校验和
password(</span><span style="color: #ff00ff;">str</span>)   #返回字符串str的加密版本，这个加密过程是不可逆转的，和UNIX密码加密过程使用不同的算法。</pre>
</div>
<p class="md-end-block md-p"><span><strong>date_format:</strong></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">create</span> <span style="color: #0000ff;">table</span><span style="color: #000000;"> blog (
    id </span><span style="color: #0000ff;">int</span> <span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span><span style="color: #000000;"> auto_increment,
    name </span><span style="color: #0000ff;">char</span> (<span style="color: #800000; font-weight: bold;">32</span><span style="color: #000000;">),
    sub_time </span><span style="color: #0000ff;">datetime</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">insert</span> <span style="color: #0000ff;">into</span> blog (name, sub_time) <span style="color: #0000ff;">values</span><span style="color: #000000;">
(</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">第1篇</span><span style="color: #ff0000;">'</span>,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">2015-03-01 11:31:21</span><span style="color: #ff0000;">'</span><span style="color: #000000;">),
(</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">第2篇</span><span style="color: #ff0000;">'</span>,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">2015-03-11 16:31:21</span><span style="color: #ff0000;">'</span><span style="color: #000000;">),
(</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">第3篇</span><span style="color: #ff0000;">'</span>,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">2017-05-01 18:31:21</span><span style="color: #ff0000;">'</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">select</span> date_format(sub_time,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">%Y-%m</span><span style="color: #ff0000;">'</span>),<span style="color: #ff00ff;">count</span>(id) <span style="color: #0000ff;">from</span> blog <span style="color: #0000ff;">group</span> <span style="color: #0000ff;">by</span> date_format(sub_time,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">%Y-%m</span><span style="color: #ff0000;">'</span><span style="color: #000000;">);
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------------------------+-----------+</span>
<span style="color: #808080;">|</span> date_format(sub_time,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">%Y-%m</span><span style="color: #ff0000;">'</span>) <span style="color: #808080;">|</span> <span style="color: #ff00ff;">count</span>(id) <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------------------------+-----------+</span>
<span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">2015</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">03</span>                       <span style="color: #808080;">|</span>         <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">2017</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">05</span>                       <span style="color: #808080;">|</span>         <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----------------------------+-----------+</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">10.171 自定义函数</span></h4>
<p class="md-end-block md-p"><span class="md-plain">函数中不要写sql语句（否则会报错），函数仅仅只是一个功能，是一个在sql中被应用的功能,若要想在begin...end...中写sql，请用存储过程.</span></p>
<div class="cnblogs_code">
<pre><code>delimiter <span style="color: #808080;">//</span>
<span style="color: #0000ff;">create</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> f1(
    i1 </span><span style="color: #0000ff;">int</span><span style="color: #000000;">,
    i2 </span><span style="color: #0000ff;">int</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">returns</span> <span style="color: #0000ff;">int</span>
<span style="color: #0000ff;">BEGIN</span>
    <span style="color: #0000ff;">declare</span> num <span style="color: #0000ff;">int</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">set</span> num <span style="color: #808080;">=</span> i1 <span style="color: #808080;">+</span><span style="color: #000000;"> i2;
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;">(num);
</span><span style="color: #0000ff;">END</span> <span style="color: #808080;">//</span><span style="color: #000000;">
delimiter ;</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain">删除函数：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">drop</span> <span style="color: #0000ff;">function</span> func_name;</pre>
</div>
<p class="md-end-block md-p"><span class="md-plain">执行函数：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"># 获取返回值
</span><span style="color: #0000ff;">select</span> <span style="color: #ff00ff;">UPPER</span>(<span style="color: #ff0000;">'</span><span style="color: #ff0000;">egon</span><span style="color: #ff0000;">'</span>) <span style="color: #0000ff;">into</span> <span style="color: #008000;">@res</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">SELECT</span> <span style="color: #008000;">@res</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----+</span>
<span style="color: #808080;">|</span> <span style="color: #008000;">@res</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----+</span>
<span style="color: #808080;">|</span> EGON <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----+</span>
<span style="color: #000000;"># 在查询中使用
</span><span style="color: #0000ff;">select</span> f1(<span style="color: #800000; font-weight: bold;">11</span>,nid) ,name <span style="color: #0000ff;">from</span> tb2;</pre>
</div>
<h3 class="md-end-block md-heading"><span class="md-plain">10.18 流程控制</span></h3>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>if条件语句:</strong></span></span></p>
<div class="cnblogs_code">
<pre><code>delimiter <span style="color: #808080;">//</span>
<span style="color: #0000ff;">create</span> <span style="color: #0000ff;">function</span> f5(i <span style="color: #0000ff;">int</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">returns</span> <span style="color: #0000ff;">int</span>
<span style="color: #0000ff;">begin</span>
    <span style="color: #0000ff;">declare</span> res <span style="color: #0000ff;">int</span> <span style="color: #0000ff;">default</span> <span style="color: #800000; font-weight: bold;">0</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span> i <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">10</span> <span style="color: #0000ff;">then</span>
        <span style="color: #0000ff;">set</span> res<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">100</span><span style="color: #000000;">;
    elseif i </span><span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">20</span> <span style="color: #0000ff;">then</span>
        <span style="color: #0000ff;">set</span> res<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">200</span><span style="color: #000000;">;
    elseif i </span><span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">30</span> <span style="color: #0000ff;">then</span>
        <span style="color: #0000ff;">set</span> res<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">300</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">else</span>
        <span style="color: #0000ff;">set</span> res<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">400</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">end</span> <span style="color: #0000ff;">if</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> res;
</span><span style="color: #0000ff;">end</span> <span style="color: #808080;">//</span><span style="color: #000000;">
delimiter ;</span></pre>
</div>
<p class="md-end-block md-p"><span><strong>控制流函数：</strong></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">select</span> 
<span style="color: #ff00ff;">case</span>
    <span style="color: #0000ff;">when</span> name <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">egon</span><span style="color: #ff0000;">'</span> <span style="color: #0000ff;">then</span><span style="color: #000000;"> name
    </span><span style="color: #0000ff;">when</span> name <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">alex</span><span style="color: #ff0000;">'</span> <span style="color: #0000ff;">then</span> concat(name,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">_BIGSB</span><span style="color: #ff0000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">else</span> concat(name,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">_SB</span><span style="color: #ff0000;">'</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">from</span> emp;</pre>
</div>
<p class="md-end-block md-p"><span><strong>循环语句:</strong></span></p>
<div class="cnblogs_code">
<pre><code>delimiter <span style="color: #808080;">//</span>
<span style="color: #0000ff;">create</span> <span style="color: #0000ff;">procedure</span><span style="color: #000000;"> proc_while ()
</span><span style="color: #0000ff;">begin</span>
    <span style="color: #0000ff;">declare</span> num <span style="color: #0000ff;">int</span><span style="color: #000000;"> ;
    </span><span style="color: #0000ff;">set</span> num <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">0</span><span style="color: #000000;"> ;
    </span><span style="color: #0000ff;">while</span> num <span style="color: #808080;">&lt;</span> <span style="color: #800000; font-weight: bold;">10</span><span style="color: #000000;"> do
        </span><span style="color: #0000ff;">select</span><span style="color: #000000;">
            num ;
        </span><span style="color: #0000ff;">set</span> num <span style="color: #808080;">=</span> num <span style="color: #808080;">+</span> <span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;"> ;
    </span><span style="color: #0000ff;">end</span> <span style="color: #0000ff;">while</span><span style="color: #000000;"> ;
</span><span style="color: #0000ff;">end</span> <span style="color: #808080;">//</span><span style="color: #000000;">
delimiter ;</span></pre>
</div>
<h3 class="md-end-block md-heading"><span class="md-plain">10.19 索引</span></h3>
<p class="md-end-block md-p"><span class="md-plain"> 索引就相当于书的目录，是mysql中一种专门的数据结构，称为key， 索引的本质原理就是通过不断地缩小查询范围，来降低 i/o 次数从而提升查询性能，一旦为表创建了索引，以后的查询都会先查索引，再根据索引定位的结果去找数据</span></p>
<p class="md-end-block md-p"><span class="md-plain">索引的影响：<span class="md-softbreak"> <span class="md-plain"> 1、在表中有大量数据的前提下，创建索引速度会很慢<span class="md-softbreak"> <span class="md-plain"> 2、在索引创建完毕后，对表的查询性能会大幅度提升，但是写性能会降低</span></span></span></span></span></p>
<p class="md-end-block md-p"><span><strong>聚集索引</strong><span class="md-plain">(primary key)：就是按照每张表的主键构造一棵B+树，同时叶子结点存放的即为整张表的行记录数据，也将聚集索引的叶子结点称为数据页。聚集索引的这个特性决定了索引组织表中数据也是索引的一部分。同B+树数据结构一样，每个数据页都通过一个<span><strong>双向链表</strong><span class="md-plain">来进行链接。特点：叶子节点存放的一整条数据</span></span></span></span></p>
<p class="md-end-block md-p"><span><strong>聚集索引的优点：</strong><span class="md-plain">1.它对主键的排序查找和范围查找速度非常快，叶子节点的数据就是用户所要查询的数据。如用户需要查找一张表，查询最后的10位用户信息，由于B+树索引是双向链表，所以用户可以快速找到最后一个数据页，并取出10条记录 2.范围查询(range query),即如果要查找主键某一范围内的数据，通过叶子节点的上层中间节点就可以得到页的范围，之后直接读取数据页即可</span></span></p>
<div class="md-hr md-end-block"><hr /></div>
<p class="md-end-block md-p"><span><strong>辅助索引</strong><span class="md-plain">(unique，index):非聚集索引<span><strong>即从辅助索引中就可以得到查询记录，而不需要查询聚集索引中的记录。</strong><span class="md-softbreak"> <span class="md-plain">特点：辅助索引的叶子节点不包含行记录的全部数据。如果是按照name字段创建的索引，那么叶子节点存放的是：<span><strong>{name：名字所在那条记录的主键的值}</strong></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">每张表上可以有多个辅助索引，但只能有一个聚集索引。当通过辅助索引来寻找数据时，InnoDB存储引擎会遍历辅助索引并通过叶子级别的指针获得主键索引的主键，然后再通过主键索引来找到一个完整的行记录。</span></p>
<p class="md-end-block md-p"><span><strong>使用覆盖索引的一个好处是：</strong><span class="md-plain">辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少大量的IO操作,<span><strong>InnoDB存储引擎支持覆盖索引（covering index，或称索引覆盖），即从辅助索引中就可以得到查询记录，而不需要查询聚集索引中的记录。</strong></span></span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">#覆盖索引：在辅助索引的叶子节点中就已经找到了所有我们想要的数据
</span><span style="color: #0000ff;">select</span> name <span style="color: #0000ff;">from</span> <span style="color: #ff00ff;">user</span> <span style="color: #0000ff;">where</span> name<span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">egon</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
#非覆盖索引：命中辅助索引，但是未覆盖索引，还需要从聚集索引中查找age
</span><span style="color: #0000ff;">select</span> age <span style="color: #0000ff;">from</span> <span style="color: #ff00ff;">user</span> <span style="color: #0000ff;">where</span> name<span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">egon</span><span style="color: #ff0000;">'</span>; </pre>
</div>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>联合索引:</strong><span class="md-plain">联合索引指对表上的多个列合起来做一个索引,在第一个键相同的情况下，已经对第二个键进行了排序处理</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain"> mysql中的primary key，unique，index ,联合唯一也都是索引，这些索引除了加速查找以外，还有约束的功能</span></p>
<div class="cnblogs_code">
<pre><code>普通索引 <span style="color: #0000ff;">index</span><span style="color: #000000;">：加速查找
唯一索引：
    </span><span style="color: #808080;">-</span>主键索引 <span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span>：加速查找<span style="color: #808080;">+</span>约束（<span style="color: #808080;">not</span> <span style="color: #0000ff;">null</span>  <span style="color: #808080;">+</span> <span style="color: #0000ff;">unique</span><span style="color: #000000;">）
    </span><span style="color: #808080;">-</span>唯一索引 <span style="color: #0000ff;">unique</span>:加速查找<span style="color: #808080;">+</span><span style="color: #000000;">约束（不能重复）
联合索引：
    </span><span style="color: #808080;">-</span><span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span>(id,name):联合主键索引，加速查找<span style="color: #808080;">+</span><span style="color: #000000;">约束
    </span><span style="color: #808080;">-</span><span style="color: #0000ff;">unique</span>(id,name):联合唯一索引，加速查找<span style="color: #808080;">+</span><span style="color: #000000;">约束
    </span><span style="color: #808080;">-</span><span style="color: #0000ff;">index</span>(id,name):联合普通索引</pre>
</div>
<p class="md-end-block md-p"><span class="md-plain">innodb:聚集索引，辅助索引 myisam:辅助索引</span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">10.191 创建和删除索引</span></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">#方式一
</span><span style="color: #0000ff;">create</span> <span style="color: #0000ff;">table</span><span style="color: #000000;"> t1(
    id </span><span style="color: #0000ff;">int</span><span style="color: #000000;">,
    name </span><span style="color: #0000ff;">char</span><span style="color: #000000;">,
    age </span><span style="color: #0000ff;">int</span><span style="color: #000000;">,
    sex enum(</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">male</span><span style="color: #ff0000;">'</span>,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">female</span><span style="color: #ff0000;">'</span><span style="color: #000000;">),
    </span><span style="color: #0000ff;">unique</span> <span style="color: #0000ff;">key</span><span style="color: #000000;"> uni_id(id),
    </span><span style="color: #0000ff;">index</span><span style="color: #000000;"> ix_name(name)         #index没有key
);
#方式二
</span><span style="color: #0000ff;">create</span> <span style="color: #0000ff;">index</span> ix_age <span style="color: #0000ff;">on</span><span style="color: #000000;"> t1(age);
#方式三
</span><span style="color: #0000ff;">alter</span> <span style="color: #0000ff;">table</span> t1 <span style="color: #0000ff;">add</span> <span style="color: #0000ff;">index</span><span style="color: #000000;"> ix_sex(sex);
</span><span style="color: #0000ff;">alter</span> <span style="color: #0000ff;">table</span> t1 <span style="color: #0000ff;">add</span> <span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span><span style="color: #000000;">(id);
#联合索引
</span><span style="color: #0000ff;">alter</span> <span style="color: #0000ff;">table</span> t1 <span style="color: #0000ff;">add</span> <span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span><span style="color: #000000;">(id，name);
</span><span style="color: #0000ff;">create</span> <span style="color: #0000ff;">index</span> ix_age <span style="color: #0000ff;">on</span><span style="color: #000000;"> t1(id，age);
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----+-----------------------+------+-----+---------+-------+</span>
<span style="color: #808080;">|</span> Field <span style="color: #808080;">|</span> Type                  <span style="color: #808080;">|</span> <span style="color: #0000ff;">Null</span> <span style="color: #808080;">|</span> <span style="color: #0000ff;">Key</span> <span style="color: #808080;">|</span> <span style="color: #0000ff;">Default</span> <span style="color: #808080;">|</span> Extra <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----+-----------------------+------+-----+---------+-------+</span>
<span style="color: #808080;">|</span> id    <span style="color: #808080;">|</span> <span style="color: #0000ff;">int</span>(<span style="color: #800000; font-weight: bold;">11</span>)               <span style="color: #808080;">|</span> YES  <span style="color: #808080;">|</span> UNI <span style="color: #808080;">|</span> <span style="color: #0000ff;">NULL</span>    <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> name  <span style="color: #808080;">|</span> <span style="color: #0000ff;">char</span>(<span style="color: #800000; font-weight: bold;">1</span>)               <span style="color: #808080;">|</span> YES  <span style="color: #808080;">|</span> MUL <span style="color: #808080;">|</span> <span style="color: #0000ff;">NULL</span>    <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> age   <span style="color: #808080;">|</span> <span style="color: #0000ff;">int</span>(<span style="color: #800000; font-weight: bold;">11</span>)               <span style="color: #808080;">|</span> YES  <span style="color: #808080;">|</span> MUL <span style="color: #808080;">|</span> <span style="color: #0000ff;">NULL</span>    <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> sex   <span style="color: #808080;">|</span> enum(<span style="color: #ff0000;">'</span><span style="color: #ff0000;">male</span><span style="color: #ff0000;">'</span>,<span style="color: #ff0000;">'</span><span style="color: #ff0000;">female</span><span style="color: #ff0000;">'</span>) <span style="color: #808080;">|</span> YES  <span style="color: #808080;">|</span> MUL <span style="color: #808080;">|</span> <span style="color: #0000ff;">NULL</span>    <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-----+-----------------------+------+-----+---------+-------+</span>
<span style="color: #000000;">#删除索引：
</span><span style="color: #0000ff;">drop</span> <span style="color: #0000ff;">index</span> idx_name <span style="color: #0000ff;">on</span><span style="color: #000000;"> t1;
</span><span style="color: #0000ff;">alter</span> <span style="color: #0000ff;">table</span> t1 <span style="color: #0000ff;">drop</span> <span style="color: #0000ff;">primary</span> <span style="color: #0000ff;">key</span><span style="color: #000000;">;
​
and工作原理：对于连续多个and：mysql会按照联合索引，从左到右的顺序找一个区分度高的索引字段(这样便可以快速锁定很小的范围)，加速查询
or的工作原理：对于连续多个or：mysql会按照条件的顺序，从左到右依次判断,此时应该按照区分度高低设置联合索引</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">10.192 正确使用索引</span></h4>
<h5 class="md-end-block md-heading"><span class="md-plain">10.1921 索引未命中</span></h5>
<p class="md-end-block md-p"><span class="md-plain">并不是说我们创建了索引就一定会加快查询速度，若想利用索引达到预想的提高查询速度的效果，我们在添加索引时，必须遵循以下问题</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('fa9e7182-4b19-4b21-83ce-45bb7d525e52')"><img id="code_img_closed_fa9e7182-4b19-4b21-83ce-45bb7d525e52" class="code_img_closed" src="./images/python 之 数据库（内置函数、流程控制、索引）0.png" alt="" /><img id="code_img_opened_fa9e7182-4b19-4b21-83ce-45bb7d525e52" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('fa9e7182-4b19-4b21-83ce-45bb7d525e52',event)" src="./images/python 之 数据库（内置函数、流程控制、索引）1.png" alt="" />
<div id="cnblogs_code_open_fa9e7182-4b19-4b21-83ce-45bb7d525e52" class="cnblogs_code_hide">
<pre><code><span style="color: #800000; font-weight: bold;">1</span> 范围问题，或者说条件不明确，条件中出现这些符号或关键字：<span style="color: #808080;">&gt;</span>、<span style="color: #808080;">&gt;=</span>、<span style="color: #808080;">&lt;</span>、<span style="color: #808080;">&lt;=</span>、<span style="color: #808080;">!=</span> 、<span style="color: #808080;">between</span>...<span style="color: #808080;">and</span>...、<span style="color: #808080;">like</span><span style="color: #000000;">、
</span><span style="color: #800000; font-weight: bold;">2</span> 尽量选择区分度高的列作为索引,区分度的公式是count(<span style="color: #0000ff;">distinct</span> col)<span style="color: #808080;">/</span><span style="color: #ff00ff;">count</span>(<span style="color: #808080;">*</span><span style="color: #000000;">)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录
</span><span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">=</span>和in可以乱序，比如a <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">and</span> b <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">and</span> c <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;"> 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式
</span><span style="color: #800000; font-weight: bold;">4</span> 索引列不能参与计算，保持列&ldquo;干净&rdquo;，比如from_unixtime(create_time) <span style="color: #808080;">=</span> &rsquo;<span style="color: #800000; font-weight: bold;">2014</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">05</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">29</span>&rsquo;就不能使用到索引，原因很简单，b<span style="color: #808080;">+</span>树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time <span style="color: #808080;">=</span> unix_timestamp(&rsquo;<span style="color: #800000; font-weight: bold;">2014</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">05</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">29</span><span style="color: #000000;">&rsquo;)
</span><span style="color: #800000; font-weight: bold;">5</span> <span style="color: #808080;">and/or</span><span style="color: #000000;">
#</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">、and与or的逻辑
    条件1 </span><span style="color: #808080;">and</span><span style="color: #000000;"> 条件2:所有条件都成立才算成立，但凡要有一个条件不成立则最终结果不成立
    条件1 </span><span style="color: #808080;">or</span><span style="color: #000000;"> 条件2:只要有一个条件成立则最终结果就成立
#</span><span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">、and的工作原理
    条件：
        a </span><span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">10</span> <span style="color: #808080;">and</span> b <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">xxx</span><span style="color: #ff0000;">'</span> <span style="color: #808080;">and</span> c <span style="color: #808080;">&gt;</span> <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">and</span> d <span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;">
    索引：
        制作联合索引(d,a,b,c)
    工作原理:
        对于连续多个and：mysql会按照联合索引，从左到右的顺序找一个区分度高的索引字段(这样便可以快速锁定很小的范围)，加速查询，即按照d&mdash;</span><span style="color: #808080;">&gt;</span>a<span style="color: #808080;">-&gt;</span>b<span style="color: #808080;">-&gt;</span><span style="color: #000000;">c的顺序
#</span><span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;">、or的工作原理
    条件：
        a </span><span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">10</span> <span style="color: #808080;">or</span> b <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">xxx</span><span style="color: #ff0000;">'</span> <span style="color: #808080;">or</span> c <span style="color: #808080;">&gt;</span> <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">or</span> d <span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;">
    索引：
        制作联合索引(d,a,b,c)       
    工作原理:
        对于连续多个or：mysql会按照条件的顺序，从左到右依次判断，即a</span><span style="color: #808080;">-&gt;</span>b<span style="color: #808080;">-&gt;</span>c<span style="color: #808080;">-&gt;</span><span style="color: #000000;">d,所以应该将区分度高的放在前面
 </span><span style="color: #800000; font-weight: bold;">6</span> 最左前缀匹配原则，非常重要的原则，对于组合索引mysql会一直向右匹配直到遇到范围查询(<span style="color: #808080;">&gt;</span>、<span style="color: #808080;">&lt;</span>、<span style="color: #808080;">between</span>、<span style="color: #808080;">like</span>)就停止匹配(指的是范围大了，有索引速度也慢)，比如 a <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">1</span> <span style="color: #808080;">and</span> b <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">2</span> <span style="color: #808080;">and</span> c <span style="color: #808080;">&gt;</span> <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #808080;">and</span> d <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;"> 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。所以建立索引时将关于范围比较的字段放在后面
</span><span style="color: #800000; font-weight: bold;">7</span><span style="color: #000000;"> 其他情况
</span><span style="color: #808080;">-</span><span style="color: #000000;"> 使用函数
    </span><span style="color: #0000ff;">select</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">from</span> tb1 <span style="color: #0000ff;">where</span> <span style="color: #ff00ff;">reverse</span>(email) <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">egon</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;           
</span><span style="color: #808080;">-</span><span style="color: #000000;"> 类型不一致
    如果列是字符串类型，传入条件是必须用引号引起来，不然...
    </span><span style="color: #0000ff;">select</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">from</span> tb1 <span style="color: #0000ff;">where</span> email <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">999</span><span style="color: #000000;">;  
#排序条件为索引，则select字段必须也是索引字段，否则无法命中
</span><span style="color: #808080;">-</span> <span style="color: #0000ff;">order</span> <span style="color: #0000ff;">by</span>
    <span style="color: #0000ff;">select</span> name <span style="color: #0000ff;">from</span> s1 <span style="color: #0000ff;">order</span> <span style="color: #0000ff;">by</span> email <span style="color: #0000ff;">desc</span><span style="color: #000000;">;
    当根据索引排序时候，select查询的字段如果不是索引，则速度仍然很慢
    </span><span style="color: #0000ff;">select</span> email <span style="color: #0000ff;">from</span> s1 <span style="color: #0000ff;">order</span> <span style="color: #0000ff;">by</span> email <span style="color: #0000ff;">desc</span><span style="color: #000000;">;
    特别的：如果对主键排序，则还是速度很快：
    </span><span style="color: #0000ff;">select</span> <span style="color: #808080;">*</span> <span style="color: #0000ff;">from</span> tb1 <span style="color: #0000ff;">order</span> <span style="color: #0000ff;">by</span> nid <span style="color: #0000ff;">desc</span><span style="color: #000000;">;
</span><span style="color: #808080;">-</span><span style="color: #000000;"> 组合索引最左前缀
    如果组合索引为：(name,email)
    name </span><span style="color: #808080;">and</span> email       <span style="color: #008080;">--</span><span style="color: #008080;"> 命中索引</span>
    name                 <span style="color: #008080;">--</span><span style="color: #008080;"> 命中索引</span>
    email                <span style="color: #008080;">--</span><span style="color: #008080;"> 未命中索引</span>
<span style="color: #808080;">-</span> <span style="color: #ff00ff;">count</span>(<span style="color: #800000; font-weight: bold;">1</span>)或count(列)代替count(<span style="color: #808080;">*</span><span style="color: #000000;">)在mysql中没有差别了
</span><span style="color: #808080;">-</span> <span style="color: #0000ff;">create</span> <span style="color: #0000ff;">index</span> xxxx  <span style="color: #0000ff;">on</span> tb(title(<span style="color: #800000; font-weight: bold;">19</span>)) #text类型，必须制定长度</pre>
</div>
<span class="cnblogs_code_collapse">索引未命中</span></div>
<h5 class="md-end-block md-heading"><span class="md-plain">10.1922 其他注意事项</span></h5>
<div class="cnblogs_code">
<pre><code><span style="color: #800000; font-weight: bold;">1</span> 避免使用select <span style="color: #808080;">*</span>
<span style="color: #800000; font-weight: bold;">2</span> <span style="color: #ff00ff;">count</span>(<span style="color: #800000; font-weight: bold;">1</span>)或count(列) 代替 <span style="color: #ff00ff;">count</span>(<span style="color: #808080;">*</span><span style="color: #000000;">)
</span><span style="color: #800000; font-weight: bold;">3</span> 创建表时尽量时 <span style="color: #0000ff;">char</span> 代替 <span style="color: #0000ff;">varchar</span>
<span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;"> 表的字段顺序固定长度的字段优先
</span><span style="color: #800000; font-weight: bold;">5</span><span style="color: #000000;"> 组合索引代替多个单列索引（经常使用多个条件查询时）
</span><span style="color: #800000; font-weight: bold;">6</span><span style="color: #000000;"> 尽量使用短索引
</span><span style="color: #800000; font-weight: bold;">7</span> 使用连接（<span style="color: #808080;">JOIN</span>）来代替子查询(Sub<span style="color: #808080;">-</span><span style="color: #000000;">Queries)
</span><span style="color: #800000; font-weight: bold;">8</span><span style="color: #000000;"> 连表时注意条件类型需一致
</span><span style="color: #800000; font-weight: bold;">9</span> 索引散列值不适合建索引，例：性别不适合</pre>
</div>
<p class="md-end-block md-p"><span><strong>总结：</strong></span></p>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">一定是为搜索条件的字段创建索引，比如select * from s1 where id = 333;就需要为id加上索引</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">在表中已经有大量数据的情况下，建索引会很慢，且占用硬盘空间，建完后查询速度加快</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">需要注意的是：innodb表的索引会存放于s1.ibd文件中，而myisam表的索引则会有单独的索引文件table1.MYI</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">10.193 慢查询优化的基本步骤</span></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #800000; font-weight: bold;">0</span><span style="color: #000000;">.先运行看看是否真的很慢，注意设置SQL_NO_CACHE
</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">.where条件单表查，锁定最小返回记录表。这句话的意思是把查询语句的where都应用到表中返回的记录数最小的表开始查起，单表每个字段分别查询，看哪个字段的区分度最高
</span><span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">.explain查看执行计划，是否与1预期一致（从锁定记录较少的表开始查询）
</span><span style="color: #800000; font-weight: bold;">3</span>.<span style="color: #0000ff;">order</span> <span style="color: #0000ff;">by</span><span style="color: #000000;"> limit 形式的sql语句让排序的表优先查
</span><span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;">.了解业务方使用场景
</span><span style="color: #800000; font-weight: bold;">5</span><span style="color: #000000;">.加索引时参照建索引的几大原则
</span><span style="color: #800000; font-weight: bold;">6</span>.观察结果，不符合预期继续从0分析</pre>
</div>
<p>10.194&nbsp;慢日志管理</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"> 慢日志
            </span><span style="color: #808080;">-</span> 执行时间 <span style="color: #808080;">&gt;</span> <span style="color: #800000; font-weight: bold;">10</span>
            <span style="color: #808080;">-</span><span style="color: #000000;"> 未命中索引
            </span><span style="color: #808080;">-</span><span style="color: #000000;"> 日志文件路径
            
        配置：
            </span><span style="color: #808080;">-</span><span style="color: #000000;"> 内存
                show variables </span><span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%query%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
                show variables </span><span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%queries%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">set</span> global 变量名 <span style="color: #808080;">=</span><span style="color: #000000;"> 值
            </span><span style="color: #808080;">-</span><span style="color: #000000;"> 配置文件
                mysqld </span><span style="color: #008080;">--</span><span style="color: #008080;">defaults-file='E:\wupeiqi\mysql-5.7.16-winx64\mysql-5.7.16-winx64\my-default.ini'</span>
<span style="color: #000000;">                
                my.conf内容：
                    slow_query_log </span><span style="color: #808080;">=</span> <span style="color: #0000ff;">ON</span><span style="color: #000000;">
                    slow_query_log_file </span><span style="color: #808080;">=</span> D:<span style="color: #808080;">/</span><span style="color: #000000;">....
                    
                注意：修改配置文件之后，需要重启服务</span></pre>
</div>
<div class="cnblogs_code" onclick="cnblogs_code_show('d2431818-a7c0-4993-a1ca-48ba71fa028c')"><img id="code_img_closed_d2431818-a7c0-4993-a1ca-48ba71fa028c" class="code_img_closed" src="./images/python 之 数据库（内置函数、流程控制、索引）0.png" alt="" /><img id="code_img_opened_d2431818-a7c0-4993-a1ca-48ba71fa028c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d2431818-a7c0-4993-a1ca-48ba71fa028c',event)" src="./images/python 之 数据库（内置函数、流程控制、索引）1.png" alt="" />
<div id="cnblogs_code_open_d2431818-a7c0-4993-a1ca-48ba71fa028c" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">MySQL日志管理
</span><span style="color: #808080;">========================================================</span><span style="color: #000000;">
错误日志: 记录 MySQL 服务器启动、关闭及运行错误等信息
二进制日志: 又称binlog日志，以二进制文件的方式记录数据库中除 </span><span style="color: #0000ff;">SELECT</span><span style="color: #000000;"> 以外的操作
查询日志: 记录查询的信息
慢查询日志: 记录执行时间超过指定时间的操作
中继日志： 备库将主库的二进制日志复制到自己的中继日志中，从而在本地进行重放
通用日志： 审计哪个账号、在哪个时段、做了哪些事件
事务日志或称redo日志： 记录Innodb事务相关的如事务执行时间、检查点等
</span><span style="color: #808080;">========================================================</span><span style="color: #000000;">
一、bin</span><span style="color: #808080;">-</span><span style="color: #ff00ff;">log</span>
<span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">. 启用
# vim </span><span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span>bin<span style="color: #ff0000;">[</span><span style="color: #ff0000;">=dir\[filename</span><span style="color: #ff0000;">]</span><span style="color: #000000;">]
# service mysqld restart
</span><span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">. 暂停
</span><span style="color: #808080;">//</span><span style="color: #000000;">仅当前会话
</span><span style="color: #0000ff;">SET</span> SQL_LOG_BIN<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">0</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">SET</span> SQL_LOG_BIN<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">;
</span><span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;">. 查看
查看全部：
# mysqlbinlog mysql.</span><span style="color: #800000; font-weight: bold;">000002</span><span style="color: #000000;">
按时间：
# mysqlbinlog mysql.</span><span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">start-datetime="2012-12-05 10:02:56"</span>
# mysqlbinlog mysql.<span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">stop-datetime="2012-12-05 11:02:54"</span>
# mysqlbinlog mysql.<span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">start-datetime="2012-12-05 10:02:56" --stop-datetime="2012-12-05 11:02:54" </span>
<span style="color: #000000;">
按字节数：
# mysqlbinlog mysql.</span><span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">start-position=260</span>
# mysqlbinlog mysql.<span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">stop-position=260</span>
# mysqlbinlog mysql.<span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #008080;">--</span><span style="color: #008080;">start-position=260 --stop-position=930</span>
<span style="color: #800000; font-weight: bold;">4</span>. 截断bin<span style="color: #808080;">-</span><span style="color: #ff00ff;">log</span>（产生新的bin<span style="color: #808080;">-</span><span style="color: #000000;">log文件）
a. 重启mysql服务器
b. # mysql </span><span style="color: #808080;">-</span>uroot <span style="color: #808080;">-</span>p123 <span style="color: #808080;">-</span>e <span style="color: #ff0000;">'</span><span style="color: #ff0000;">flush logs</span><span style="color: #ff0000;">'</span>
<span style="color: #800000; font-weight: bold;">5</span>. 删除bin<span style="color: #808080;">-</span><span style="color: #000000;">log文件
# mysql </span><span style="color: #808080;">-</span>uroot <span style="color: #808080;">-</span>p123 <span style="color: #808080;">-</span>e <span style="color: #ff0000;">'</span><span style="color: #ff0000;">reset master</span><span style="color: #ff0000;">'</span><span style="color: #000000;"> 


二、查询日志
启用通用查询日志
# vim </span><span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #ff00ff;">log</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">=dir\[filename</span><span style="color: #ff0000;">]</span><span style="color: #000000;">]
# service mysqld restart

三、慢查询日志
启用慢查询日志
# vim </span><span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span>slow<span style="color: #808080;">-</span>queries<span style="color: #ff0000;">[</span><span style="color: #ff0000;">=dir\[filename</span><span style="color: #ff0000;">]</span><span style="color: #000000;">]
long_query_time</span><span style="color: #808080;">=</span><span style="color: #000000;">n
# service mysqld restart
MySQL </span><span style="color: #800000; font-weight: bold;">5.6</span><span style="color: #000000;">:
slow</span><span style="color: #808080;">-</span>query<span style="color: #808080;">-</span><span style="color: #ff00ff;">log</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">
slow</span><span style="color: #808080;">-</span>query<span style="color: #808080;">-</span><span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span><span style="color: #0000ff;">file</span><span style="color: #808080;">=</span>slow.<span style="color: #ff00ff;">log</span><span style="color: #000000;">
long_query_time</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;">
查看慢查询日志
测试:BENCHMARK(</span><span style="color: #ff00ff;">count</span><span style="color: #000000;">,expr)
</span><span style="color: #0000ff;">SELECT</span> BENCHMARK(<span style="color: #800000; font-weight: bold;">50000000</span>,<span style="color: #800000; font-weight: bold;">2</span><span style="color: #808080;">*</span><span style="color: #800000; font-weight: bold;">3</span>);</pre>
</div>
<span class="cnblogs_code_collapse">MySQL日志管理</span></div>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>