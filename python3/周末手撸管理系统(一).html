<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修周末手撸管理系统(一)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>周末手撸管理系统(一)</center></div><div class='banquan'>原文出处:本文由博客园博主小小咸鱼YwY提供。<br/>
原文连接:https://www.cnblogs.com/pythonywy/p/11483157.html</div><br>
    <h1 id="周末手撸管理系统一">周末手撸管理系统(一)</h1>
<p>已完成</p>
<p>大体模板</p>
<ul>
<li>用户登入注册</li>
</ul>
<p>明天加商品订单商品进去</p>
<p>完成效果图</p>
<p><code>注册</code></p>
<p><img src="./images/周末手撸管理系统(一)0.png" /></p>
<p><code>登入</code></p>
<p><img src="./images/周末手撸管理系统(一)1.png" /></p>
<h2 id="首先进行设置">1.首先进行设置</h2>
<p><code>settings.py</code></p>
<pre><code><code>&quot;&quot;&quot;
Django settings for drf_test project.

Generated by &#39;django-admin startproject&#39; using Django 1.11.22.

For more information on this file, see
https://docs.djangoproject.com/en/1.11/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.11/ref/settings/
&quot;&quot;&quot;

import os
# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = &#39;ppa5l3jvxr4k^ow*4o+0_^7@&amp;sa3x+!hb_$artwraa%60iq@g7&#39;

# SECURITY WARNING: don&#39;t run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    &#39;django.contrib.admin&#39;,
    &#39;django.contrib.auth&#39;,
    &#39;django.contrib.contenttypes&#39;,
    &#39;django.contrib.sessions&#39;,
    &#39;django.contrib.messages&#39;,
    &#39;django.contrib.staticfiles&#39;,
    &#39;drf_api&#39;,
]

MIDDLEWARE = [
    &#39;django.middleware.security.SecurityMiddleware&#39;,
    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
    &#39;django.middleware.common.CommonMiddleware&#39;,
    # &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
]

ROOT_URLCONF = &#39;drf_test.urls&#39;

TEMPLATES = [
    {
        &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,
        &#39;DIRS&#39;: [os.path.join(BASE_DIR, &#39;templates&#39;)]
        ,
        &#39;APP_DIRS&#39;: True,
        &#39;OPTIONS&#39;: {
            &#39;context_processors&#39;: [
                &#39;django.template.context_processors.debug&#39;,
                &#39;django.template.context_processors.request&#39;,
                &#39;django.contrib.auth.context_processors.auth&#39;,
                &#39;django.contrib.messages.context_processors.messages&#39;,
            ],
        },
    },
]

WSGI_APPLICATION = &#39;drf_test.wsgi.application&#39;


# Database
# https://docs.djangoproject.com/en/1.11/ref/settings/#databases

DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,
        &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;),
    }
}


# Password validation
# https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;,
    },
]


# Internationalization
# https://docs.djangoproject.com/en/1.11/topics/i18n/

LANGUAGE_CODE = &#39;en-us&#39;

TIME_ZONE = &#39;UTC&#39;

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.11/howto/static-files/

STATIC_URL = &#39;/static/&#39;
STATICFILES_DIRS=(os.path.join(BASE_DIR,&#39;static&#39;),)
AUTH_USER_MODEL = &quot;drf_api.UserInfo&quot;
MEDIA_URL  = &quot;/img/&quot;
MEDIA_ROOT = os.path.join(BASE_DIR, &quot;img&quot;)</code></pre>
<h2 id="创建模型以及form组件">2.创建模型以及form组件</h2>
<p><code>models.py</code></p>
<pre><code><code>from django.db import models
from django.contrib.auth.models import AbstractUser
# Create your models here.
class UserInfo(AbstractUser):
    avatar = models.FileField(upload_to=&#39;avatar/&#39;, default=&#39;avatar/default.png&#39;)
    class Meta:
        verbose_name=&#39;用户表&#39;
        verbose_name_plural = verbose_name</code></pre>
<p>userinfo_form.py</p>
<pre><code><code>from django import forms
from django.forms import widgets

from django.core.exceptions import ValidationError

from drf_api import models

class Register(forms.Form):
    username=forms.CharField(max_length=18,min_length=3,label=&quot;用户名&quot;,
                         error_messages={&#39;max_length&#39;:&#39;太长了&#39;,
                                         &#39;min_length&#39;:&#39;太短了&#39;,
                                         &#39;required&#39;:&#39;不能为空&#39;},
                            widget=widgets.TextInput(attrs={&#39;class&#39;:&#39;form-control&#39;}),
                         )
    password=forms.CharField(max_length=18,min_length=3,label=&quot;密码&quot;,
                         error_messages={&#39;max_length&#39;:&#39;太长了&#39;,
                                         &#39;min_length&#39;:&#39;太短了&#39;,
                                         &#39;required&#39;:&#39;不能为空&#39;},
                            widget=widgets.PasswordInput(attrs={&#39;class&#39;:&#39;form-control&#39;}),
                         )
    re_pwd=forms.CharField(max_length=18,min_length=3,label=&quot;确认密码&quot;,
                         error_messages={&#39;max_length&#39;:&#39;太长了&#39;,
                                         &#39;min_length&#39;:&#39;太短了&#39;,
                                         &#39;required&#39;:&#39;不能为空&#39;},
                            widget=widgets.PasswordInput(attrs={&#39;class&#39;:&#39;form-control&#39;}),
                         )
    email=forms.EmailField(max_length=18,min_length=3,label=&quot;邮箱&quot;,
                         error_messages={&#39;max_length&#39;:&#39;太长了&#39;,
                                         &#39;min_length&#39;:&#39;太短了&#39;,
                                         &#39;required&#39;:&#39;不能为空&#39;},
                            widget=widgets.EmailInput(attrs={&#39;class&#39;:&#39;form-control&#39;}),
                         )
    def clean_username(self):
        name=self.cleaned_data.get(&#39;username&#39;)
        user=models.UserInfo.objects.filter(username=name).first()
        if user:
            raise ValidationError(&#39;用户已经存在&#39;)
        else:
            return name

    def clean(self):
        pwd=self.cleaned_data.get(&#39;password&#39;)
        r_pwd=self.cleaned_data.get(&#39;re_pwd&#39;)
        if pwd==r_pwd:
            return self.cleaned_data
        else:
            raise ValidationError(&#39;两次密码不一致&#39;)</code></pre>
<h2 id="页面">3.页面</h2>
<p><code>母版</code></p>
<p><code>template.html</code></p>
<pre class="html"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/bootstrap-3.3.7-dist/css/bootstrap.min.css&quot;&gt;
    &lt;script src=&quot;/static/jquery-3.4.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/static/bootstrap-3.3.7-dist/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;title&gt;{% block title_text %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;style&gt;
    .header {
        position: fixed;
        top: 0;
        left: 0;
        height: 100px;
        width: 100%;
        background: red;
    }
    .header_left{

        position: absolute;
        line-height: 100px;
        font-size: 50px;
        width:20% ;
        text-align: center;
        background: black;
        color: white;
    }
    .header_right{
        float: right;
                line-height: 100px;
    }
    .body {
        position: fixed;
        top: 100px;
        left: 0;
        bottom: 20px;
        width: 100%;
    }

    .body_left {
        position: fixed;
        top: 100px;
        left: 0;
        bottom: 20px;
        width: 20%;
        background: white;
    }
    .body_right {
        overflow: auto;
        position: fixed;
        top: 100px;
        left: 20%;
        bottom: 20px;
        width: 80%;
        background: #2aabd2;
    }

    .footer {
        position: fixed;
        left: 0;
        bottom: 0;
        height: 20px;
        width: 100%;
        background: black;
    }
&lt;/style&gt;
{% block new_css %}
{% endblock %}
&lt;body&gt;
&lt;div class=&quot;header&quot;&gt;
    &lt;div class=&quot;header_left&quot;&gt;管理系统&lt;/div&gt;
    &lt;div class=&quot;header_right&quot;&gt;
        &lt;a href=&quot;http://127.0.0.1:8000/login/&quot;&gt;登入&lt;/a&gt;
        &lt;a href=&quot;http://127.0.0.1:8000/register/&quot;&gt;注册&lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;body&quot;&gt;
    &lt;div class=&quot;body_left&quot;&gt;
        &lt;ul class=&quot;nav nav-pills nav-stacked nav-pills-stacked-example&quot;&gt;
      &lt;li role=&quot;presentation&quot; class=&quot;active&quot;&gt;&lt;a&gt;库存管理&lt;/a&gt;&lt;/li&gt;
         &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;查看商品&lt;/a&gt;&lt;/li&gt;
      &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;添加商品&lt;/a&gt;&lt;/li&gt;
      &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;删除商品&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
                &lt;ul class=&quot;nav nav-pills nav-stacked nav-pills-stacked-example&quot;&gt;
      &lt;li role=&quot;presentation&quot; class=&quot;active&quot;&gt;&lt;a&gt;订单管理&lt;/a&gt;&lt;/li&gt;
       &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;查看订单&lt;/a&gt;&lt;/li&gt;
      &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;添加订单&lt;/a&gt;&lt;/li&gt;
      &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;删除订单&lt;/a&gt;&lt;/li&gt;
      &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;#&quot;&gt;订单号快速查询&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;/div&gt;
    &lt;div class=&quot;body_right&quot;&gt;
        {% block data %}
        {% endblock %}
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;footer&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
{% block new_js %}
{% endblock %}</code></pre>
<p><code>登入</code></p>
<p><code>login.html</code></p>
<pre class="html"><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    登入
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;div class=&quot;container-fluid center-block&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;
                {% csrf_token %}
                &lt;h1&gt;登陆&lt;/h1&gt;
                &lt;form action=&quot;&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_name&quot;&gt;用户名&lt;/label&gt;
                        &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;id_name&quot; class=&quot;form-control&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;pwd&quot;&gt;密码&lt;/label&gt;
                        &lt;input type=&quot;password&quot; name=&quot;pwd&quot; id=&quot;pwd&quot; class=&quot;form-control&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_code&quot;&gt;验证码&lt;/label&gt;
                        &lt;div class=&quot;row&quot;&gt;
                            &lt;div class=&quot;col-md-6&quot;&gt;
                                &lt;input type=&quot;text&quot; name=&quot;code&quot; id=&quot;id_code&quot; class=&quot;form-control&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;col-md-6&quot; id=&quot;img&quot;&gt;
                                &lt;img src=&quot;/get_code/&quot; height=&quot;40&quot; width=&quot;240&quot; class=&quot;img-code&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;input type=&quot;button&quot; value=&quot;提交&quot; class=&quot;btn-success&quot; id=&quot;up_data&quot;&gt;
                    &lt;span style=&quot;color: red&quot; id=&quot;msg&quot;&gt;&lt;/span&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        $(&#39;.img-code&#39;).click(function () {
            var img_code_src = $(this).attr(&#39;src&#39;);
            img_code_src += &#39;1&#39;;
            console.log(img_code_src);
            $(this).attr(&#39;src&#39;, img_code_src)
        })
    &lt;/script&gt;

    &lt;script&gt;
        $(&#39;#up_data&#39;).click(function () {
            $.ajax({
                type: &#39;post&#39;,
                url: &#39;/login/&#39;,
                data: {
                    &#39;name&#39;: $(&#39;#id_name&#39;).val(),
                    &#39;pwd&#39;: $(&#39;#pwd&#39;).val(),
                    &#39;code&#39;: $(&#39;#id_code&#39;).val(),
                    &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                },
                success: function (msg) {
                    console.log(msg);
                    $(&#39;#msg&#39;).text(msg);
                    if (msg == &#39;登入成功&#39;) {
                        console.log(&#39;sb&#39;);
                        window.location.replace(&#39;http://www.baidu.com&#39;);
                    }
                }
            })
        })
    &lt;/script&gt;
{% endblock %}</code></pre>
<p><code>登入</code></p>
<p><code>register.html</code></p>
<pre class="html"><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    注册
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;

                &lt;h1&gt;注册&lt;/h1&gt;
                &lt;form id=&quot;my_form&quot;&gt;
                    {% for foo in form %}
                        &lt;div class=&quot;form-group&quot;&gt;
                            &lt;label for=&quot;{{ foo.auto_id }}&quot;&gt;{{ foo.label }}&lt;/label&gt;
                            {{ foo }} &lt;span style=&quot;color: red&quot; class=&quot;error pull-right&quot;&gt;&lt;/span&gt;
                        &lt;/div&gt;

                    {% endfor %}
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_file&quot;&gt;头像
                            &lt;img src=&quot;/img/avatar/default.png&quot; width=&quot;80&quot; height=&quot;80&quot; style=&quot;margin-left: 20px&quot;
                                 id=&quot;id_img&quot;&gt;
                        &lt;/label&gt;


                        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;id_file&quot; style=&quot;display: none&quot;&gt;
                    &lt;/div&gt;
                    &lt;input type=&quot;button&quot; class=&quot;btn btn-success&quot; value=&quot;提交&quot; id=&quot;id_submit&quot;&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        $(&quot;#id_file&quot;).change(function () {
            var file = $(&quot;#id_file&quot;)[0].files[0]
            var filereader = new FileReader()
            filereader.readAsDataURL(file)
            filereader.onload = function () {
                $(&quot;#id_img&quot;).attr(&#39;src&#39;, filereader.result)
            }
        })
        $(&quot;#id_submit&quot;).click(function () {
            var formdata = new FormData()
            var my_form_data = $(&quot;#my_form&quot;).serializeArray()
            $.each(my_form_data, function (k, v) {
                {#console.log(k)#}
                {#console.log(v)#}
                formdata.append(v.name, v.value)
            })
            formdata.append(&#39;avatar&#39;, $(&quot;#id_file&quot;)[0].files[0])


            $.ajax({
                url: &#39;/register/&#39;,
                type: &#39;post&#39;,
                processData: false, 
                contentType: false,
                data: formdata,
                success: function (data) {
                    //console.log(data)
                    if (data.code == 100) {
                        location.href = &#39;/login/&#39;
                    } else if (data.code == 101) {
                        $.each(data.msg, function (k, v) {
                            console.log(k)
                            console.log(v)
                            $(&quot;#id_&quot; + k).next().html(v[0])
                            if (k == &#39;__all__&#39;) {
                                $(&quot;#id_re_pwd&quot;).next().html(v[0])
                            }
                        })
                    }
                    //定时器
                    setTimeout(function () {
                        $(&quot;.error&quot;).html(&quot;&quot;)
                    }, 3000)
                }
            })
        })
    &lt;/script&gt;
{% endblock %}</code></pre>
<h2 id="路由">4.路由</h2>
<p><code>urls.py</code></p>
<pre><code><code>from django.conf.urls import url
from django.contrib import admin
from drf_api import views
from django.views.static import serve
from .settings import MEDIA_ROOT
urlpatterns = [
    url(r&#39;^admin/&#39;, admin.site.urls),
    url(r&#39;^register/&#39;, views.register),
    url(r&#39;^login/&#39;, views.login),
    url(r&#39;^get_code/&#39;, views.get_code),
    url(r&#39;^img/(?P&lt;path&gt;.*)&#39;, serve, {&#39;document_root&#39;: MEDIA_ROOT}),
]</code></pre>
<h2 id="视图">5.视图</h2>
<pre><code><code>from django.shortcuts import render,HttpResponse,redirect
from django.http import JsonResponse

from PIL import Image,ImageDraw,ImageFont
import random

from io import BytesIO

from django.contrib import auth

from drf_api.userinfo_form import Register
from drf_api import models







def register(request):
    if request.method==&#39;GET&#39;:
        form=Register()
        return render(request,&#39;register.html&#39;,{&#39;form&#39;:form})
    elif request.is_ajax():
        response={&#39;code&#39;:100,&#39;msg&#39;:None}
        form = Register(request.POST)
        if form.is_valid():
            #校验通过的数据
            clean_data=form.cleaned_data
            #把re_pwd剔除
            clean_data.pop(&#39;re_pwd&#39;)
            #取出头像
            avatar=request.FILES.get(&#39;avatar&#39;)
            if avatar:
                clean_data[&#39;avatar&#39;]=avatar
            user=models.UserInfo.objects.create_user(**clean_data)
            if user:
                response[&#39;msg&#39;] = &#39;创建成功&#39;
            else:
                response[&#39;code&#39;] = 103
                response[&#39;msg&#39;] = &#39;创建失败&#39;
        else:
            response[&#39;code&#39;]=101
            #把校验不通过的数据返回
            response[&#39;msg&#39;]=form.errors
            print(type(form.errors))
        return JsonResponse(response,safe=False)


def login(request):
    if request.method==&#39;GET&#39;:
        return render(request,&#39;login.html&#39;)
    else:
        print(request.POST)
        user_name=request.POST.get(&#39;name&#39;)
        pwd=request.POST.get(&#39;pwd&#39;)
        code=request.POST.get(&#39;code&#39;)

        user=auth.authenticate(username=user_name,password=pwd)
        print(user)
        if request.session.get(&#39;code&#39;).upper() !=code.upper(): #忽略大小写
            return HttpResponse(&#39;验证码错误&#39;)
        elif not user:
            return HttpResponse(&#39;账号密码错误&#39;)
        else:
            auth.login(request,user)
            return HttpResponse(&#39;登入成功&#39;)



def get_code(request):
    if request.method == &#39;GET&#39;:
        img = Image.new(&#39;RGB&#39;, (350, 40), (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
        # 写文字
        # 生成一个字体对象
        font = ImageFont.truetype(&#39;/static/Gabriola.ttf&#39;, 34)
        # 调用方法，返回一个画板对象
        draw = ImageDraw.Draw(img)

        new_text =&#39;&#39;
        # 生成随机8位数字
        for x_index in range(1, 8):
            num = chr(random.randint(48, 57))
            word = chr(random.randint(65, 90))
            word_1 = chr(random.randint(97, 122))
            text =random.choice((num, word, word_1))
            draw.text((x_index * 32, 0),text, font=font)
            new_text +=text

        # 加点线
        width = 320
        height = 35
        for i in range(5):
            x1 = random.randint(0, width)
            x2 = random.randint(0, width)
            y1 = random.randint(0, height)
            y2 = random.randint(0, height)
            # 在图片上画线
            draw.line((x1, y1, x2, y2), fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))

        for i in range(33):
            # 画点
            draw.point([random.randint(0, width), random.randint(0, height)], fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
            x = random.randint(0, width)
            y = random.randint(0, height)
            # 画弧形
            draw.arc((x, y, x + 4, y + 4), 0, 90, fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
        print(new_text)
        #存在session中
        request.session[&#39;code&#39;]=new_text
        #存内存
        f = BytesIO()
        img.save(f, &#39;png&#39;)
        return HttpResponse(f.getvalue())</code></pre>
<p><code>大家周末娱乐</code></p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>