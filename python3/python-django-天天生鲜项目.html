<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修python-django-天天生鲜项目' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>python-django-天天生鲜项目</center></div><div class='banquan'>原文出处:本文由博客园博主我不会来几次提供。<br/>
原文连接:https://www.cnblogs.com/xiaodaima/p/11245292.html</div><br>
    <h3>1 需求分析</h3>
<p>github源码：<a href="https://www.github.com/wangyingchuang/dailyfresh" target="_blank">https://www.github.com/wangyingchuang/dailyfresh</a></p>
<p>&nbsp;</p>
<h4>1.1&nbsp; 用户模块</h4>
<p>1） 注册页</p>
<p>l&nbsp; 注册时校验用户名是否已被注册。</p>
<p>l&nbsp; 完成用户信息的注册</p>
<p>l&nbsp; 给用户的注册邮箱发送邮件，用户点击邮件中的激活链接完成用户账户的激活。</p>
<p>2）登陆页</p>
<p>l&nbsp; 实现用户的登录功能</p>
<p>3）用户中心</p>
<p>l&nbsp; 用户中心信息页，显示登录用户的信息，包括用户名、电话和地址，同时页面下方显示出用户最近浏览的商品信息。</p>
<p>l&nbsp; 用户中心地址页：显示登陆用户的默认收件地址，页面下方的表单可以新增用户的收货地址。</p>
<p>l&nbsp; 用户中心订单页：显示登录用户的订单信息。</p>
<p>4）其他</p>
<p>l&nbsp; 如果用户已经登陆，页面顶部显示用户的订单信息。</p>
<h4>1.2&nbsp; 商品模块</h4>
<p>1）首页</p>
<p>l&nbsp; 动态指定首页轮播商品信息。</p>
<p>l&nbsp; 动态指定首页活动信息。</p>
<p>l&nbsp; 动态获取商品的种类信息并显示。</p>
<p>l&nbsp; 动态指定首页显示的每个种类的商品（包括图片商品的文字商品）。</p>
<p>l&nbsp; 点击某一个商品时跳转到商品的详情页面。</p>
<p>2）商品详情页</p>
<p>l&nbsp; 显示出某个商品的详细信息。</p>
<p>l&nbsp; 页面下方显示出该商品的两个新品信息。</p>
<p>3）商品列表页</p>
<p>l&nbsp; 显示出某一个种类的商品的列表数据，分页显示并支持按照默认、价格和人气进行排序。</p>
<p>l&nbsp; 页面下方显示出该商品的两个新品信息。</p>
<p>4）其他</p>
<p>l&nbsp; 通过搜索框搜索商品信息。</p>
<h4>1.3&nbsp; 购物车模块</h4>
<p>l&nbsp; 列表页和详情页将商品添加到购物车。</p>
<p>l&nbsp; 用户登录后，首页，详情页，列表页显示用户购物车中的商品数目。</p>
<p>l&nbsp; 购物车页面：对用户购物车中的商品操作。如选择某件商品，增加或减少购物车中的商品数目。</p>
<h4>1.4&nbsp; 订单相关</h4>
<p>l&nbsp; 提交订单页面：显示用户准备购买的商品信息。</p>
<p>l&nbsp; 点击提交订单完成订单的创建。</p>
<p>l&nbsp; 用户中心订单页显示用户的订单信息。</p>
<p>l&nbsp; 点击支付完成订单的支付。</p>
<p>l&nbsp; 点击评价完成订单的评价。</p>
<p>&nbsp;</p>
<h3>2&nbsp; 项目架构概览</h3>
<h4>2.1&nbsp; 页面图</h4>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目0.png" alt="" width="474" height="245" /></p>
<h4>2.2&nbsp; 功能图</h4>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目1.png" alt="" /></p>
<p>&nbsp;</p>
<h4>2.3&nbsp; 部署图</h4>
<p>&nbsp;</p>
<h3>3&nbsp; 数据库设计</h3>
<h4>3.1&nbsp; 实体类图</h4>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目2.png" alt="" width="724" height="428" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>4 开发环境和工具</h3>
<p>ubuntu18.4</p>
<p>python&gt;3.6</p>
<p>Django == 2.2&nbsp;</p>
<p>pychram</p>
<p>redis</p>
<p>mysql 5.7</p>
<p>celery</p>
<p>fastDFS</p>
<p>nginx</p>
<p>Django-haystack</p>
<p>whoosh</p>
<p>jieba</p>
<p>alipay</p>
<p>requests</p>
<h3>5 配置项目环境</h3>
<h4>5.1 配置mysql数据库环境</h4>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目3.png" alt="" /></p>
<p>&nbsp;</p>
<h4>5.2 配置缓存路径--redis数据库环境</h4>
<p>缓存存到redis数据库里</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目4.png" alt="" /></p>
<p>&nbsp;</p>
<h4>5.3 配置session存储方式</h4>
<p>存到缓存</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目5.png" alt="" /></p>
<p>&nbsp;</p>
<h4>5.4 发送邮件配置</h4>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目6.png" alt="" /></p>
<p>&nbsp;</p>
<h4>5.5 配置fastDFS 和 nginx</h4>
<p>参考<a href="https://blog.csdn.net/weixin_42149982/article/details/82391218">https://blog.csdn.net/weixin_42149982/article/details/82391218</a></p>
<p>l&nbsp; <strong>与python</strong><strong>进行交互</strong></p>
<p><strong>Dailyfresh/settings.py</strong></p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目7.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>Utils/fast/storage.py</strong></p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目8.png" alt="" /></p>
<p>&nbsp;</p>
<h4>5.6 配置celery</h4>
<p>Celery_tasks/tasks.py</p>
<p>Celery 官网：<a href="http://www.celeryproject.org/">http://www.celeryproject.org</a><br />
Celery 官方文档英文版：<a href="http://docs.celeryproject.org/en/latest/index.html">http://docs.celeryproject.org/en/latest/index.html</a><br />
Celery 官方文档中文版：<a href="http://docs.jinkan.org/docs/celery">http://docs.jinkan.org/docs/celery</a></p>
<p>celery配置：<a href="http://docs.jinkan.org/docs/celery/configuration.html#configuration">http://docs.jinkan.org/docs/celery/configuration.html#configuration</a></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目9.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>启动celery</p>
<p>Celery -A celery_task.tasks worker -l info</p>
<h4>5.7 配置Django-haystack + whoosh +
jieba</h4>
<p>详细步骤：<a href="https://blog.csdn.net/abc_soul/article/details/88641269">https://blog.csdn.net/abc_soul/article/details/88641269</a></p>
<p>&nbsp;</p>
<p>Pip3 install Django-haystack</p>
<p>Pip3 install whoosh</p>
<p>Pip3 install jieba</p>
<p>首先是把 django haystack 加入到
INSTALLED_APPS 选项里,再添加配置， django haystack 规定。要相对某个 app 下的数据进行全文检索，就要在该 app 下创建一个
search_indexes.py 文件，然后创建一个 XXIndex 类（XX 为含有被检索数据的模型，如这里的 Test），并且继承
SearchIndex 和 Indexable。我们使用数据模板去建立搜索引擎索引的文件，接下来就是配置 URL，修改一下搜索表单，让它提交数据到 django haystack 搜索视图对应的 URL，使用 Whoosh 作为搜索引擎， haystack_search 视图函数会将搜索结果传递给模板 search/search.html，因此创建这个模板文件，对搜索结果进行简单渲染，但在 django
haystack 中为 Whoosh 指定的分词器是英文分词器，可能会使得搜索结果不理想，我们把这个分词器替换成 jieba 中文分词器，最后一步就是建立索引文件了，运行命令 python&nbsp;<a href="http://manage.py/">manage.py</a>&nbsp;rebuild_index 就可以建立索引文件了。</p>
<p>&nbsp;</p>
<h4>5.8 其他配置</h4>
<p>l&nbsp; 配置templates路径</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目10.png" alt="" /></p>
<p>&nbsp;</p>
<p>l&nbsp; 配置static路径</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目11.png" alt="" /></p>
<p>&nbsp;</p>
<p>l&nbsp; 配置django认证系统使用的模型类</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目12.png" alt="" /></p>
<p>&nbsp;</p>
<p>l&nbsp; 配置 富文本编辑器</p>
<p>注册应用
&lsquo;tinymce&rsquo;</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目13.png" alt="" /></p>
<p>&nbsp;</p>
<p>l&nbsp; 配置LOGIN_URL</p>
<p>&nbsp;LOFGIN_URL = '/user/login'</p>
<p align="left">l&nbsp; 配置alipay</p>
<p align="left">Pip3 insatll
alipay-sdk-python</p>
<p align="left">&nbsp;</p>
<p align="left">&nbsp;<img src="./images/python-django-天天生鲜项目14.png" alt="" /></p>
<p><img src="./images/python-django-天天生鲜项目15.png" alt="" /></p>
<p>&nbsp;</p>
<p align="left">使用openssl生成本机的公钥和私钥。</p>
<p align="left">创建应用</p>
<p>alipay_client_config
= AlipayClientConfig()<br />
alipay_client_config.server_url = 'https://openapi.alipaydev.com/gateway.do'<br />
alipay_client_config.app_id = '2016100100641374'<br />
app_private_key = ''<br />
with open(os.path.join(settings.BASE_DIR, 'apps/order/app_private_key.pem'), 'r') as f:<br />
&nbsp;&nbsp;&nbsp; for line
in f:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app_private_key += line<br />
alipay_client_config.app_private_key = app_private_key<br />
alipay_public_key = ''<br />
with open(os.path.join(settings.BASE_DIR, 'apps/order/alipay_public_key.pem'), 'r') as f:<br />
&nbsp;&nbsp;&nbsp; for line
in f:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alipay_public_key += line<br />
alipay_client_config.alipay_public_key = alipay_public_key<br />
"""<br />
得到客户端对象。<br />
注意，一个alipay_client_config对象对应一个DefaultAlipayClient，定义DefaultAlipayClient对象后，alipay_client_config不得修改，如果想使用不同的配置，请定义不同的DefaultAlipayClient。<br />
logger参数用于打印日志，不传则不打印，建议传递。<br />
"""<br />
client = DefaultAlipayClient(alipay_client_config=alipay_client_config, logger=logger)<br />
<br />
total_pay = order.transit_price + order.total_price<br />
total_pay = round(float(total_pay), 2)<br />
model = AlipayTradePagePayModel()<br />
model.out_trade_no = order_id<br />
model.total_amount = total_pay<br />
model.subject = "天天生鲜{0}".format(order_id)<br />
model.product_code = "FAST_INSTANT_TRADE_PAY"</p>
<p>&nbsp;</p>
<p>调用网页支付接口</p>
<p>request =
AlipayTradePagePayRequest(biz_model=model)<br />
response = client.page_execute(request, http_method="GET")<br />
# 访问支付页面<br />
return JsonResponse({'res': 3, 'response': response})</p>
<p>&nbsp;</p>
<p align="left">&nbsp;</p>
<p align="left">调用查询交易接口</p>
<p align="left">&nbsp;</p>
<p># request =
AlipayTradeQueryRequest(biz_model=model)<br />
# response = client.page_execute(request, http_method="GET")<br />
# data = requests.get(response)<br />
# print(json.loads(data.text))<br />
# data = json.loads(data.text)<br />
# print(data.get('alipay_trade_query_response').get('code'))</p>
<p align="left">&nbsp;</p>
<h3>6 建立数据模型</h3>
<p>l&nbsp; 建立模型类</p>
<p>（依据上面实体类图创建的，列属性参照上面即可，具体请看源码）</p>
<p>&nbsp;</p>
<p>user/models.py</p>
<p>Address</p>
<p>User继承djaong用户管理模型 ，配置django认证系统使用的模型类</p>
<p>AUTH_USER_MODEL = 'user.User'</p>
<p>&nbsp;</p>
<p>Goods/models.py</p>
<p>GoodsType</p>
<p>GoodsSKU</p>
<p>GoodsSPU</p>
<p>GoodsImage</p>
<p>IndexGoodsTypeBanner</p>
<p>IndexGoodsBanner</p>
<p>IndexPromotionBanner</p>
<p>&nbsp;</p>
<p>Ordre/models.py</p>
<p>OrderInfo</p>
<p>OrderGoods</p>
<h3>7 详细过程</h3>
<h4>7.1 用户模块设计&mdash;&mdash;user</h4>
<p>l&nbsp; 注册过程</p>
<p>浏览器访问注册页面get方式，views.register进行处理（改为views.RegisterView.post），返回注册页面。用户输入信息进行注册，浏览器提交post请求，views.register进行处理（改为views.RegisterView.post），校验用户输入信息是否合法，将用户添加到数据库中，生成用户token，给用户发送专属激活链接，用户点击链接激活，用户账户生效。</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 生成token使用itsdangerous 模块中的Timed。。。Serializer加密类，发送邮件使用Django中sender_mail()方法,由于发送邮件过程可能耗时，使用了celery模块，因此注册之后页面直接跳转到首页。</p>
<p>&nbsp;</p>
<p>l&nbsp; 登陆过程</p>
<p>Get方式：显示登陆页面，判断request.COOKIES是否存在用户名，存在就自动填充到输入框。</p>
<p>Post方式：用户填完登陆信息提交Post表单，此时验证填入信息是否有误，如果有误给出相应提示，用户账户密码校验使用了django的authenticate()方法，正确返回一个user对象，并使用login(request, user)记录用户的登陆session信息，否则返回None。</p>
<p>&nbsp;</p>
<p>有些网页需要用户登陆才能访问，就需要使用login_required()装饰器装饰那些也面的View.as_view()方法，此方法如果校验失败会自动转到一个url地址，我在settings.py 配置LOGIN_URL修改它默认的跳转地址为&rsquo;/user/login&rsquo;返回登陆页面，而且访问url地址后面自动添加一个get值（&rsquo;next&rsquo;），记录从哪个网页跳转过来的，在正确登陆之后可以跳转到上一个地址。 由于这样会使urls.py看起来繁杂，创建一个utils/mixin.py</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目16.png" alt="" /></p>
<p>&nbsp;</p>
<p>让需要此功能的View类继承此类即可，一定要在models.View类之前。</p>
<p>&nbsp;</p>
<p>l&nbsp; 退出登录</p>
<p>Get请求：使用logout（）清除用户的session信息，返回首页。</p>
<p>&nbsp;</p>
<p>l&nbsp; 用户中心&mdash;&mdash;地址页</p>
<p>Get请求：获取用户的默认地址，返回地址页。获取用户的默认地址多次用到，address=Address.objects.get(user=user, is_default=True), 将此方法封装，建立一个新的地址管理类继承model.Manage，写一个获取默认地址的方法，再让Address类的objects=这个类的对象。</p>
<p>Post请求：用户添加地址，判断输入信息是否合法，如果用户没有默认地址，则将此地址设为默认地址，跳转回此页面。</p>
<p>&nbsp;</p>
<p>l&nbsp; 用户中心&mdash;&mdash;信息页</p>
<p>Get请求：获取用户的默认地址，获取用户的最近5条浏览的商品图片，获取默认地址功能已经实现，获取用户最近浏览记录需要使用redis存储的缓存，用户在商品页面浏览时添加商品id到redis，在此页面从redis中读取商品id再使用模型类查询商品图片。然后经过模板渲染返回给浏览器。</p>
<p>具体思路以及图片的上传和下载如下：</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目17.png" alt="" /></p>
<p><img src="./images/python-django-天天生鲜项目18.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>l&nbsp; 用户中心&mdash;&mdash;订单页</p>
<p>(在订单模块进行开发)</p>
<h4>7.2 商品模块设计&mdash;&mdash;goods</h4>
<p>l&nbsp; 商品首页 /index</p>
<p>Get请求：</p>
<p>判断用户是否登陆，若登陆了获取用户信息，获取购物车中数目信息。获取商品类型信息，获取首页商品轮播信息，获取首页商品类型轮播信息，获取首页活动轮播信息，通过模板进行渲染，返回给用户。为提高网站性能和安全性</p>
<ol>
<li>使用页面静态化方法</li>


































</ol>
<p>在管理员对首页信息添加或修改之后，利用celery异步生成一个静态页面，只要页面没有数据更新，用户直接返回这个静态页面，减少查询数据库的次数。使用nginx来调度访问Django网站还是访问nginx。</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目19.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<ol>
<li>使用页面数据缓存方法</li>


































</ol>
<p>在页面信息被修改时清除缓存数据，使用redis存储缓存数据，用户访问网站时，如果从缓存中没有找到数据，则从数据库中获取并存入缓存，否则直接使用缓存。同样减少了查询数据库的次数。</p>
<p>&nbsp;</p>
<p>l&nbsp; 商品详情页 &nbsp;&nbsp;/goods/detail/(good_id)</p>
<p>Get请求：</p>
<p>判断用户是否登陆，若登陆了获取用户信息，获取购物车中数目信息。获取商品SKU信息，获取SKU商品的同类型SPU的所有SKU商品信息，获取商品类型信息，获取同类型商品新品信息，获取订单商品信息。通过模板进行渲染，返回给用户。</p>
<p>&nbsp;</p>
<p>l&nbsp; 商品列表页 &nbsp;&nbsp;/goods/list/(type_id)/(page)?sort=sort_method</p>
<p>Get请求：</p>
<p>判断用户是否登陆，若登陆了获取用户信息，获取购物车中数目信息。获取商品类型，获取商品类型信息,获取同类型商品信息，将同类型商品信息分页（需要用到Paginator类，参见<a href="https://www.jianshu.com/p/332406309476">https://www.jianshu.com/p/332406309476</a>），获取当前页面上商品。通过模板进行渲染，返回给用户。</p>
<p>&nbsp;</p>
<p>l&nbsp; 搜索功能的实现</p>
<p>商品模块每个页面都有一个搜索框，实现搜索功能：首先是把
django haystack 加入到 INSTALLED_APPS 选项里,再添加配置，</p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目20.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;django haystack 规定。要相对某个 app 下的数据进行全文检索，就要在该 app 下创建一个
search_indexes.py 文件，然后创建一个 XXIndex 类（XX 为含有被检索数据的模型，如这里的 Goods SKU），并且继承
SearchIndex 和 Indexable。</p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目21.png" alt="" /></p>
<p>&nbsp;</p>
<p>我们使用数据模板去建立搜索引擎索引的文件，接下来就是配置 URL，修改一下搜索表单，让它提交数据到 django haystack 搜索视图对应的 URL，使用 Whoosh 作为搜索引擎， haystack_search 视图函数会将搜索结果传递给模板 search/search.html，因此创建这个模板文件，对搜索结果进行简单渲染，</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目22.png" alt="" /></p>
<p><img src="./images/python-django-天天生鲜项目23.png" alt="" /></p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目24.png" alt="" /></p>
<p>&nbsp;</p>
<p>但在 django haystack 中为 Whoosh 指定的分词器是英文分词器，可能会使得搜索结果不理想，把这个分词器替换成 jieba 中文分词器，</p>
<p>&nbsp;<img src="./images/python-django-天天生鲜项目25.png" alt="" /></p>
<p><img src="./images/python-django-天天生鲜项目26.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>
 
最后一步就是建立索引文件了，运行命令 python3&nbsp;<a href="http://manage.py/">manage.py</a>&nbsp;rebuild_index
就可以建立索引文件了。</p>
<h4>7.3 购物车模块设计&mdash;&mdash;cart</h4>
<p>l&nbsp; 加入购物车功能 /cart/add</p>
<p>Post请求： 从商品详情页发来ajax post型请求，</p>
<p># 请求方式：ajax post<br />
# 传递参数：商品id
sku_id ,商品数量 count<br />
# 返回： 成功：JsonResponse({'res':5, 'message': '添加成功', 'total_count': total_count})</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据数据进行处理：往购物车里添加商品，购物车用redis存储，</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 返回数据之后原页面对应显示信息。</p>
<p>&nbsp;</p>
<p>l&nbsp; 显示我的购物车页面 /cart</p>
<p>Get请求：用户未登录不可访问，
获取用户信息，从redis中获取用户的购物车中商品列表，给商品动态添加小计和数目属性，组织参数返回给模板，模板渲染遍历显示，返回给用户。</p>
<p>&nbsp;</p>
<p>l&nbsp; 更新购物车功能 &nbsp;/cart/update</p>
<p>Post请求： 从我的购物车页面发来ajax post型请求，</p>
<p># 请求方式：ajax post<br />
# 传递参数：商品id
sku_id ,商品数量 count<br />
# 返回： 成功：JsonResponse({'res':5, 'message': '更新成功', 'total_count': total_count})</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据数据进行处理：更新购物车里商品，购物车用redis存储，</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 返回数据之后原页面对应显示信息。</p>
<p>&nbsp;</p>
<p>l&nbsp; 删除购物车中商品功能 &nbsp;/cart/delete/</p>
<p>Post请求： 从商品详情页发来ajax post型请求，</p>
<p># 请求方式：ajax post<br />
# 传递参数：商品id
sku_id ,商品数量 count<br />
# 返回： 成功：JsonResponse({'res':3, 'message': '删除成功', 'total_count': total_count})</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据数据进行处理：往购物车里添加商品，购物车用redis存储，</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 返回数据之后原页面对应显示信息。</p>
<p>&nbsp;</p>
<p>l&nbsp; 前端说明</p>
<p>主要使用js，jquery 进行页面更新。主要实现以下功能：</p>
<p>Detail.html</p>
<p>1 计算和设置商品总价格（在购物车页面是小计）</p>
<p>2 增加商品数量</p>
<p>3 减少商品数量</p>
<p>4 手动输入商品数量</p>
<p>5 添加到购物车 发起ajax请求 # 请求方式：ajax post&nbsp; # 传递参数：商品id sku_id ,商品数量 count， &nbsp;实现购物车数量改变。</p>
<p>&nbsp;</p>
<p>Cart.html</p>
<p>1 计算被选中的商品的数量和总价格</p>
<p>2 计算商品小计</p>
<p>3 更新购物车中的商品数量 &nbsp;发起ajax请求
# 请求方式：ajax post&nbsp; # 传递参数：商品id sku_id ,商品数量 count， &nbsp;实现购物车中商品数量改变，成功与否返回相应信息。</p>
<p>4 商品的全选和全不选功能</p>
<p>5 单个商品的checkbox改变时，设置全选与否</p>
<p>6 购物车商品数量的增加 &nbsp;若<strong>3</strong>成功，更新页面</p>
<p>7 购物车商品数量的减少 &nbsp;若<strong>3</strong>成功，更新页面</p>
<p>8 手动输入购物车商品数量 &nbsp;若<strong>3</strong>成功，更新页面</p>
<p>9 删除购物车中的记录 &nbsp;发起ajax请求
# 请求方式：ajax post&nbsp; # 传递参数：商品id sku_id， 实现购物车中商品数量改变，成功与否返回相应信息并相应改变页面。</p>
<h4>7.4 订单模块设计&mdash;&mdash;order</h4>
<p>l&nbsp; 提交订单页面：显示用户准备购买的商品信息。</p>
<p>Post请求：从购物车页面点击去结算，发起post请求，提交的参数有：选中的商品的列表。查询redis中商品的数量，再计算出商品的小计，计算出总数量和总价格，再查出来地址信息，一并显示给用户。</p>
<p>&nbsp;</p>
<p>l&nbsp; 点击提交订单完成订单的创建。</p>
<p>Post请求：用户点击提交订单发起ajax post请求，提交参数有：地址id、支付方式、商品列表字符串。生成订单信息表，查询每种商品的库存和购买数量，判断是否购买成功，成功则向订单商品表中添加数据，失败则返回错误信息，并回滚数据库事务，此时需要用到mysql的事物以及加锁和隔离内容，加锁方式有两种，悲观锁和乐观锁，我提供了两种，最终跳转到相应页面。</p>
<p>&nbsp;</p>
<p>l&nbsp; 用户中心订单页显示用户的订单信息。</p>
<p>Get请求;查询订单信息，分页显示。</p>
<p>&nbsp;</p>
<p>l&nbsp; 点击支付完成订单的支付</p>
<p>Post请求：用户发起ajax post请求，提交订单参数，网站生成对应支付方式的支付页面地址。如果请求成功，get请求支付页面，前往支付。另一方面，网站监听支付结果(因现在没有公网ip)，如果支付成功则提示支付成功，跳转到订单页面。</p>
<p>我只实现了支付宝支付方式：使用pip3 install alipay-sdk-python</p>
<p>&nbsp;</p>
<p>l&nbsp; 点击评价完成订单的评价 &nbsp;/order/comment/(order_id)</p>
<p>Get请求：查询订单信息，返回提交评论的页面。</p>
<p>Post请求：提交评论，跳转到订单页。</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>