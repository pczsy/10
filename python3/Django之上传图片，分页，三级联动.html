<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Django之上传图片，分页，三级联动' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Django之上传图片，分页，三级联动</center></div><div class='banquan'>原文出处:本文由博客园博主YifChan提供。<br/>
原文连接:https://www.cnblogs.com/yifchan/p/python-1-31.html</div><br>
    <p>Django1.8.2中文文档：<a href="https://yiyibooks.cn/xx/django_182/index.html" target="_blank">Django1.8.2中文文档</a></p>
<h2>上传图片</h2>
<h3>配置上传文件保存目录</h3>
<p>1)新建上传文件保存目录。</p>
<p><img src="./images/Django之上传图片，分页，三级联动0.png" alt="" /></p>
<p>2)配置上传文件保存目录。</p>
<p><img src="./images/Django之上传图片，分页，三级联动1.png" alt="" /></p>
<p>&nbsp;</p>
<h3>后台管理页面上传图片</h3>
<ul>
<li>1)设计模型类。</li>
<li>2)迁移生成表格。</li>
<li>3) 注册模型类。</li>
</ul>
<p>&nbsp;</p>
<h4>后台管理页面上传图片实例</h4>
<p>1.在static下面创建media文件夹(再在media文件夹里面新建booktest文件夹)。</p>
<p>2.设置静态文件保存目录</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 设置上传文件的保存目录</span>
MEDIA_ROOT = os.path.join(BASE_DIR, <span style="color: #800000;">'</span><span style="color: #800000;">static/media</span><span style="color: #800000;">'</span>)</pre>
</div>
<p>3.编写图片模型类</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">class</span><span style="color: #000000;"> PicTest(models.Model):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">上传图片</span><span style="color: #800000;">"""</span><span style="color: #000000;">
    goods_pic </span>= models.ImageField(upload_to=<span style="color: #800000;">'</span><span style="color: #800000;">booktest</span><span style="color: #800000;">'</span>)  <span style="color: #008000;">#</span><span style="color: #008000;"> 指定上传图片到media下面的booktest文件夹下</span></pre>
</div>
<p>4.迁移数据</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">python manage.py makemigrations
python manage.py migrate</span></pre>
</div>
<p>如果项目用的是原来的数据库，那么应该先去django_migrations里面删除booktest的init文件；</p>
<div class="cnblogs_code">
<pre><code>delete <span style="color: #0000ff;">from</span> django_migrations where id = xxx;</pre>
</div>
<p>如果数据库中原来存在areainfo表，然后项目中的模型类又申请创建，会报错，<br />解决方法是去booktets/migrations/001init下面删掉重复的表记录。</p>
<p>5.去admin中注册表</p>
<div class="cnblogs_code">
<pre><code>admin.site.register(models.PicTest)</pre>
</div>
<p>这时候，就可以在后台上传图片了。</p>
<p>&nbsp;</p>
<h3>用户自定义页面上传图片</h3>
<ul>
<li>1)定义用户上传图片的页面并显示，是一个自定义的表单。</li>
<li>2)定义接收上传文件的视图函数。</li>
</ul>
<p>request对象有一个FILES的属性，类似于字典，<strong>通过request.FILES可以获取上传文件的处理对象</strong>。</p>
<p>在django中，上传文件不大于2.5M,文件放在内存中。上传文件大于2.5M,文件内容写到一个临时文件中。<br />Django处理上传文件的两个类：</p>
<div class="cnblogs_code">
<pre><code>FILE_UPLOAD_HANDLERS= (<br /><span style="color: #800000;">"</span><span style="color: #800000;">django.core.files.uploadhandler.MemoryFileUploadHandler</span><span style="color: #800000;">"</span><span style="color: #000000;">,
</span><span style="color: #800000;">"</span><span style="color: #800000;">django.core.files.uploadhandler.TemporaryFileUploadHandler</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>&nbsp;</p>
<h4>用户自定义页面上传图片实例</h4>
<p>上传图片html--upload_pic.html</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>上传图片<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">form </span><span style="color: #ff0000;">action</span><span style="color: #0000ff;">="/upload_handle/"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="post"</span><span style="color: #ff0000;"> enctype</span><span style="color: #0000ff;">="multipart/form-data"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% csrf_token %}
    </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="file"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="pic"</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="submit"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="上传图片"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">form</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>上传图片对应函数</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">from</span> django.conf <span style="color: #0000ff;">import</span> settings  <span style="color: #008000;">#</span><span style="color: #008000;"> 上传图片时使用</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> upload_pic(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">返回上传图片文件的页面</span><span style="color: #800000;">"""</span>
    <span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">booktest/upload_pic.html</span><span style="color: #800000;">'</span><span style="color: #000000;">)


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> upload_handle(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">对上传的文件进行处理</span><span style="color: #800000;">"""</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 1.获取上传文件的处理对象</span>
    pic = request.FILES[<span style="color: #800000;">'</span><span style="color: #800000;">pic</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    pic_name </span>= pic.name  <span style="color: #008000;">#</span><span style="color: #008000;"> 上传文件名</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> pic.chunk()  # 上传的文件会以迭代器的形式，一部分一部分的保存在这里面</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 2.创建一个文件</span>
    save_path = <span style="color: #800000;">'</span><span style="color: #800000;">%s/booktest/%s</span><span style="color: #800000;">'</span> %<span style="color: #000000;"> (settings.MEDIA_ROOT, pic_name)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3.将上传的文件写入到新创建的文件中</span>
    with open(save_path, <span style="color: #800000;">'</span><span style="color: #800000;">wb</span><span style="color: #800000;">'</span><span style="color: #000000;">) as f:
        </span><span style="color: #0000ff;">for</span> content <span style="color: #0000ff;">in</span><span style="color: #000000;"> pic.chunks():
            f.write(content)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 4.记录写入数据库</span>
    models.PicTest.objects.create(goods_pic=<span style="color: #800000;">'</span><span style="color: #800000;">booktest/%s</span><span style="color: #800000;">'</span> %<span style="color: #000000;"> pic_name)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 5.返回应答</span>
    <span style="color: #0000ff;">return</span> HttpResponse(pic_name)</pre>
</div>
<p>配套url</p>
<div class="cnblogs_code">
<pre><code>url(r<span style="color: #800000;">'</span><span style="color: #800000;">^upload_pic</span><span style="color: #800000;">'</span>, views.upload_pic),  <span style="color: #008000;">#</span><span style="color: #008000;"> 返回上传图片文件的页面</span>
url(r<span style="color: #800000;">'</span><span style="color: #800000;">^upload_handle</span><span style="color: #800000;">'</span>, views.upload_handle),  <span style="color: #008000;">#</span><span style="color: #008000;"> 对上传的文件进行处理</span></pre>
</div>
<p>&nbsp;</p>
<h2>分页</h2>
<p><strong>需求</strong></p>
<p>查询出所有省级地区的信息，显示在页面上。<br />1)查询出所有省级地区的信息。<br />2)按每页显示10条信息进行分页，默认显示第一页的信息，下面并显示出页码。<br />3)点击i页链接的时候，就显示第i页的省级地区信息。</p>
<p>&nbsp;</p>
<h3>分页实例</h3>
<p>url</p>
<div class="cnblogs_code">
<pre><code>url(r<span style="color: #800000;">'</span><span style="color: #800000;">^show_areas(?P&lt;pindex&gt;\d*)</span><span style="color: #800000;">'</span>, views.show_areas),  <span style="color: #008000;">#</span><span style="color: #008000;"> 分页</span></pre>
</div>
<p>show_areas.html</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>分页<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% for area in page %}
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>{{ area.atitle }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% endfor %}
</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">

{% if page.has_previous %}
    </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="/show_areas{{ page.previous_page_number }}"</span><span style="color: #0000ff;">&gt;</span><span style="color: #ff0000;">&amp;lt;</span>上一页<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
{% endif %}

{% for pindex in page.paginator.page_range %}
    {% if pindex == page.number %}
        {{ pindex }}
    {% else %}
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="/show_areas{{ pindex }}"</span><span style="color: #0000ff;">&gt;</span>{{ pindex }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% endif %}
{% endfor %}

{% if page.has_next %}
    </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="/show_areas{{ page.next_page_number }}"</span><span style="color: #0000ff;">&gt;</span>下一页<span style="color: #ff0000;">&amp;gt;</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
{% endif %}

</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>分页对应函数</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> show_areas(request, pindex):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">分页</span><span style="color: #800000;">"""</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 1.查询出所有省级地区的信息</span>
    areas = models.AreaInfo.objects.filter(aParent__isnull=<span style="color: #000000;">True)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 2.分页，每页显示10条</span>
    pagintor = Paginator(areas, 10<span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3.获取第pindex页的内容</span>
    <span style="color: #0000ff;">if</span> pindex == <span style="color: #800000;">""</span><span style="color: #000000;">:
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 默认取第一页的内容</span>
        pindex = 1
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        pindex </span>=<span style="color: #000000;"> int(pindex)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> page是Page类的实例对象</span>
    page =<span style="color: #000000;"> pagintor.page(pindex)

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 4.使用模板</span>
    <span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">booktest/show_areas.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">page</span><span style="color: #800000;">'</span>: page})</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>三级联动</h2>
<p><strong>需求</strong></p>
<p>1)显示省地区信息。<br />2)省改变时在对应的下拉列表框中显示下级市的信息。<br />3)市改变时在对应的下拉列表框中显示下级县的信息。</p>
<p>&nbsp;</p>
<h3>三级联动实例</h3>
<p>对应函数</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">def</span><span style="color: #000000;"> areas(request):
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">booktest/areas.html</span><span style="color: #800000;">'</span><span style="color: #000000;">)


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> prov(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">返回省级数据</span><span style="color: #800000;">"""</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 1.获取所有省级地区的信息</span>
    areas = models.AreaInfo.objects.filter(aParent__isnull=<span style="color: #000000;">True)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 2.变量areas拼接处json数据：atitle，id</span>
    areas_list =<span style="color: #000000;"> []
    </span><span style="color: #0000ff;">for</span> area <span style="color: #0000ff;">in</span><span style="color: #000000;"> areas:
        areas_list.append((area.id, area.atitle))
    </span><span style="color: #0000ff;">return</span> JsonResponse({<span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span><span style="color: #000000;">: areas_list})


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> city(request, pid):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">获取pid对应地区的下级地区</span><span style="color: #800000;">"""</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 1.获取pid对应地区的下级地区</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> area = models.AreaInfo.objects.filter(id=pid)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> areas = area.areainfo_set.all()</span>
    areas = models.AreaInfo.objects.filter(aParent__id=<span style="color: #000000;">pid)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 2.变量areas拼接处json数据：atitle，id</span>
    areas_list =<span style="color: #000000;"> []
    </span><span style="color: #0000ff;">for</span> area <span style="color: #0000ff;">in</span><span style="color: #000000;"> areas:
        areas_list.append((area.id, area.atitle))
    </span><span style="color: #0000ff;">return</span> JsonResponse({<span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span>: areas_list})</pre>
</div>
<p>url</p>
<div class="cnblogs_code">
<pre><code>url(r<span style="color: #800000;">'</span><span style="color: #800000;">^prov</span><span style="color: #800000;">'</span>, views.prov),  <span style="color: #008000;">#</span><span style="color: #008000;"> 返回省级数据</span>
url(r<span style="color: #800000;">'</span><span style="color: #800000;">^city(\d+)</span><span style="color: #800000;">'</span>, views.city),  <span style="color: #008000;">#</span><span style="color: #008000;"> 返回市级数据</span>
url(r<span style="color: #800000;">'</span><span style="color: #800000;">^dis(\d+)</span><span style="color: #800000;">'</span>, views.city),  <span style="color: #008000;">#</span><span style="color: #008000;"> 返回县级数据</span></pre>
</div>
<p>area.html</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>省市县案例<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="/static/js/jquery-3.3.1.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">
        $(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 发起一个ajax请求/prov, 获取所有省级地区的信息</span>
            <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取信息，使用get；涉及到信息修改，使用post</span>
<span style="background-color: #f5f5f5; color: #000000;">            $.get(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">/prov</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 回调函数</span>
                <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取返回的json数据</span>
<span style="background-color: #f5f5f5; color: #000000;">                let res </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> data.data;
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取prov下拉列表框</span>
<span style="background-color: #f5f5f5; color: #000000;">                let prov </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#prov</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 遍历res数组，获取每一个元素: [地区id，地区标题]</span>
                <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;">(let i</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">res.length; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
                    let id </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> res[i][</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">];
                    let atitle </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> res[i][</span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">];
                    let option_str </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option value='</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> id </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">'&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> atitle </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
                    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 向prov下拉列表框中追加元素</span>
<span style="background-color: #f5f5f5; color: #000000;">                    prov.append(option_str)
                }
            });

            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 绑定prov下拉框的change事件，获取省下面市的信息</span>
<span style="background-color: #f5f5f5; color: #000000;">            $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#prov</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).change(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
                let prov_id </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">).val();
                $.get(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">/city</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">prov_id, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
                    let res </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> data.data;
                    let city </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#city</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    city.empty().append(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option&gt;---请选择市---&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    let dis </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#dis</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    dis.empty().append(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option&gt;---请选择县---&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    $.each(res, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (index, item) {
                        let id </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> item[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">];
                        let atitle </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> item[</span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">];
                        let option_str </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option value='</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> id </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">'&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> atitle </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
                        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 向city下拉列表框中追加元素</span>
<span style="background-color: #f5f5f5; color: #000000;">                        city.append(option_str)
                    })
                })
            });

            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 绑定prov下拉框的change事件，获取省下面市的信息</span>
<span style="background-color: #f5f5f5; color: #000000;">            $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#city</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).change(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
                let city_id </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">).val();
                $.get(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">/dis</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">city_id, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
                    let res </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> data.data;
                    let dis </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#dis</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    dis.empty().append(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option&gt;---请选择县---&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
                    $.each(res, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (index, item) {
                        let id </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> item[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">];
                        let atitle </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> item[</span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">];
                        let option_str </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option value='</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> id </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">'&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> atitle </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
                        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 向city下拉列表框中追加元素</span>
<span style="background-color: #f5f5f5; color: #000000;">                        dis.append(option_str)
                    })
                })
            });
        })
    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="prov"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>---请选择省---<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="city"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>---请选择市---<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="dis"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>---请选择县---<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>