<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修第四章 函数之装饰器、迭代器、生成器' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>第四章 函数之装饰器、迭代器、生成器</center></div><div class='banquan'>原文出处:本文由博客园博主大山里的架构师提供。<br/>
原文连接:https://www.cnblogs.com/dpsy921/p/11324111.html</div><br>
    <h3 class="md-end-block md-heading"><span class="md-plain">4.7 推导式</span></h3>
<ol class="ol-list" start="">
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">列表推导式</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">基本格式</span></p>
<pre><code><span><span class="cm-variable">v1 = [<span class="cm-variable">i <span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-variable">可迭代对象 ]<br /><span><span class="cm-tab"><span class="cm-variable">v2 = [<span class="cm-variable">i <span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-variable">可迭代对象 <span class="cm-keyword">if <span class="cm-variable">条件 ] <span class="cm-comment"># 条件为true才进行append</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<div class="cnblogs_code" onclick="cnblogs_code_show('aeabde2e-4b60-4ac4-ac17-b0eadf7fa215')"><img id="code_img_closed_aeabde2e-4b60-4ac4-ac17-b0eadf7fa215" class="code_img_closed" src="./images/第四章 函数之装饰器、迭代器、生成器0.png" alt="" /><img id="code_img_opened_aeabde2e-4b60-4ac4-ac17-b0eadf7fa215" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('aeabde2e-4b60-4ac4-ac17-b0eadf7fa215',event)" src="./images/第四章 函数之装饰器、迭代器、生成器1.png" alt="" />
<div id="cnblogs_code_open_aeabde2e-4b60-4ac4-ac17-b0eadf7fa215" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 示例一</span>
<span style="color: #008080;"> 2</span> v1 = [ i <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> <span style="color: #800000;">'</span><span style="color: #800000;">alex</span><span style="color: #800000;">'</span> ]  <span style="color: #008000;">#</span><span style="color: #008000;"> ['a','l','e','x']</span>
<span style="color: #008080;"> 3</span> v2 = [i+100 <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10)] <span style="color: #008000;">#</span><span style="color: #008000;"> [100,101,102,...,109]</span>
<span style="color: #008080;"> 4</span> v3 = [99 <span style="color: #0000ff;">if</span> i&gt;5 <span style="color: #0000ff;">else</span> 66  <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10)][66,66,66,66,66,66,99,99,99,99<span style="color: #000000;">]
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">​
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 示例二</span>
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">return</span> 100
<span style="color: #008080;"> 9</span> v4 = [func <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10)] <span style="color: #008000;">#</span><span style="color: #008000;"> [10个func函数]</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">​
</span><span style="color: #008080;">11</span> v5 = [<span style="color: #0000ff;">lambda</span> : 100 <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10<span style="color: #000000;">)]
</span><span style="color: #008080;">12</span> result = v5[9]() <span style="color: #008000;">#</span><span style="color: #008000;"> 100</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">​
</span><span style="color: #008080;">14</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 示例三</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> i
</span><span style="color: #008080;">17</span> v6 = [func <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10<span style="color: #000000;">)]
</span><span style="color: #008080;">18</span> result = v6[5]()    <span style="color: #008000;">#</span><span style="color: #008000;"> 9</span>
<span style="color: #008080;">19</span> <span style="color: #000000;">​
</span><span style="color: #008080;">20</span> v7 = [<span style="color: #0000ff;">lambda</span> :i <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10<span style="color: #000000;">)]
</span><span style="color: #008080;">21</span> result = v7[5]()    <span style="color: #008000;">#</span><span style="color: #008000;"> 9</span>
<span style="color: #008080;">22</span> <span style="color: #000000;">​
</span><span style="color: #008080;">23</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 示例四</span>
<span style="color: #008080;">24</span> v8 = [<span style="color: #0000ff;">lambda</span> x:x*i <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10)] <span style="color: #008000;">#</span><span style="color: #008000;"> 新浪微博面试题</span>
<span style="color: #008080;">25</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 1.请问 v8 是什么？# 函数</span>
<span style="color: #008080;">26</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 2.请问 v8[0](2) 的结果是什么？ # 18</span>
<span style="color: #008080;">27</span> <span style="color: #000000;">​
</span><span style="color: #008080;">28</span> <span style="color: #008000;">#</span><span style="color: #008000;"> 面试题</span>
<span style="color: #008080;">29</span> <span style="color: #0000ff;">def</span><span style="color: #000000;"> num():
</span><span style="color: #008080;">30</span>     <span style="color: #0000ff;">return</span> [<span style="color: #0000ff;">lambda</span> x:i*x <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(4<span style="color: #000000;">)]
</span><span style="color: #008080;">31</span> <span style="color: #008000;">#</span><span style="color: #008000;"> num() -&gt; [函数,函数,函数,函数]</span>
<span style="color: #008080;">32</span> <span style="color: #0000ff;">print</span>([ m(2) <span style="color: #0000ff;">for</span> m <span style="color: #0000ff;">in</span> num() ]) <span style="color: #008000;">#</span><span style="color: #008000;"> [6,6,6,6]</span>
<span style="color: #008080;">33</span> <span style="color: #000000;">​
</span><span style="color: #008080;">34</span> <span style="color: #008000;">#</span><span style="color: #008000;"> ##################### 筛选 #########################</span>
<span style="color: #008080;">35</span> v9 = [i <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10) <span style="color: #0000ff;">if</span> i &gt; 5]</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">集合推导式</span></h4>
<pre><code><span><span class="cm-variable">v1 = { <span class="cm-variable">i <span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-string">'alex' }</span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">字典推导式</span></h4>
<pre><code><span><span class="cm-variable">v1 = { <span class="cm-string">'k'<span class="cm-operator">+<span class="cm-builtin">str(<span class="cm-variable">i):<span class="cm-variable">i <span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">10) }</span></span></span></span></span></span></span></span></span></span></span></span></pre>
<p class="md-end-block md-p">&nbsp;</p>
</li>
</ol>
<h3 class="md-end-block md-heading"><span class="md-plain">4.8 装饰器</span></h3>
<ol class="ol-list" start="">
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">导入</span></h4>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;"># 典例一
v = 1
v = 2
print(v)    # 2
​
# 典例二
def func():
    pass
v = 10
v = func
print(v)    # v 为函数地址
​
# 典例三
def base():
    print(1)
def bar():
    print(2)
bar = base
bar()   # 1
# 典例一
def func():
    def inner():
        pass
    return inner
v = func()  # inner函数地址
​
# 典例二
def func(arg):
    def inner():
        print(arg)
    return inner
v1 = func(1) 
v1()        # 1
v2 = func(2)
v2()        # 2
​
# 典例三
def func(arg):
    def inner():
        arg()
    return inner
def f1():
    print(123)
v1 = func(f1)
v1()    # 123
​
# 典例四
def func(arg):
    def inner():
        arg()
    return inner
​
def f1():
    print(123)
    return 666
​
v1 = func(f1)   #inner函数
result = v1()   #执行f1函数 123
print(result)   #返回值为None
​
# 典例五
def func(arg):
    def inner():
        return arg()
    return inner
​
def f1():
    print(123)
    return 666
​
v1 = func(f1)   # inner函数
result = v1()   # 执行inner函数 123 返回值为f1
print(result)   #打印f1返回值
</pre>
</div>
<p>　　</p>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">装饰器基本格式</span></h4>
<pre><code><span><span class="cm-keyword">def <span class="cm-def">func(<span class="cm-variable">age):<br /><span><span class="cm-tab">    <span class="cm-keyword">def <span class="cm-def">inner():<br /><span><span class="cm-tab">    <span class="cm-tab">    <span class="cm-variable">v = <span class="cm-variable">arg()<br /><span><span class="cm-tab">    <span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">v<br /><span><span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">inner<br /><span> <span class="cm-comment"># 第一步：执行func函数并将下面函数参数传递，相当于：fun(index)<br /><span> <span class="cm-comment"># 第二步：将func的返回值重新赋值给下面的函数名，index = func（index）<br /><span><span class="cm-meta">@func<br /><span><span class="cm-keyword">def <span class="cm-def">index():<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-number">123)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-number">666<br /><span><span class="cm-builtin">print(<span class="cm-variable">index)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">含义</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">在不改变原函数内部代码的 基础上，在函数执行之前和之后自动执行某个功能</span></p>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">格式</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">装饰器编写格式</span></p>
<pre><code><span><span class="cm-keyword">def <span class="cm-def">外层函数(<span class="cm-variable">参数)<span class="cm-variable">：<br /><span><span class="cm-tab">    <span class="cm-keyword">def <span class="cm-def">内层函数(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span><span class="cm-tab">    <span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">参数(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span class="cm-tab-wrap-hack"><span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">内层函数</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">装饰器应用格式</span></p>
<pre><code><span><span class="cm-meta">@外层函数<br /><span><span class="cm-keyword">def <span class="cm-def">参数():<br /><span><span class="cm-tab">    <span class="cm-keyword">pass<br /><span><span class="cm-variable">index()</span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">问题：为什么要加 *args, **kwargs</span></p>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">可以接收参数函数里面任意值</span></p>
</li>
</ul>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">如果给好几个函数写一个统一的装饰器，怎么办？</span></p>
<pre><code><span><span class="cm-keyword">def <span class="cm-def">a1(<span class="cm-variable">func):<br /><span><span class="cm-tab">    <span class="cm-keyword">def <span class="cm-def">inner(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span><span class="cm-tab">    <span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">func(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span><span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">inner<br /><span> &nbsp; &nbsp;<br /><span><span class="cm-meta">@a1<br /><span><span class="cm-keyword">def <span class="cm-def">f1():<br /><span><span class="cm-tab">    <span class="cm-keyword">pass<br /><span><span>​<br /><span><span class="cm-meta">@a1<br /><span><span class="cm-keyword">def <span class="cm-def">f2():<br /><span><span class="cm-tab">    <span class="cm-keyword">pass<br /><span class="cm-tab-wrap-hack"><span class="cm-tab">    <br /><span><span class="cm-meta">@a1<br /><span><span class="cm-keyword">def <span class="cm-def">f2():<br /><span><span class="cm-tab">    <span class="cm-keyword">pass</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">关于执行函数的前后</span></h4>
<pre><code><span><span class="cm-keyword">def <span class="cm-def">a1(<span class="cm-variable">func):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">inner(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span> &nbsp;  <span class="cm-tab">    <span class="cm-builtin">print(<span class="cm-string">"调用函数之前")<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data = <span class="cm-variable">func(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<span class="cm-comment"># 执行函数并获取返回值<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"调用函数之后")<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">data<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">inner<br /><span><span>​<br /><span><span class="cm-meta">@a1<br /><span><span class="cm-keyword">def <span class="cm-def">index():<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-number">123)<br /><span><span class="cm-variable">index() &nbsp; </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">带参数的装饰器</span></h4>
<pre><code><span><span class="cm-comment"># 第一步：执行 ret = xxx(index)<br /><span><span class="cm-comment"># 第二步：将返回值赋值给 index = ret<br /><span><span class="cm-meta">@xxx<br /><span><span class="cm-keyword">def <span class="cm-def">index():<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass<br /><span><span>​<br /><span><span class="cm-comment"># 第一步：执行 v1 = uuu(9)<br /><span><span class="cm-comment"># 第二步：ret = v1(index)<br /><span><span class="cm-comment"># 第三步：index = ret<br /><span><span class="cm-meta">@uuu(<span class="cm-number">9)<br /><span><span class="cm-keyword">def <span class="cm-def">index():<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<pre><code><span><span class="cm-comment"># 格式 <br /><span><span class="cm-keyword">def <span class="cm-def">x(<span class="cm-variable">counter):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">wrapper(<span class="cm-variable">fnc):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">inner(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span> &nbsp; &nbsp; &nbsp;  <span class="cm-tab">    <span class="cm-variable">data = <span class="cm-variable">func(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">data<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">inner<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">wrapper<br /><span> &nbsp; &nbsp;<br /><span><span class="cm-meta">@x(<span class="cm-number">9)<br /><span><span class="cm-keyword">def <span class="cm-def">index():<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">查看带参数装饰器执行顺序</span></h4>
<pre><code><span><span class="cm-keyword">def <span class="cm-def">x(<span class="cm-variable">counter):<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'x函数')<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">wrapper(<span class="cm-variable">func):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'wrapper函数')<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">inner(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'inner函数')<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">counter:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-number">123<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">func(<span class="cm-operator">*<span class="cm-variable">args,<span class="cm-operator">**<span class="cm-variable">kwargs)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">inner<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">wrapper<br /><span><span>​<br /><span><span class="cm-meta">@x(<span class="cm-keyword">True)<br /><span><span class="cm-keyword">def <span class="cm-def">fun990():<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass<br /><span><span>​<br /><span><span class="cm-meta">@x(<span class="cm-keyword">False)<br /><span><span class="cm-keyword">def <span class="cm-def">func10():<span class="cm-tab">   <span class="cm-tab">    <span class="cm-tab">    <span class="cm-tab">    <span class="cm-comment"># x函数<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass<span class="cm-tab">    <span class="cm-tab">    <span class="cm-tab">    <span class="cm-tab">     &nbsp; &nbsp;<span class="cm-comment"># wrapper函数</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
</ol>
<h3 class="md-end-block md-heading"><span class="md-plain">4.9 迭代器</span></h3>
<ol class="ol-list" start="">
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">类和对象</span></h4>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="C:%5CUsers%5C%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1555659673852.png"><img src="file://C:/Users/%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88/AppData/Roaming/Typora/typora-user-images/1555659673852.png?lastModify=1565272195" alt="" /></span></p>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">任务展示列表中所有数据</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">while + 索引 + 计数器</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">迭代器</span></p>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">迭代器含义</span></h4>
<p class="md-end-block md-p"><span class="md-plain">对某种对象（str/list/tuple/dict/set类创建的对象），可迭代对象中元素逐一获取。</span></p>
<p class="md-end-block md-p"><span class="md-plain">什么是迭代器：具有' __ next __ ' 的方法且每次调用都能获取可迭代对象中的每个元素（从前到后一一获取）</span></p>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">迭代器使用</span></h4>
<pre><code><span><span class="cm-comment"># 列表转换成迭代器：<br /><span><span class="cm-variable">v1 = [<span class="cm-number">1,<span class="cm-number">2,<span class="cm-number">3,<span class="cm-number">4]<br /><span><span class="cm-variable">v2 = <span class="cm-builtin">iter(<span class="cm-variable">v1)<span class="cm-tab">   <span class="cm-comment">#v2就是迭代器<br /><span><span class="cm-variable">v2 = <span class="cm-variable">v1.<span class="cm-property">__iter__()<br /><span><span>​<br /><span><span class="cm-comment"># 迭代器想要获取每个值：<br /><span><span class="cm-variable">result1 = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span><span class="cm-builtin">print(<span class="cm-variable">result1)<br /><span><span class="cm-variable">result2 = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span><span class="cm-builtin">print(<span class="cm-variable">result2)<br /><span><span class="cm-variable">result3 = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span><span class="cm-builtin">print(<span class="cm-variable">result3)<br /><span><span class="cm-variable">result4 = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span><span class="cm-builtin">print(<span class="cm-variable">result4)<br /><span><span class="cm-variable">result5 = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span><span class="cm-builtin">print(<span class="cm-variable">result5)<br /><span><span class="cm-comment"># 直到报错：StopIteration错误，表示已经迭代完毕。<br /><span><span class="cm-comment"># 或者循环获取迭代器中的内容<br /><span><span class="cm-keyword">while <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp;<span class="cm-keyword">try:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">val = <span class="cm-variable">v2.<span class="cm-property">__next__()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin cm-error">print(<span class="cm-variable">val)<br /><span> &nbsp; &nbsp; <span class="cm-keyword cm-error">except <span class="cm-variable">Exception <span class="cm-keyword">as <span class="cm-variable">e:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">如何判别一个对象是否是迭代器：内部是否有<span><code>__next__方法</code><span class="md-plain"> 。</span></span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">for循环实质</span></p>
<pre><code><span><span class="cm-variable">v1 = [<span class="cm-number">11,<span class="cm-number">22,<span class="cm-number">33,<span class="cm-number">44]<br /><span><span>​<br /><span><span class="cm-comment"># 1.内部会将v1转换成迭代器<br /><span><span class="cm-comment"># 2.内部反复执行 迭代器.__next__()<br /><span><span class="cm-comment"># 3.取完不报错<br /><span><span class="cm-keyword">for <span class="cm-variable">item <span class="cm-keyword">in <span class="cm-variable">v1:<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">item)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">可迭代对象</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">表象：可以被循环对象就可以称为是可迭代对象："x" [1,2] {}</span></p>
<pre><code><span><span class="cm-keyword">class <span class="cm-def">Foo:<br /><span> &nbsp; &nbsp;<span class="cm-keyword">pass<br /><span><span>​<br /><span><span class="cm-variable">obj = <span class="cm-variable">Foo()</span></span></span></span></span></span></span></span></span></span></pre>
<p class="md-end-block md-p">&nbsp;</p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">内部具有 <span><code>__iter__()</code><span class="md-plain"> 方法且返回一个迭代器。</span></span></span></p>
<pre><code><span><span class="cm-variable">v1 = [<span class="cm-number">11,<span class="cm-number">22,<span class="cm-number">33,<span class="cm-number">44]<br /><span><span class="cm-variable">result = <span class="cm-variable">v1.<span class="cm-property">__iter__()<span class="cm-tab">  <span class="cm-comment">#result 就是迭代器</span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">可以被for循环</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="C:%5CUsers%5C%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1555660940873.png"><img src="file://C:/Users/%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88/AppData/Roaming/Typora/typora-user-images/1555660940873.png?lastModify=1565272195" alt="" /></span></p>
<p class="md-end-block md-p">&nbsp;</p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">如何让一个对象变成可迭代对象？</span></p>
<p class="md-end-block md-p"><span class="md-plain">在类中实现<span><code>__iter__</code><span class="md-plain">方法且返回一个迭代器（生成器）</span></span></span></p>
<pre><code><span><span class="cm-keyword">class <span class="cm-def">Foo:<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">__iter__(<span class="cm-variable-2">self):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-builtin">iter([<span class="cm-number">1,<span class="cm-number">2,<span class="cm-number">3,<span class="cm-number">4])<br /><span> &nbsp; &nbsp;<br /><span><span class="cm-variable">obj = <span class="cm-variable">Foo()<br /><span><span>​<br /><span><span class="cm-keyword">class <span class="cm-def">Foo:<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">__iter__(<span class="cm-variable-2">self):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-number">1<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-number">2<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-number">3<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<br /><span><span class="cm-variable">obj = <span class="cm-variable">Foo</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<p class="md-end-block md-p"><span class="md-plain">记住：只有能被for循环就是去看内部的iter方法。</span></p>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">迭代器口诀</span></h4>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">取一次就没有了</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">不取就不执行</span></p>
</li>
</ul>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">取迭代器的值得方法</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">list</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">for循环</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">next</span></p>
</li>
</ol></li>
</ol>
<p class="md-end-block md-p">&nbsp;</p>
<h3 class="md-end-block md-heading"><span class="md-plain">4.10 生成器</span></h3>
<ol class="ol-list" start="">
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">实质：就是函数的变异</span></h4>
</li>
<li class="md-list-item">
<h4 class="md-end-block md-p"><span class="md-plain">格式</span></h4>
<pre><code><span><span class="cm-comment"># 生成器函数（内部是否包含yield）<br /><span><span class="cm-keyword">def <span class="cm-def">func():<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"f1")<br /><span> &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-number">1<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"f2")<br /><span> &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-number">2<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"f3")<br /><span><span class="cm-comment"># 函数内部不会被执行，返回一个生成对象<br /><span><span class="cm-variable">v1 = <span class="cm-variable">func()<br /><span><span class="cm-comment"># 生成器可以被for循环，一旦开始循环那么函数内部代码就会开始执行<br /><span><span class="cm-keyword">for <span class="cm-variable">item <span class="cm-keyword">in <span class="cm-variable">v1:<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">item)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<pre><code><span><span class="cm-comment"># 无限循环打印1，2,3.....<br /><span><span class="cm-keyword">def <span class="cm-def">func():<br /><span> &nbsp; &nbsp;<span class="cm-variable">count = <span class="cm-number">1<br /><span> &nbsp; &nbsp;<span class="cm-keyword">while <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-variable">count<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">count += <span class="cm-number">1<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<br /><span><span class="cm-variable">val = <span class="cm-variable">func()<br /><span><span>​<br /><span><span class="cm-keyword">for <span class="cm-variable">item <span class="cm-keyword">in <span class="cm-variable">val:<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">item)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">总结：函数中如果存在yield，那么该函数就是一个生成器函数，调用生成器函数会返回一个生成器，生成器只有被for循环时，生成器函数内部的代码才会被执行,每次执行都会获取yield返回的值</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">练习</span></p>
<pre><code><span><span class="cm-comment"># 读取大文件<br /><span><span class="cm-keyword">def <span class="cm-def">func():<br /><span> &nbsp; &nbsp;<span class="cm-string">"""<br /><span><span class="cm-string"> &nbsp;  分批去读取文件中的内容，将文件的内容返回给调用者。<br /><span><span class="cm-string"> &nbsp;  :return:<br /><span><span class="cm-string"> &nbsp;  """<br /><span> &nbsp; &nbsp;<span class="cm-variable">cursor = <span class="cm-number">0<br /><span> &nbsp; &nbsp;<span class="cm-keyword">while <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f = <span class="cm-builtin">open(<span class="cm-string">'db', <span class="cm-string">'r', <span class="cm-variable">encoding=<span class="cm-string">'utf-8')<span class="cm-comment"># 通过网络连接上redis<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 代指 &nbsp; redis[0:10]<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f.<span class="cm-property">seek(<span class="cm-variable">cursor)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data_list =[]<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">10):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">line = <span class="cm-variable">f.<span class="cm-property">readline()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-keyword">not <span class="cm-variable">line:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">data_list.<span class="cm-property">append(<span class="cm-variable">line)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cursor = <span class="cm-variable">f.<span class="cm-property">tell()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f.<span class="cm-property">close() &nbsp;<span class="cm-comment"># 关闭与redis的连接<br /><span><span>​<br /><span><span>​<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">row <span class="cm-keyword">in <span class="cm-variable">data_list:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield <span class="cm-variable">row<br /><span><span>​<br /><span><span>​<br /><span><span class="cm-keyword">for <span class="cm-variable">item <span class="cm-keyword">in <span class="cm-variable">func():<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">item)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<p class="md-end-block md-p"><span class="md-plain">redis 源码示例</span></p>
<p class="md-end-block md-p md-focus"><span class="md-image md-img-loaded" data-src="C:%5CUsers%5C%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1555662579169.png"><img src="file://C:/Users/%E6%B7%A1%E5%93%81%E5%B2%81%E6%9C%88/AppData/Roaming/Typora/typora-user-images/1555662579169.png?lastModify=1565272195" alt="" /></span></p>
</li>
</ol>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>