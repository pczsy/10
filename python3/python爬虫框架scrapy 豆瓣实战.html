<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»é£ï¼Œåˆå¥ˆä½•æä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/CYHISTW/p/11491513.html</div><br>
    <h1>Scrapy</h1>
<p>å®˜æ–¹ä»‹ç»æ˜¯</p>
<p>An open source and collaborative framework for extracting the data you need from websites.</p>
<p>In a fast, simple, yet extensible way.</p>
<p>æ„æ€å°±æ˜¯</p>
<p><span>ä¸€ä¸ªå¼€æºå’Œåä½œæ¡†æ¶ï¼Œç”¨äºä»¥å¿«é€Ÿï¼Œç®€å•ï¼Œå¯æ‰©å±•çš„æ–¹å¼ä»ç½‘ç«™ä¸­æå–æ‰€éœ€çš„æ•°æ®ã€‚</span></p>
<hr />
<p>&nbsp;</p>
<h2>ç¯å¢ƒå‡†å¤‡</h2>
<p>æœ¬æ–‡é¡¹ç›®ä½¿ç”¨ç¯å¢ƒåŠå·¥å…·å¦‚ä¸‹</p>
<ul>
<li>python3</li>
<li>scrapy</li>
<li>mongodb</li>
</ul>
<p>python3 scrapyçš„å®‰è£…å°±ä¸å†å™è¿°</p>
<p>mongodbæ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„nosqléå…³ç³»å‹æ•°æ®åº“ å®˜æ–¹ä¸‹è½½åœ°å€<a href="https://www.mongodb.com/download-center/community?jmp=docs">https://www.mongodb.com/download-center/community?jmp=docs</a></p>
<p>mongodbå›¾å½¢åŒ–ç®¡ç†å·¥å…·æ¨èä½¿ç”¨nosqlmanager</p>
<hr />
<h2>&nbsp;é¡¹ç›®åˆ›å»º</h2>
<p>æ²¡é”™ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‘è½¯æŸ¿å­æï¼Œå°±çˆ¬å–æœ€ç®€å•çš„è±†ç“£ç”µå½±top250</p>
<p>ğŸ˜‚è¿™ä¸ªç½‘ç«™å‡ ä¹æ˜¯æ¯ä¸ªå­¦ä¹ çˆ¬è™«çš„äººéƒ½ä¼šå»çˆ¬å–çš„ç½‘ç«™ï¼Œè¿™ä¸ªç½‘ç«™ç‰¹åˆ«æœ‰ä»£è¡¨æ€§ è¯ä¸å¤šè¯´ï¼Œé¡¹ç›®å¼€å§‹</p>
<p>åˆ›å»ºscrapyé¡¹ç›®éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œ</p>
<p>åˆ‡æ¢åˆ°å·¥ä½œç›®å½•ï¼Œç„¶åè¾“å…¥æŒ‡ä»¤&nbsp;&nbsp;scrapy startproject douban</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜0.png" alt="" width="665" height="211" /></p>
<p>å³åˆ›å»ºæˆåŠŸï¼Œç„¶åä½¿ç”¨pycharmæ‰“å¼€é¡¹ç›® é¦–å…ˆçœ‹ä¸‹ç›®å½•ç»“æ„</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜1.png" alt="" width="259" height="297" /></p>
<p>æˆ‘ä»¬å‘ç°é¡¹ç›®spidersä¸­åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œæ”¾çˆ¬è™«çš„åœ°æ–¹æ€ä¹ˆä¼šåªæœ‰ä¸€ä¸ª__init__.pyå‘¢&nbsp;</p>
<p>åˆ«æ€¥æˆ‘ä»¬è¿˜éœ€è¦è¾“å…¥ä¸€ä¸ªå‘½ä»¤æ¥åˆ›å»ºåŸºæœ¬çˆ¬è™«&nbsp; æ‰“å¼€cmdåˆ‡æ¢åˆ°ç›®å½•æ–‡ä»¶å¤¹ä¸‹çš„spidersç›®å½•</p>
<p>è¾“å…¥&nbsp;scrapy genspider douban_spider https://movie.douban.com/top250</p>
<p>å¦‚ä¸‹å›¾åˆ›å»ºçˆ¬è™«æˆåŠŸ&nbsp;&nbsp;</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜2.png" alt="" width="799" height="69" /></p>
<p>ç„¶åæˆ‘ä»¬æ‰“å¼€é¡¹ç›®åˆ†æç›®å½•ç»“æ„</p>
<p>douban&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; é¡¹ç›®æ–‡ä»¶å¤¹</p>
<p>ã€€ã€€spidersã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€&nbsp; &nbsp; çˆ¬è™«æ–‡ä»¶å¤¹</p>
<p>ã€€ã€€ã€€ã€€__init__.py</p>
<p>ã€€ã€€ã€€ã€€douban_spider.pyã€€ã€€ã€€ã€€ã€€ã€€ çˆ¬è™«æ–‡ä»¶</p>
<p>ã€€ã€€__init__.py</p>
<p>ã€€ã€€ietms.pyã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€&nbsp; å®šä¹‰itemsæ•°æ®ç»“æ„çš„åœ°æ–¹ï¼ˆå³æˆ‘ä»¬çˆ¬å–å†…å®¹çš„å±æ€§ä¹‹ç±»çš„ä¿¡æ¯ï¼‰</p>
<p>ã€€ã€€middlewares.pyã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ä¸­é—´ä»¶</p>
<p>ã€€ã€€pipelines.pyã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€å®šä¹‰å¯¹äºitemsçš„å¤„ç†æ–¹æ³•ï¼ˆæ•°æ®æ¸…æ´—ç­‰ï¼‰ï¼ˆéœ€è¦åœ¨settingsä¸­å¼€å¯pipelinesé€‰é¡¹ï¼‰</p>
<p>ã€€ã€€settings.pyã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ é¡¹ç›®çš„è®¾ç½®æ–‡ä»¶ï¼Œå®šä¹‰å…¨å±€çš„å„ç§è®¾ç½®ï¼ˆæ¯”å¦‚å¤´éƒ¨ä»£ç†ï¼Œä»»åŠ¡å¹¶å‘é‡ï¼Œä¸‹è½½å»¶è¿Ÿç­‰ç­‰ï¼‰</p>
<p>scrapy.cfg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«ä¸€äº›é»˜è®¤çš„é…ç½®ä¿¡æ¯ï¼‰</p>
<p>è‡³æ­¤æˆ‘ä»¬çš„çš„é¡¹ç›®ç®—æ˜¯åˆ›å»ºæˆåŠŸäº†</p>
<hr />
<p>&nbsp;</p>
<h2>ç¡®å®šå†…å®¹</h2>
<p>åˆ›å»ºå¥½é¡¹ç›®ä¹‹åä¸‹ä¸€æ­¥å°±æ˜¯ç¡®å®šæˆ‘ä»¬è¦çˆ¬å–çš„å†…å®¹äº†ï¼Œç„¶åæ‰å¯ä»¥å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„items.pyæ–‡ä»¶</p>
<p>é¦–å…ˆæ‰“å¼€ç›®æ ‡ç½‘é¡µè¿›è¡Œåˆ†æ&nbsp;</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜3.png" alt="" width="617" height="394" /></p>
<p>ç½‘é¡µä¸­æœ‰å“ªäº›ä¸œè¥¿æ˜¯æˆ‘ä»¬éœ€è¦çš„å‘¢ï¼Ÿ</p>
<ul>
<li>ç”µå½±æ’åç¼–å·</li>
<li>ç”µå½±åç§°</li>
<li>ç”µå½±æ¼”èŒå‘˜ä»¥åŠå¹´ä»½åˆ†ç±»</li>
<li>ç”µå½±æ˜Ÿçº§è¯„åˆ†&nbsp;</li>
<li>è¯„è®ºäººæ•°</li>
<li>ç”µå½±ç®€ä»‹&nbsp;</li>
</ul>
<p>ç°åœ¨å°±å¯ä»¥æ ¹æ®å†…å®¹æ¥ç¼–å†™items.pyæ–‡ä»¶äº†</p>
<p>items.pyæ–‡ä»¶ä»£ç ç¼–å†™å¦‚ä¸‹</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> Define here the models for your scraped items</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> See documentation in:</span><span style="color: #008000;">
#</span><span style="color: #008000;"> https://docs.scrapy.org/en/latest/topics/items.html</span>

<span style="color: #0000ff;">import</span><span style="color: #000000;"> scrapy


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> DoubanItem(scrapy.Item):
    </span><span style="color: #008000;">#</span><span style="color: #008000;">ç¤ºä¾‹</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> define the fields for your item here like:</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> name = scrapy.Field()</span>
<span style="color: #000000;">
    serial_number </span>= scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">æ’å</span>
    movie_name = scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">ç”µå½±åç§°</span>
    introduce = scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">ç”µå½±ç®€ä»‹åŸºæœ¬ä¿¡æ¯</span>
    star = scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">ç”µå½±æ˜Ÿçº§è¯„åˆ†</span>
    evaluate = scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">ç”µå½±è¯„è®ºäººæ•°</span>
    describe = scrapy.Field()<span style="color: #008000;">#</span><span style="color: #008000;">ç”µå½±å†…å®¹ç®€ä»‹</span></pre>
</div>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<h2>å†…å®¹æå–spideræ–‡ä»¶ç¼–å†™</h2>
<p>ç¡®å®šå†…å®¹ä¹‹åå°±æ˜¯éå¸¸å…³é”®çš„spiderçˆ¬è™«æ–‡ä»¶ç¼–å†™äº†&nbsp;</p>
<p>æµ‹è¯•é˜¶æ®µdouban_spider.pyæ–‡ä»¶ç¼–å†™å¦‚ä¸‹ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> scrapy


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> DoubanSpiderSpider(scrapy.Spider):
    </span><span style="color: #008000;">#</span><span style="color: #008000;">çˆ¬è™«åå­—</span>
    name = <span style="color: #800000;">'</span><span style="color: #800000;">douban_spider</span><span style="color: #800000;">'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">å…è®¸çš„åŸŸå çˆ¬å–urléƒ½å±äºè¿™ä¸ªåŸŸå</span>
    allowed_domains = [<span style="color: #800000;">'</span><span style="color: #800000;">movie.douban.com</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    </span><span style="color: #008000;">#</span><span style="color: #008000;">èµ·å§‹url</span>
    start_urls = [<span style="color: #800000;">'</span><span style="color: #800000;">https://movie.douban.com/top250/</span><span style="color: #800000;">'</span><span style="color: #000000;">]

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> parse(self, response):
        </span><span style="color: #0000ff;">print</span>(response.text)<span style="color: #008000;">#</span><span style="color: #008000;">æ‰“å°å“åº”å†…å®¹</span>
        <span style="color: #0000ff;">pass</span></pre>
</div>
<p>ç„¶åæˆ‘ä»¬éœ€è¦è¿è¡Œä¸‹æˆ‘ä»¬çš„çˆ¬è™«çœ‹ä¸‹ç°åœ¨èƒ½å¦å‡ºä»€ä¹ˆä¿¡æ¯</p>
<p>æ‰“å¼€å‘½ä»¤çª—å£å¹¶cdåˆ°é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤&nbsp; &nbsp;scrapy crawl douban_spider</p>
<p>douban_spideræ˜¯çˆ¬è™«çš„åå­—</p>
<p>è¿è¡Œå¦‚ä¸‹å›¾</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜4.png" alt="" width="583" height="330" /></p>
<p>å‘ç°é‡Œé¢æœ‰çˆ¬è™«çš„ä¿¡æ¯ä¹Ÿæœ‰è¿”å›å“åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„ç”µå½±ä¿¡æ¯ï¼Œç°åœ¨æ€ä¹ˆåŠï¼Ÿ</p>
<p>ç¨å¾®å­¦ä¹ è¿‡çˆ¬è™«çš„åŒå­¦éƒ½çŸ¥é“ï¼Œçˆ¬è™«æ˜¯éœ€è¦ä¿®æ”¹&nbsp;USER_AGENT çš„ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„åçˆ¬è™«æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ ·éœ€è¦å»ä¿®æ”¹æˆ‘ä»¬çˆ¬è™«çš„ç”¨æˆ·ä»£ç†</p>
<p>å»å“ªæ‰¾å¤´éƒ¨ä»£ç†å‘¢ï¼Ÿç®€å•ä¸€ç‚¹çš„å¯ä»¥ç›´æ¥å»ç™¾åº¦æœç´¢ä¸€ä¸ªï¼Œæˆ–è€…å‘¢æˆ‘ä»¬ç”¨æµè§ˆå™¨è°ƒè¯•å°æŠŠè‡ªå·±çš„ç”¨æˆ·ä»£ç†å¤åˆ¶ä¸‹æ¥</p>
<p>ä¾‹å¦‚chromeæµè§ˆå™¨æŒ‰F12ç‚¹å‡»ä¸€ä¸ªèµ„æºå¤åˆ¶å‡ºæ¥ç”¨æˆ·ä»£ç†å³å¯ä¸å†èµ˜è¿°</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜5.png" alt="" width="886" height="341" /></p>
<p>æ‰“å¼€settings.pyæ–‡ä»¶&nbsp; æ‰¾åˆ°USER_AGENTä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> Crawl responsibly by identifying yourself (and your website) on the user-agent</span><span style="color: #008000;">
#</span><span style="color: #008000;">USER_AGENT = 'douban (+http://www.yourdomain.com)'</span>
USER_AGENT = <span style="color: #800000;">'</span><span style="color: #800000;">Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.80 Safari/537.36</span><span style="color: #800000;">'</span></pre>
</div>
<p>ç„¶åæˆ‘ä»¬å†æ¬¡æ‰“å¼€å‘½ä»¤çª—å£å¹¶cdåˆ°é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤&nbsp; &nbsp;scrapy crawl douban_spider</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜6.png" alt="" width="653" height="483" /></p>
<p>å‘ç°å·²ç»æœ‰äº†æˆ‘ä»¬æƒ³è¦çš„ç”µå½±ä¿¡æ¯</p>
<p>åŒæ—¶æ¯æ¬¡åœ¨å‘½ä»¤è¡Œè¿è¡Œspiderç¡®å®ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªmain.pyçš„å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜7.png" alt="" width="236" height="149" /></p>
<p>main.pyç¼–å†™ä»£ç ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">from</span> scrapy <span style="color: #0000ff;">import</span><span style="color: #000000;"> cmdline
cmdline.execute(</span><span style="color: #800000;">'</span><span style="color: #800000;">scrapy crawl douban_spider</span><span style="color: #800000;">'</span>.split())</pre>
</div>
<p>è¿è¡Œï¼Œå‘ç°å°±å¾—åˆ°äº†ä¸å‘½ä»¤è¡Œè¿è¡Œä¸€æ ·çš„æ•ˆæœäº†</p>
<p>æ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯<strong>æ•°æ®å¤„ç†</strong>äº†ï¼Œæå–å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯&nbsp; ç»§ç»­ç¼–å†™spider.pyæ–‡ä»¶</p>
<p>å¯¹äºæ•°æ®çš„æå–æˆ‘ä»¬ä½¿ç”¨xpathå®šä½ å…ˆæ¥è§‚å¯Ÿç›®æ ‡ç½‘ç«™çš„å…ƒç´  æˆ‘ä»¬å¯ä»¥çœ‹åˆ°top250ç”µå½±ä¸­æ¯ä¸€é¡µæœ‰25ä¸ªç”µå½±ä¿¡æ¯ å¹¶ä¸”æ¯ä¸ªç”µå½±ä¿¡æ¯éƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨ li</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜8.png" alt="" width="923" height="387" /></p>
<p>xpathæœ‰å¥½å¤šç§å†™æ³• æˆ‘ä»¬å¯ä»¥å®¡æŸ¥å…ƒç´ ç„¶åç¼–å†™xpathå®šä½ï¼Œæˆ–è€…å‘¢ç›´æ¥ç”¨chromeä¹Ÿå¯ä»¥ç›´æ¥è·å–æŸå…ƒç´ çš„xpathè·¯å¾„</p>
<p>ä¾‹å¦‚ä½¿ç”¨æŸxpathæµè§ˆå™¨æ’ä»¶æ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„å…ƒç´  æˆ‘ä»¬é¦–å…ˆå…ˆæ‰¾åˆ°æ¯ä¸ªç”µå½±çš„å®šä½</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜9.png" alt="" width="917" height="349" /></p>
<p>å¦‚å›¾æˆ‘ä»¬ç¼–å†™&nbsp;//ol[@class='grid_view']/li/div[@class='item'] å°±å¯ä»¥å®šä½åˆ°å½“å‰æ¯ä¸ªç”µå½± å…¶å®æˆ‘ä»¬ç®€å•ç‚¹ç›´æ¥å†™ //ol/li ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½ç›´æ¥ç²¾ç¡®ä¸€ç‚¹ xpathè¯­æ³•å¦‚ä¸‹</p>
<table class="dataintable">
<tbody>
<tr><th>è¡¨è¾¾å¼</th><th>æè¿°</th></tr>
<tr>
<td>nodename</td>
<td>é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td>/</td>
<td>ä»æ ¹èŠ‚ç‚¹é€‰å–ã€‚</td>
</tr>
<tr>
<td>//</td>
<td>ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td>.</td>
<td>é€‰å–å½“å‰èŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td>..</td>
<td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td>@</td>
<td>é€‰å–å±æ€§ã€‚</td>
</tr>
</tbody>
</table>
<p>ç„¶ååŒç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°ç”µå½±æ’åï¼Œåç§°ï¼Œè¯„è®ºç­‰ç­‰ä¿¡æ¯çš„xpathï¼Œ æ¥ä¸‹æ¥åœ¨spider.pyæ–‡ä»¶ä¸­å¼•ç”¨æˆ‘ä»¬çš„ items.pyä¸­ç¼–å†™çš„DoubanItemç±» ç„¶åå®Œæˆå¯¹è±¡å±æ€§çš„èµ‹å€¼</p>
<p>spider.pyæ–‡ä»¶ä»£ç ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> scrapy
</span><span style="color: #0000ff;">from</span> douban.items <span style="color: #0000ff;">import</span><span style="color: #000000;"> DoubanItem


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> DoubanSpiderSpider(scrapy.Spider):
    </span><span style="color: #008000;">#</span><span style="color: #008000;">çˆ¬è™«åå­—</span>
    name = <span style="color: #800000;">'</span><span style="color: #800000;">douban_spider</span><span style="color: #800000;">'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">å…è®¸çš„åŸŸå çˆ¬å–urléƒ½å±äºè¿™ä¸ªåŸŸå</span>
    allowed_domains = [<span style="color: #800000;">'</span><span style="color: #800000;">movie.douban.com</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    </span><span style="color: #008000;">#</span><span style="color: #008000;">èµ·å§‹url</span>
    start_urls = [<span style="color: #800000;">'</span><span style="color: #800000;">https://movie.douban.com/top250/</span><span style="color: #800000;">'</span><span style="color: #000000;">]

    </span><span style="color: #008000;">#</span><span style="color: #008000;">é»˜è®¤è§£ææ–¹æ³•</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse(self, response):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> æ³¨æ„åœ¨pythonè¯­å¥ä¸­ä½¿ç”¨xpathå¦‚ æ³¨æ„ä¸åŸæ¥è¯­å¥å•åŒå¼•å·çš„é—®é¢˜</span>
        movie_list=response.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">//ol[@class='grid_view']/li/div[@class='item']</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> movie_item <span style="color: #0000ff;">in</span><span style="color: #000000;"> movie_list:
            douban_item</span>=<span style="color: #000000;">DoubanItem()
            </span><span style="color: #008000;">#</span><span style="color: #008000;">xpathè¯­å¥æœ€åçš„text()æ˜¯è·å–å½“å‰xpathçš„å†…å®¹</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> scrapy get() getall()æ–¹æ³•è·å¾—xpathè·¯å¾„çš„å€¼ ä¸¤ç§æ–¹æ³•ä¸åŒè¯·ç™¾åº¦</span>
            douban_item[<span style="color: #800000;">'</span><span style="color: #800000;">serial_number</span><span style="color: #800000;">'</span>] = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//em/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
            douban_item[</span><span style="color: #800000;">'</span><span style="color: #800000;">movie_name</span><span style="color: #800000;">'</span>] = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//span[@class='title']/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
            </span><span style="color: #008000;">#</span><span style="color: #008000;">ä»‹ç»çš„å†…å®¹éå¸¸ä¸è§„èŒƒå¹¶ä¸”æœ‰å¥½å¤šè¡Œï¼Œé¦–å…ˆä½¿ç”¨getall()æ¥è·å–ï¼Œç„¶åæˆ‘ä»¬è¦å¯¹å…¶è¿›è¡Œå¤„ç†</span>
            content = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//div[@class='bd']/p[1]/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).getall()
            </span><span style="color: #008000;">#</span><span style="color: #008000;">å¤„ç†</span>
            contient_introduce=<span style="color: #800000;">''</span>
            <span style="color: #0000ff;">for</span> conitem <span style="color: #0000ff;">in</span><span style="color: #000000;"> content:
                content_s</span>=<span style="color: #800000;">''</span><span style="color: #000000;">.join(conitem.split())
                contient_introduce</span>=contient_introduce+content_s+<span style="color: #800000;">'</span>  <span style="color: #800000;">'</span>
            <span style="color: #008000;">#</span><span style="color: #008000;">èµ‹å€¼</span>
            douban_item[<span style="color: #800000;">'</span><span style="color: #800000;">introduce</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> contient_introduce
            douban_item[</span><span style="color: #800000;">'</span><span style="color: #800000;">star</span><span style="color: #800000;">'</span>] = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//span[@class='rating_num']/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
            douban_item[</span><span style="color: #800000;">'</span><span style="color: #800000;">evaluate</span><span style="color: #800000;">'</span>] = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//div[@class='star']/span[4]/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
            douban_item[</span><span style="color: #800000;">'</span><span style="color: #800000;">describe</span><span style="color: #800000;">'</span>] = movie_item.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">.//div[@class='bd']/p[2]/span/text()</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
            </span><span style="color: #008000;">#</span><span style="color: #008000;">æˆ‘ä»¬éœ€è¦æŠŠè·å–åˆ°çš„ä¸œè¥¿yieldåˆ°douban_itemä¸­ï¼Œå¦åˆ™æˆ‘ä»¬çš„ç®¡é“pipelines.pyæ— æ³•æ¥æ”¶æ•°æ®</span>
            <span style="color: #0000ff;">yield</span><span style="color: #000000;"> douban_item

        </span><span style="color: #008000;">#</span><span style="color: #008000;">æˆ‘ä»¬éœ€è¦è‡ªåŠ¨ç¿»é¡µåˆ°ä¸‹ä¸€é¡µå»è§£ææ•°æ®</span>
        next_linkend=response.xpath(<span style="color: #800000;">"</span><span style="color: #800000;">//span[@class='next']/a/@href</span><span style="color: #800000;">"</span><span style="color: #000000;">).get()
        </span><span style="color: #008000;">#</span><span style="color: #008000;">åˆ¤æ–­next_linkendæ˜¯å¦å­˜åœ¨</span>
        <span style="color: #0000ff;">if</span><span style="color: #000000;"> next_linkend:
            next_link </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://movie.douban.com/top250/</span><span style="color: #800000;">'</span>+<span style="color: #000000;">next_linkend
            </span><span style="color: #008000;">#</span><span style="color: #008000;">åŒæ ·éœ€è¦yieldæäº¤åˆ°è°ƒåº¦å™¨ä¸­ åŒæ—¶æ·»åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°(åˆšåˆšç¼–å†™çš„æ•°æ®æå–å‡½æ•°)</span>
            <span style="color: #0000ff;">yield</span> scrapy.Request(next_link,callback=self.parse)</pre>
</div>
<hr />
<h2>æ•°æ®å­˜å‚¨</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ç›´æ¥å°†æ•°æ®ä¿å­˜åˆ° jsonæˆ–è€…csvæ–‡ä»¶å¦‚ä¸‹</p>
<p>è¿˜æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œ&nbsp; &nbsp;cdåˆ°é¡¹ç›®ç›®å½•&nbsp;&nbsp;</p>
<p>è¾“å…¥å‘½ä»¤&nbsp; scrapy crawl douban_spider -o test.json å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªjsonæ–‡ä»¶</p>
<p>è¾“å…¥å‘½ä»¤&nbsp;&nbsp;scrapy crawl douban_spider -o test.csv&nbsp; å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªcsvæ–‡ä»¶</p>
<p>è¿™ä¸ªcsvæ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨excelæ‰“å¼€æµè§ˆï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°å­˜åœ¨ä¹±ç ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨notepad++æ‰“å¼€æ–‡ä»¶æ”¹ä¸‹ç¼–ç æ–¹å¼ç„¶åä¿å­˜å†ç”¨excelæ‰“å¼€å³å¯</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜10.png" alt="" width="806" height="434" /></p>
<p><strong>å­˜å‚¨åˆ°æ•°æ®åº“</strong></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹pipelines.pyè¿›è¡Œç¼–å†™ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°mongodbä¸­</p>
<p>æ³¨æ„<span style="color: #ff0000;">æˆ‘ä»¬éœ€è¦åœ¨setting.pyä¸­å°† ITEM_PIPELINES çš„æ³¨é‡Šå…³æ‰ï¼Œè¿™æ ·æ‰èƒ½æ­£å¸¸çš„è¿è¡Œpipelines.py</span></p>
<p>pipelines.pyä»£ç ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> -*- coding: utf-8 -*-</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> Define your item pipelines here</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> Don't forget to add your pipeline to the ITEM_PIPELINES setting</span><span style="color: #008000;">
#</span><span style="color: #008000;"> See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>

<span style="color: #0000ff;">import</span><span style="color: #000000;"> pymongo
</span><span style="color: #008000;">#</span><span style="color: #008000;">è¿æ¥æœ¬åœ°æ•°æ®åº“   è¿œç¨‹ä¹Ÿå¯ä»¥</span>
myclient = pymongo.MongoClient(<span style="color: #800000;">"</span><span style="color: #800000;">mongodb://localhost:27017/</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #008000;">#</span><span style="color: #008000;">æ•°æ®åº“åç§°</span>
mydb = myclient[<span style="color: #800000;">"</span><span style="color: #800000;">douban</span><span style="color: #800000;">"</span><span style="color: #000000;">]
</span><span style="color: #008000;">#</span><span style="color: #008000;">æ•°æ®è¡¨åç§°</span>
mysheet = mydb[<span style="color: #800000;">"</span><span style="color: #800000;">movie</span><span style="color: #800000;">"</span><span style="color: #000000;">]

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> DoubanPipeline(object):
    </span><span style="color: #008000;">#</span><span style="color: #008000;">æ­¤ä¸­çš„itemå°±æ˜¯åˆšåˆšyieldå›æ¥çš„</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> process_item(self, item, spider):
        data</span>=<span style="color: #000000;">dict(item)
        </span><span style="color: #008000;">#</span><span style="color: #008000;">æ’å…¥æ•°æ®</span>
<span style="color: #000000;">        mysheet.insert(data)
        </span><span style="color: #0000ff;">return</span> item</pre>
</div>
<p>ç°åœ¨è¿è¡Œ main.py æ•°æ®å°±å­˜å‚¨åˆ°æ•°æ®åº“ä¹‹ä¸­äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æ•°æ®åº“æŸ¥çœ‹æ•°æ®</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„çˆ¬è™«é¡¹ç›®å¯ä»¥è¯´å·²ç»å®Œæˆäº†ã€‚</p>
<hr />
<p>&nbsp;</p>
<h2>çˆ¬è™«ä¼ªè£…</h2>
<ul>
<li>ipä»£ç†ä¸­é—´ä»¶</li>
<li>user-agentä¸­é—´ä»¶</li>
</ul>
<p>ipä»£ç†éœ€è¦è´­ä¹°æœåŠ¡å™¨ç„¶åå¯ä»¥ä½¿ç”¨å…ˆä¸æäº†&nbsp;</p>
<p>æˆ‘ä»¬å°è¯•ä¸‹user-agentä¸­é—´ä»¶</p>
<p>ç¼–å†™middlewares.pyå†æœ€åæ–°åŠ å…¥æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç±»(æ–‡ä»¶æœ€ä¸Šç«¯è¦ import random)ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">class</span><span style="color: #000000;"> my_useragent(object):
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> process_request(self,request,spider):
        USER_AGENT_LIST </span>=<span style="color: #000000;"> [
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        ]
        agent </span>=<span style="color: #000000;"> random.choice(USER_AGENT_LIST)
        request.headers[</span><span style="color: #800000;">'</span><span style="color: #800000;">User_Agent</span><span style="color: #800000;">'</span>] = agent</pre>
</div>
<p>ç„¶åå» settings.py ä¸­å¼€å¯ä¸­é—´ä»¶å¹¶ä¿®æ”¹ä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ç±»å¦‚ä¸‹å›¾</p>
<p><img src="./images/pythonçˆ¬è™«æ¡†æ¶scrapy è±†ç“£å®æˆ˜11.png" alt="" width="604" height="96" /></p>
<p>ç„¶åå†è¿è¡Œ main.py å°±éƒ½OKäº†ã€‚</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>