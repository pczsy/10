<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修小白学 Python 爬虫（19）：Xpath 基操' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>小白学 Python 爬虫（19）：Xpath 基操</center></div><div class='banquan'>原文出处:本文由博客园博主极客挖掘机提供。<br/>
原文连接:https://www.cnblogs.com/babycomeon/p/12047313.html</div><br>
    <p><img src="./images/小白学 Python 爬虫（19）：Xpath 基操0.png" /></p>
<blockquote>
<p>人生苦短，我用 Python</p>
</blockquote>
<p>前文传送门：</p>
<p><a href="https://www.geekdigging.com/2019/11/13/3303836941/">小白学 Python 爬虫（1）：开篇</a></p>
<p><a href="https://www.geekdigging.com/2019/11/20/2586166930/">小白学 Python 爬虫（2）：前置准备（一）基本类库的安装</a></p>
<p><a href="https://www.geekdigging.com/2019/11/21/1005563697/">小白学 Python 爬虫（3）：前置准备（二）Linux基础入门</a></p>
<p><a href="https://www.geekdigging.com/2019/11/22/3679472340/">小白学 Python 爬虫（4）：前置准备（三）Docker基础入门</a></p>
<p><a href="https://www.geekdigging.com/2019/11/24/334078215/">小白学 Python 爬虫（5）：前置准备（四）数据库基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/25/1881661601/">小白学 Python 爬虫（6）：前置准备（五）爬虫框架的安装</a></p>
<p><a href="https://www.geekdigging.com/2019/11/26/1197821400/">小白学 Python 爬虫（7）：HTTP 基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/27/101847406/">小白学 Python 爬虫（8）：网页基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/28/1668465912/">小白学 Python 爬虫（9）：爬虫基础</a></p>
<p><a href="https://www.geekdigging.com/2019/12/01/2475257648/">小白学 Python 爬虫（10）：Session 和 Cookies</a></p>
<p><a href="https://www.geekdigging.com/2019/12/02/2333822325/">小白学 Python 爬虫（11）：urllib 基础使用（一）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/03/819896244/">小白学 Python 爬虫（12）：urllib 基础使用（二）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/04/2992515886/">小白学 Python 爬虫（13）：urllib 基础使用（三）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/05/104488944/">小白学 Python 爬虫（14）：urllib 基础使用（四）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/07/2788855167/">小白学 Python 爬虫（15）：urllib 基础使用（五）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/09/1691033431/">小白学 Python 爬虫（16）：urllib 实战之爬取妹子图</a></p>
<p><a href="https://www.geekdigging.com/2019/12/10/1910005577/">小白学 Python 爬虫（17）：Requests 基础使用</a></p>
<p><a href="https://www.geekdigging.com/2019/12/11/1468953802/">小白学 Python 爬虫（18）：Requests 进阶操作</a></p>
<h2 id="引言">引言</h2>
<p>前面两篇我们介绍了 Requests 的使用，原本是想再来一个实战的，正准备搞事情的时候想起来上次实战还给自己挖了一个坑， Xpath 还没介绍，还是乖乖的先介绍解析库吧。</p>
<h2 id="简介">简介</h2>
<p>XPath ，全称 XML Path Language ，即 XML 路径语言，它是一门在 XML 文档中查找信息的语言。它最初是用来搜寻 XML 文档的，但是它同样适用于 HTML 文档的搜索。</p>
<p>首先，还是敬上 Xpath 的官方网站：https://www.w3.org/TR/xpath/all/ 。</p>
<p>其次，再敬上两个还不错的学习地址：</p>
<p>w3school：https://www.w3school.com.cn/xpath/index.asp</p>
<p>菜鸟教程：https://www.runoob.com/xpath/xpath-tutorial.html</p>
<h2 id="常用路径表达式">常用路径表达式</h2>
<p>下面列出了最有用的路径表达式：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">表达式</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">nodename</td>
<td style="text-align: left;">选取此节点的所有子节点。</td>
</tr>
<tr class="even">
<td style="text-align: left;">/</td>
<td style="text-align: left;">从根节点选取。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">//</td>
<td style="text-align: left;">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>
</tr>
<tr class="even">
<td style="text-align: left;">.</td>
<td style="text-align: left;">选取当前节点。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">..</td>
<td style="text-align: left;">选取当前节点的父节点。</td>
</tr>
<tr class="even">
<td style="text-align: left;">@</td>
<td style="text-align: left;">选取属性。</td>
</tr>
</tbody>
</table>
<p>注意，在使用 Xpath 之前，需要先确保安装好 lxml 库，如果没有安装，可以参考前面的前置准备进行安装。</p>
<h2 id="xpath-演示">Xpath 演示</h2>
<p>首先需要引入 lxml 库的 etree 模块，接着引入 Requests 模块，小编这里直接以自己的博客站用作示例。</p>
<pre><code><code>from lxml import etree
import requests

response = requests.get(&#39;https://www.geekdigging.com/&#39;)
html_str = response.content.decode(&#39;UTF-8&#39;)
html = etree.HTML(html_str)
result = etree.tostring(html, encoding = &#39;UTF-8&#39;).decode(&#39;UTF-8&#39;)
print(result)</code></pre>
<p>结果如下：</p>
<p><img src="./images/小白学 Python 爬虫（19）：Xpath 基操1.png" /></p>
<p>可以看到结果是成功爬取，这里我们首先使用 requests 获取首页的源代码 byte 数据流，接着使用 decode() 进行解码，解码后将字符串传入 etree.HTML() 构建了一个 lxml.etree._Element 对象，接着我们对这个对象做了 tostring() 转换字符串并且进行打印。</p>
<p><strong>注意：</strong> 这里使用 tostring() 进行转化字符串的时候，一定需要添加参数 encoding ，否则中文将会显示为 Unicode 编码。</p>
<h2 id="所有节点">所有节点</h2>
<p>我们构建完成了 Element 对象，接着我们就可以开始愉快的 Xpath 学习了。</p>
<p>我们会用 <code>//</code> 开头的 XPath 规则来选取所有符合要求的节点。示例（依然采用上面的 html ）：</p>
<pre><code><code>result_1 = html.xpath(&#39;//*&#39;)
print(result_1)</code></pre>
<p>结果如下：</p>
<pre><code><code>[&lt;Element html at 0x2a2810ea088&gt;, &lt;Element head at 0x2a2810e0788&gt;, &lt;Element meta at 0x2a2810d8048&gt;, &lt;Element meta at 0x2a2810d8088&gt;, &lt;Element meta at 0x2a280124188&gt;,......</code></pre>
<p>结果太长仅截取部分。</p>
<p>这里使用 * 代表匹配所有节点，也就是整个 HTML 文本中的所有节点都会被获取。可以看到，返回形式是一个列表，每个元素是 Element 类型，其后跟了节点的名称，如 html 、 head 、 meta 等，所有节点都包含在列表中了。</p>
<p>当然，在这里匹配也可以指定节点的名称，例如获取所有的 meta 节点：</p>
<pre><code><code>result_2 = html.xpath(&#39;//meta&#39;)
print(result_2)</code></pre>
<p>结果如下：</p>
<pre><code><code>[&lt;Element meta at 0x1fc9107a2c8&gt;, &lt;Element meta at 0x1fc9107a6c8&gt;, &lt;Element meta at 0x1fc91ff8188&gt;, &lt;Element meta at 0x1fc91ff8108&gt;, &lt;Element meta at 0x1fc91ff8088&gt;, &lt;Element meta at 0x1fc91fc2d88&gt;, &lt;Element meta at 0x1fc91e73988&gt;, &lt;Element meta at 0x1fc91ff81c8&gt;, &lt;Element meta at 0x1fc91f93f08&gt;, &lt;Element meta at 0x1fc9203d2c8&gt;, &lt;Element meta at 0x1fc9203d308&gt;, &lt;Element meta at 0x1fc9203d348&gt;, &lt;Element meta at 0x1fc9203d408&gt;, &lt;Element meta at 0x1fc9203db08&gt;, &lt;Element meta at 0x1fc9203d388&gt;, &lt;Element meta at 0x1fc9203d3c8&gt;, &lt;Element meta at 0x1fc92025c08&gt;, &lt;Element meta at 0x1fc92025b88&gt;, &lt;Element meta at 0x1fc92025c48&gt;, &lt;Element meta at 0x1fc92025cc8&gt;]</code></pre>
<p>这里要选取所有 meta 节点，可以使用 <code>//</code> ，然后直接加上节点名称即可，调用时直接使用 <code>xpath()</code> 方法即可。由于返回的是一个列表，所有要获取特定的某个 meta 的时候，可以直接在 [] 中加索引，例如 <code>[0]</code> 。</p>
<h2 id="子节点">子节点</h2>
<p>获取子节点一般可以使用 <code>/</code> 或者 <code>//</code> 来获取子节点或者孙子节点。</p>
<p>比如现在想获取所有的文章内容的块，如下：</p>
<p><img src="./images/小白学 Python 爬虫（19）：Xpath 基操2.png" /></p>
<p>红框所标识的内容，可以看到 DOM 结构为 <code>&lt;main&gt;</code> 下面的 <code>&lt;article&gt;</code> ，那么这个语句可以这么写：</p>
<pre><code><code>result_3 = html.xpath(&#39;//main/article&#39;)
print(result_3)</code></pre>
<p>结果如下：</p>
<pre><code><code>[&lt;Element article at 0x225ef371c08&gt;, &lt;Element article at 0x225ef372208&gt;, &lt;Element article at 0x225ef3727c8&gt;, &lt;Element article at 0x225ef372d88&gt;, &lt;Element article at 0x225ef373388&gt;, &lt;Element article at 0x225ef373948&gt;, &lt;Element article at 0x225ef373f08&gt;, &lt;Element article at 0x225ef374508&gt;, &lt;Element article at 0x225ef374ac8&gt;, &lt;Element article at 0x225ef3750c8&gt;, &lt;Element article at 0x225ef375688&gt;, &lt;Element article at 0x225ef375c48&gt;]</code></pre>
<p>此处的 <code>/</code> 是用于获取子节点，如果想要获取孙子节点，如 <code>&lt;article&gt;</code> 下面的 <code>&lt;div&gt;</code> ，如下图：</p>
<p><img src="./images/小白学 Python 爬虫（19）：Xpath 基操3.png" /></p>
<p>则可以这么写：</p>
<pre><code><code>result_4 = html.xpath(&#39;//main//div&#39;)
print(result_4)</code></pre>
<p>结果就不贴了，太长了。</p>
<h2 id="父节点">父节点</h2>
<p>我们可以通过 <code>/</code> 和 <code>//</code> 来查找子节点，那么肯定有语法可以查找父节点，不然只能向下查询不能向上查询就有点就有点太傻了。</p>
<p>父节点的查找是通过 <code>..</code> 来实现的，比如我们先找到一篇文章的图片，现在要向上查找它的 <code>&lt;a&gt;</code> ，如下图：</p>
<p><img src="./images/小白学 Python 爬虫（19）：Xpath 基操4.png" /></p>
<p>这里我们通过 <code>alt</code> 属性为 <code>小白学 Python 爬虫（16）：urllib 实战之爬取妹子图</code> 的 <code>&lt;img&gt;</code> ，然后获取它的父节点 <code>&lt;a&gt;</code> ，并且打印他的 <code>href</code> 属性，代码如下：</p>
<pre><code><code>result_5 = html.xpath(&#39;//img[@alt=&quot;小白学 Python 爬虫（16）：urllib 实战之爬取妹子图&quot;]/../@href&#39;)
print(result_5)</code></pre>
<p>结果如下：</p>
<pre><code><code>[&#39;/2019/12/09/1691033431/&#39;]</code></pre>
<p>同时我们获取父节点还可以使用 <code>parent::</code> 。</p>
<pre><code><code>result_6 = html.xpath(&#39;//img[@alt=&quot;小白学 Python 爬虫（16）：urllib 实战之爬取妹子图&quot;]/parent::*/@href&#39;)
print(result_6)</code></pre>
<h2 id="属性过滤">属性过滤</h2>
<p>在选取节点的时候，我们可以使用 <code>@</code> 符号进行属性过滤。</p>
<p>比如我们在选取 <code>&lt;div&gt;</code> 的时候，可以使用 <code>class</code> 为 <code>container</code> 的 <code>&lt;div&gt;</code> 。而在首页的 <code>&lt;section&gt;</code> 的子节点中， <code>class</code> 为 <code>container</code> 的 <code>&lt;div&gt;</code> 只有一个，代码如下：</p>
<pre><code><code>result_7 = html.xpath(&#39;//section/div[@class=&quot;container&quot;]&#39;)
print(result_7)</code></pre>
<p>运行结果如下：</p>
<pre><code><code>[&lt;Element div at 0x251501c2c88&gt;]</code></pre>
<h2 id="示例代码">示例代码</h2>
<p>本系列的所有代码小编都会放在代码管理仓库 Github 和 Gitee 上，方便大家取用。</p>
<p><a href="https://github.com/meteor1993/python-learning/tree/master/python-spider/xpath-demo" title="示例代码-Github">示例代码-Github</a></p>
<p><a href="https://gitee.com/inwsy/python-learning/tree/master/python-spider/xpath-demo" title="示例代码-Gitee">示例代码-Gitee</a></p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>