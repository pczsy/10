<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修.Net Core使用分布式缓存Redis：数据结构' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>.Net Core使用分布式缓存Redis：数据结构</center></div><div class='banquan'>原文出处:本文由博客园博主树杈提供。<br/>
原文连接:https://www.cnblogs.com/xwc1996/p/12013329.html</div><br>
    <h3>一、前言</h3>
<p>本篇主要使用StackExchangeRedis在.Net Core中使用Redis，使用基础见：<a href="https://www.cnblogs.com/xwc1996/p/11973611.html" target="_blank">点击此处。</a></p>
<h3>二、五种基础数据结构</h3>
<p><strong><span style="font-size: 16px;">1.字符串类型String</span></strong></p>
<p>字符串类型是Redis中最基本的数据类型，它能存储任何形式的字符串，包括二进制数据。你可以用其存储用户的邮箱、JSON化的对象甚至是一张图片。一个字符串类型键允许存储地得数据的最大容量是512MB。</p>
<p>字符串类型是其他4种数据类型的基础，其他数据类型和字符串类型的差别从某种角度来说只是组织字符串的形式不同。例如，列表类型是以列表的形式组织字符串，二集合类型是以集合的形式组织字符串。</p>
<p>以下为StackExchangeRedis中字符串常用方法及其命令：</p>
<p>(1)赋值与取值</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #000000;">redisConnection.GetDatabase().StringSetAsync(key, value);
</span><span style="color: #000000;">redisConnection.GetDatabase().StringGetAsync(key); 
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; <span style="color: #0000ff;">set</span><span style="color: #000000;"> stringKey stringValue
OK
</span><span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; <span style="color: #0000ff;">get</span><span style="color: #000000;"> stringKey
</span><span style="color: #800000;">"</span><span style="color: #800000;">stringValue</span><span style="color: #800000;">"</span></pre>
</div>
<p>(2)返回 key 中字符串值的子字符</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #000000;">redisConnection.GetDatabase().StringGetRangeAsync(key, start, end);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; getrange stringKey <span style="color: #800080;">6</span> <span style="color: #800080;">10</span>
<span style="color: #800000;">"</span><span style="color: #800000;">Value</span><span style="color: #800000;">"</span></pre>
</div>
<p>(3)将给定 key 的值设为 value ，并返回 key 的旧值(old value)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> oldvalue = <span style="color: #0000ff;">await</span><span style="color: #000000;"> redisConnection.GetDatabase().StringGetSetAsync(key, oldkey);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> getset stringKey newValue
</span><span style="color: #800000;">"</span><span style="color: #800000;">stringValue</span><span style="color: #800000;">"</span></pre>
</div>
<p>(4)如果 key 已经存在并且是一个字符串， APPEND 命令将指定的 value 追加到该 key 原来值（value）的末尾</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #000000;">redisConnection.GetDatabase().StringAppendAsync(key, appendValue);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> append stringKey append
(integer) </span><span style="color: #800080;">14</span><span style="color: #800080;"><br /></span></pre>
</div>
<p><span style="font-size: 16px;"><strong>2.散列类型Hash</strong></span></p>
<p>Redis是采用字典结构以键值对的形式存储数据的，而Hash的键值也是一种字典结构，其存储了字段(field)和字段值的映射，但字段值只能是字符串，不支持其他数据类型，不能嵌套其他数据类型(其他数据类型同理)。</p>
<p>散列类型适合存储对象：使用对象类别和ID构成键名，使用字段表示对象的属性，而字段值则存储属性值。例如要存储ID为2的汽车对象，可以分别使用名为color、name和price的三个字段来存储该辆汽车的颜色、名称和价格。</p>
<p>以下为StackExchangeRedis中散列类型常用方法及其命令：</p>
<p>(1)赋值</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
HashEntry[] hashEntry = <span style="color: #0000ff;">new</span><span style="color: #000000;"> HashEntry[] {
　　</span><span style="color: #0000ff;">new</span> HashEntry(<span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>,<span style="color: #800080;">2</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> HashEntry(<span style="color: #800000;">"</span><span style="color: #800000;">color</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">red</span><span style="color: #800000;">"</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> HashEntry(<span style="color: #800000;">"</span><span style="color: #800000;">price</span><span style="color: #800000;">"</span>,<span style="color: #800080;">200</span><span style="color: #000000;">),
};
</span>redisConnection.GetDatabase().HashSetAsync(<span style="color: #800000;">"</span><span style="color: #800000;">youCar</span><span style="color: #800000;">"</span><span style="color: #000000;">, hashEntry);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; hset myCar price <span style="color: #800080;">200</span><span style="color: #000000;">
(integer) </span><span style="color: #800080;">1</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> hset mCar color blue
(integer) </span><span style="color: #800080;">1</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> hset mCar name tractor
(integer) </span><span style="color: #800080;">1</span></pre>
</div>
<p>(2)取值</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
redisConnection.GetDatabase().HashGetAsync(<span style="color: #800000;">"</span><span style="color: #800000;">youCar</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">color</span><span style="color: #800000;">"</span><span style="color: #000000;">);
redisConnection.GetDatabase().HashGetAllAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">youCar</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> hget youCar color
</span><span style="color: #800000;">"</span><span style="color: #800000;">red</span><span style="color: #800000;">"</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> hgetall youCar
</span><span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">2</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) <span style="color: #800000;">"</span><span style="color: #800000;">color</span><span style="color: #800000;">"</span>
<span style="color: #800080;">4</span>) <span style="color: #800000;">"</span><span style="color: #800000;">red</span><span style="color: #800000;">"</span>
<span style="color: #800080;">5</span>) <span style="color: #800000;">"</span><span style="color: #800000;">price</span><span style="color: #800000;">"</span>
<span style="color: #800080;">6</span>) <span style="color: #800000;">"</span><span style="color: #800000;">200</span><span style="color: #800000;">"</span></pre>
</div>
<p>(3)获取所有散列类型中的字段</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> keys = redisConnection.GetDatabase().HashKeys(<span style="color: #800000;">"</span><span style="color: #800000;">youCar</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> hkeys youCar
</span><span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">color</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) <span style="color: #800000;">"</span><span style="color: #800000;">price</span><span style="color: #800000;">"</span></pre>
</div>
<p><span style="font-size: 16px;"><strong>3.列表List</strong></span></p>
<p>列表类型(List)可以存储一个有序的字符串列表，常用的操作是向列表两端添加元素，或者获得列表的一个片段。</p>
<p>列表类型内部是使用双向链表(double linked list)实现的，所以向列表两段添加元素的时间复杂都为O(1)，获取越接近两端的元素速度就越快。这意味着即使是一个由几千万个元素的列表，获取头部或者尾部的10条记录也是极快的。</p>
<p>不过使用链表的代价是通过索引访问元素比较慢。于是，列表类型很适合于如社交网站的新鲜事、记录日志、消息队列等，类似获取最前几条的数据、从列表尾部插入等场景。</p>
<p>以下为StackExchangeRedis中列表类型常用方法及其命令：</p>
<p>(1)向列表两端增加元素</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
redisConnection.GetDatabase().ListLeftPushAsync(<span style="color: #800000;">"</span><span style="color: #800000;">myList</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">head1</span><span style="color: #800000;">"</span><span style="color: #000000;">);
redisConnection.GetDatabase().ListRightPush(</span><span style="color: #800000;">"</span><span style="color: #800000;">myList</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">bottom1</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> lpush myList head1
(integer) </span><span style="color: #800080;">1</span><span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> rpush myList bottom1
(integer) </span><span style="color: #800080;">2</span></pre>
</div>
<p>(2)从列表两端移除并获取一个元素</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> value = redisConnection.GetDatabase().ListLeftPopAsync(<span style="color: #800000;">"</span><span style="color: #800000;">myList</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> value = redisConnection.GetDatabase().ListRightPopAsync(<span style="color: #800000;">"</span><span style="color: #800000;">myList</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> lpop myList
</span><span style="color: #800000;">"</span><span style="color: #800000;">head1</span><span style="color: #800000;">"</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> rpop myList
</span><span style="color: #800000;">"</span><span style="color: #800000;">bottom1</span><span style="color: #800000;">"</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> rpop myList
(nil)</span></pre>
</div>
<p>(3)获取列表中的元素片段(不删除只获取)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> value = redisConnection.GetDatabase().ListRangeAsync(<span style="color: #800000;">"</span><span style="color: #800000;">myList</span><span style="color: #800000;">"</span>,<span style="color: #800080;">0</span>,<span style="color: #800080;">2</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; lrange myList <span style="color: #800080;">0</span> <span style="color: #800080;">2</span>
<span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">1</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">2</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) <span style="color: #800000;">"</span><span style="color: #800000;">3</span><span style="color: #800000;">"</span></pre>
</div>
<p><span style="font-size: 16px;"><strong>4.集合Set</strong></span></p>
<p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。常用的操作是向集合加入或者删除元素、判断某个元素是否存在等，由于Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p>
<p>最方便的是多个集合类型键之间还可以进行并集、交集和差集运算。</p>
<p>可以运用在共同好友、喜好和好友推荐(交集超过阈值)等可以运用交差并集操作的场景。</p>
<p>以下为StackExchangeRedis中集合类型常用方法及其命令：</p>
<p>(1)增加/删除元素(可多个，相同元素自动忽略)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
redisConnection.GetDatabase().SetAddAsync(<span style="color: #800000;">"</span><span style="color: #800000;">mySet</span><span style="color: #800000;">"</span>, <span style="color: #0000ff;">new</span> RedisValue[] { <span style="color: #800000;">"</span><span style="color: #800000;">a</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">b</span><span style="color: #800000;">"</span><span style="color: #000000;"> });
redisConnection.GetDatabase().SetRemoveAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">mySet</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">a</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> sadd mySet a
(integer) </span><span style="color: #800080;">1</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> sadd mySet a b c
(integer) </span><span style="color: #800080;">2</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> srem mySet c
(integer) </span><span style="color: #800080;">1</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> srem mySet b a
(integer) </span><span style="color: #800080;">2</span></pre>
</div>
<p>(2)获取交集</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> value = redisConnection.GetDatabase().SetCombine(SetOperation.Intersect, <span style="color: #800000;">"</span><span style="color: #800000;">mySet1</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">mySet2</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> sadd mySet1 a b c
(integer) </span><span style="color: #800080;">3</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> sadd mySet2 b c d
(integer) </span><span style="color: #800080;">3</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> sinter mySet1 mySet2
</span><span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">c</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">b</span><span style="color: #800000;">"</span></pre>
</div>
<p><span style="font-size: 16px;"><strong>5.有序集合Sort Set</strong></span></p>
<p>从有序集合的名字就可以看出它和集合的区别就是&rdquo;有序&ldquo;二字。</p>
<p>在集合类型的基础尚有序集合类型为集合中的每个元素都关联了一个分数，按分数大小进行从小到大的排序，这使得我们不仅可以完成插入、删除和判断元素是否在等集合类型支持的操作，还能够获得分数最高(或最低)的前N个元素、获得指定分数范围内的元素等与分数有关的操作。虽然集合中每个元素都是不同的，但是它们的分数却可以相同。</p>
<p>有序集合类型在某方面和列表类型有些相似</p>
<ul>
<li>
<p>二者都是有序。</p>
</li>
<li>
<p>二者都可以获取某一范围的元素</p>
</li>
</ul>
<p>但是二者由这很大的区别，这使得他们的应用场景有所不同。</p>
<ul>
<li>
<p>列表是通过链表实现的，获取靠近两端的数据速度极快，而当元素增多后，访问中间元素的速度会较慢，所以它更加适合实现如&ldquo;新鲜事&rdquo;或&ldquo;日志&rdquo;这样很少访问中间元素的应用。</p>
</li>
<li>
<p>有序集合是使用散列表和跳表(skip list)实现的，所以即使读取文娱中间部分的数据速度也快(时间复杂度是O(log(N)))。</p>
</li>
<li>
<p>列表中不能简单地调整元素的位置，但有序集合可以(通过更改元素的分数)，所以可以用于排行榜、权重应用(有权重的消息队列)。</p>
</li>
<li>
<p>有序集合要比类别更耗内存。</p>
</li>
</ul>
<p>以下为StackExchangeRedis中有序集合类型常用方法及其命令：</p>
<p>(1)增加元素</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
SortedSetEntry[] sortedSetEntry = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SortedSetEntry[] {
　　</span><span style="color: #0000ff;">new</span> SortedSetEntry(<span style="color: #800000;">"</span><span style="color: #800000;">tom</span><span style="color: #800000;">"</span>,<span style="color: #800080;">10</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> SortedSetEntry(<span style="color: #800000;">"</span><span style="color: #800000;">peter</span><span style="color: #800000;">"</span>,<span style="color: #800080;">20</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> SortedSetEntry(<span style="color: #800000;">"</span><span style="color: #800000;">david</span><span style="color: #800000;">"</span>,<span style="color: #800080;">30</span><span style="color: #000000;">),
};
redisConnection.GetDatabase().SortedSetAddAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">mySs</span><span style="color: #800000;">"</span><span style="color: #000000;">, sortedSetEntry);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; zadd mySs <span style="color: #800080;">10</span> tom <span style="color: #800080;">20</span> peter <span style="color: #800080;">30</span><span style="color: #000000;"> david
(integer) </span><span style="color: #800080;">3</span></pre>
</div>
<p>(2)获取排名在某个分数范围的元素列表</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> value = redisConnection.GetDatabase().SortedSetRemoveRangeByScoreAsync(<span style="color: #800000;">"</span><span style="color: #800000;">mySs</span><span style="color: #800000;">"</span>, <span style="color: #800080;">10</span>, <span style="color: #800080;">20</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; zrangebyscore mySs <span style="color: #800080;">10</span> <span style="color: #800080;">20</span>
<span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">tom</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">peter</span><span style="color: #800000;">"</span></pre>
</div>
<p>(3)增加某个元素的分数</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> sorce = redisConnection.GetDatabase().SortedSetIncrementAsync(<span style="color: #800000;">"</span><span style="color: #800000;">mySs</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">top</span><span style="color: #800000;">"</span>, <span style="color: #800080;">3</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; zincrby mySs <span style="color: #800080;">3</span><span style="color: #000000;"> tom
</span><span style="color: #800000;">"</span><span style="color: #800000;">13</span><span style="color: #800000;">"</span></pre>
</div>
<p><span style="font-size: 16px;"><strong>6.小结</strong></span></p>
<p>上面各类型所举得例子有限，基本所有的Redis命令在StackExchangeRedis中都有相应的异步和同步的方法，大家可以参考<a href="https://redis.io/commands" target="_blank">https://redis.io/commands</a>。</p>
<h3>三、其他数据结构</h3>
<p><strong><span style="font-size: 16px;">1.HyperLogLog</span></strong></p>
<p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构(其本身也是一种算法)。</p>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>
<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>
<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<p>所以主要应用于：</p>
<ul>
<li>
<p>统计访问IP数量；</p>
</li>
<li>
<p>统计搜索关键词数量；</p>
</li>
<li>
<p>统计用户在线数；</p>
</li>
<li>
<p>等等大数量统计。</p>
</li>
</ul>
<p>以下为StackExchangeRedis中常用方法及其命令：</p>
<p>(1)添加指定元素到 HyperLogLog 中</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
RedisValue[] redisValue = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RedisValue[] {
    </span><span style="color: #800080;">110</span>,<span style="color: #800080;">120</span>,<span style="color: #800080;">130</span>,<span style="color: #800080;">130</span><span style="color: #000000;">
};
redisConnection.GetDatabase().HyperLogLogAddAsync(</span><span style="color: #800000;">"</span><span style="color: #800000;">key</span><span style="color: #800000;">"</span><span style="color: #000000;">, redisValue);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; pfadd hyperlogKy <span style="color: #800080;">110</span> <span style="color: #800080;">120</span> <span style="color: #800080;">130</span> <span style="color: #800080;">130</span><span style="color: #000000;">
(integer) </span><span style="color: #800080;">1</span></pre>
</div>
<p>(2)返回给定 HyperLogLog 的基数估算值。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> count = redisConnection.GetDatabase().HyperLogLogLength(<span style="color: #800000;">"</span><span style="color: #800000;">key</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> pfcount hyperlogKy
(integer) </span><span style="color: #800080;">3</span></pre>
</div>
<p><strong><span style="font-size: 16px;">2.geo</span></strong></p>
<p>Redis在3.2版本之后新增了一个geo(地理位置)，其数据结构为有序集合sort set。</p>
<p>geo可以将地理位置信息(经纬度)储存起来，并计算两个地理坐标之间的位置、返回以指定位置为圆心指定半径内的所有地理位置信息等。</p>
<p>像是我们平时的打车、租房地图等功能中就可以用到。</p>
<p>既然前面说到geo是有序集合那它的score怎么来？是我们自己输入嘛？其实是通过我们存储的经纬度通过geohash计算后的base32编码字符串。<a href="https://www.cnblogs.com/LBSer/p/3310455.html" target="_blank">geohash原理点击此处。</a></p>
<p>以下为StackExchangeRedis中常用方法及其命令：</p>
<p>(1)添加地理位置</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
GeoEntry[] geoEntry = <span style="color: #0000ff;">new</span><span style="color: #000000;"> GeoEntry[] {
　　</span><span style="color: #0000ff;">new</span> GeoEntry(<span style="color: #800080;">120.20000</span>, <span style="color: #800080;">30.26667</span>, <span style="color: #800000;">"</span><span style="color: #800000;">hangzhou</span><span style="color: #800000;">"</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> GeoEntry(<span style="color: #800080;">116.41667</span>, <span style="color: #800080;">39.91667</span>, <span style="color: #800000;">"</span><span style="color: #800000;">beijing</span><span style="color: #800000;">"</span><span style="color: #000000;">),
　　</span><span style="color: #0000ff;">new</span> GeoEntry(<span style="color: #800080;">121.47</span>, <span style="color: #800080;">31.23</span>, <span style="color: #800000;">"</span><span style="color: #800000;">shanghai</span><span style="color: #800000;">"</span><span style="color: #000000;">),
};
redisConnection.GetDatabase().GeoAdd(</span><span style="color: #800000;">"</span><span style="color: #800000;">city</span><span style="color: #800000;">"</span><span style="color: #000000;">, geoEntry);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; geoadd city <span style="color: #800080;">120.20000</span> <span style="color: #800080;">30.26667</span> hangzhou  <span style="color: #800080;">116.41667</span> <span style="color: #800080;">39.91667</span> beijing <span style="color: #800080;">121.47</span> <span style="color: #800080;">31.23</span><span style="color: #000000;"> shanghai
(integer) </span><span style="color: #800080;">3</span></pre>
</div>
<p>(2)获取geohash</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> geohash = redisConnection.GetDatabase().GeoHash(<span style="color: #800000;">"</span><span style="color: #800000;">city</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">hanghzou</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> geohash city hangzhou
</span><span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">wtmkpjyuph0</span><span style="color: #800000;">"</span></pre>
</div>
<p>(3)获取指定元素范围的地理信息位置集合</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> geo = redisConnection.GetDatabase().GeoRadius(<span style="color: #800000;">"</span><span style="color: #800000;">city</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">hanghzou</span><span style="color: #800000;">"</span>, <span style="color: #800080;">300</span>, GeoUnit.Kilometers, <span style="color: #800080;">10</span><span style="color: #000000;">, Order.Ascending, GeoRadiusOptions.WithGeoHash);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; georadiusbymember city hangzhou <span style="color: #800080;">300</span> km withcoord withdist withhash asc count <span style="color: #800080;">10</span>
<span style="color: #800080;">1</span>) <span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">hangzhou</span><span style="color: #800000;">"</span>
   <span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">0.0000</span><span style="color: #800000;">"</span>
   <span style="color: #800080;">3</span>) (integer) <span style="color: #800080;">4054134205316048</span>
   <span style="color: #800080;">4</span>) <span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">120.20000249147415</span><span style="color: #800000;">"</span>
      <span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">30.266670658987586</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">shanghai</span><span style="color: #800000;">"</span>
   <span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">161.9183</span><span style="color: #800000;">"</span>
   <span style="color: #800080;">3</span>) (integer) <span style="color: #800080;">4054803462927619</span>
   <span style="color: #800080;">4</span>) <span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">121.47000163793564</span><span style="color: #800000;">"</span>
      <span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">31.229999039757836</span><span style="color: #800000;">"</span></pre>
</div>
<div>
<div>
<p>在给定以下可选项时， 命令会返回额外的信息：</p>
<ul>
<li>
<p>WITHDIST ： 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</p>
</li>
<li>
<p>WITHCOORD ： 将位置元素的经度和维度也一并返回。</p>
</li>
<li>
<p>WITHHASH ： 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。</p>
</li>
<li>
<p>ASC ： 根据中心的位置， 按照从近到远的方式返回位置元素。DESC ： 根据中心的位置， 按照从远到近的方式返回位置元素。</p>
</li>
</ul>
<p>它还有个类似的georadius命令，区别是由给定的经纬度为圆心。</p>
</div>
(4)计算两个位置之间的距离</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> geo = redisConnection.GetDatabase().GeoDistance(<span style="color: #800000;">"</span><span style="color: #800000;">city</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">hanghzou</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">beijing</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> geodist city hangzhou beijing km
</span><span style="color: #800000;">"</span><span style="color: #800000;">1126.8937</span><span style="color: #800000;">"</span></pre>
</div>
<p><strong><span style="font-size: 16px;">3.发布订阅pub/sub&nbsp;</span></strong></p>
<p>"发布/订阅"模式中包含两种角色，分别是发布者和订阅者。订阅者可以订阅一个或者若干个频道(channel)，而发布者可以向指定的频道发送消息，所有订阅此频道的订阅者都会收到此消息。</p>
<p>发布者通过publish命令发送消息：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> publish channel_1 hi
(integer) </span><span style="color: #800080;">0</span>
<span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">var</span> count = redisConnection.GetSubscriber().Publish(<span style="color: #800000;">"</span><span style="color: #800000;">channel_1</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">hi</span><span style="color: #800000;">"</span>);</pre>
</div>
<p>消息是发送出去了，publish命令的返回值表示接收到这条消息的订阅者数量。因为当前没有订阅这订阅这个频道，所以返回0。</p>
<p>注意，发送出去的消息是不会持久化的，订阅者只能收到订阅之后发布者发送的消息。</p>
<p>订阅者通过subscribe命令订阅一个或者多个频道：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt;<span style="color: #000000;"> subscribe channel_1 channel_2
Reading messages... (press Ctrl</span>-<span style="color: #000000;">C to quit)
</span><span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">subscribe</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">channel_1</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) (integer) <span style="color: #800080;">1</span>
<span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">subscribe</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">channel_2</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) (integer) <span style="color: #800080;">2</span>
<span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">message</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">channel_1</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) <span style="color: #800000;">"</span><span style="color: #800000;">hi</span><span style="color: #800000;">"</span>
<span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">)
{
　　redisConnection.GetSubscriber().Subscribe(</span><span style="color: #800000;">"</span><span style="color: #800000;">channel_1</span><span style="color: #800000;">"</span>, (channel, message) =&gt;<span style="color: #000000;">
　　{
　　　　</span><span style="color: #0000ff;">var</span> msg = message;<span style="color: #008000;">//</span><span style="color: #008000;">收到的消息</span>
　　　　<span style="color: #0000ff;">var</span> chan = channel;<span style="color: #008000;">//</span><span style="color: #008000;">频道名称</span>
<span style="color: #000000;">　　});
}</span></pre>
</div>
<p>执行subscribe命令之后进入订阅状态，可能收到三种类型的回复。每种类型的回复都包含三个值，第一个值是消息的类型，根据消息类型的不同，第二、三个值得含义也不同。消息类型可能得取值有以下三个：</p>
<ul>
<li>
<p>subscribe：表示订阅成功得反馈信息。第二个值是订阅成功得频道名称，第三个值是当前客户端订阅得频道数量。</p>
</li>
<li>
<p>message：这个类型得回复是我们最关心得，它表示接收到得消息。第二个值表示禅师消息的频道名称，第三个值是消息的内容。</p>
</li>
<li>
<p>unsubscribe：表示成功取消订阅某个频道。第二个值是对应频道的名称，第三个值是当前客户端订阅的频道数量。</p>
</li>
</ul>
<p>StackExchangeRedis中用到message和unsubscribe这两种。</p>
<p>&nbsp;除了通过频道名之外，还可以使用psubscribe命令通过规则订阅频道。如约定规则为channel_?*则可以匹配channel_为开头的频道，如channel_1、channel_2等。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">命令</span>
<span style="color: #800080;">127.0</span>.<span style="color: #800080;">0.1</span>:<span style="color: #800080;">6379</span>&gt; psubscribe cahnnel_?*<span style="color: #000000;">
Reading messages... (press Ctrl</span>-<span style="color: #000000;">C to quit)
(integer) </span><span style="color: #800080;">1</span>
<span style="color: #800080;">1</span>) <span style="color: #800000;">"</span><span style="color: #800000;">psubscribe</span><span style="color: #800000;">"</span>
<span style="color: #800080;">2</span>) <span style="color: #800000;">"</span><span style="color: #800000;">cahnnel_?*</span><span style="color: #800000;">"</span>
<span style="color: #800080;">3</span>) (integer) <span style="color: #800080;">1</span>
<span style="color: #008000;">//</span><span style="color: #008000;">方法</span>
<span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">)
{
　　redisConnection.GetSubscriber().Subscribe(</span><span style="color: #800000;">"</span><span style="color: #800000;">channel_?*</span><span style="color: #800000;">"</span>, (channel, message) =&gt;<span style="color: #000000;">
　　{
　　　　</span><span style="color: #0000ff;">var</span> msg = message;<span style="color: #008000;">//</span><span style="color: #008000;">收到的消息</span>
　　　　<span style="color: #0000ff;">var</span> chan = channel;<span style="color: #008000;">//</span><span style="color: #008000;">频道名称</span>
　　<span style="color: #000000;">});
}</span></pre>
</div>
<p>解除订阅通过命令unsubscribe，如果不指定频道则取消全部订阅。在StackExchangeRedis中分别时方法Unsubscribe()和UnsubscribeAll()。</p>
</div>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>