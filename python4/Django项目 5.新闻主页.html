<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Django项目 5.新闻主页' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Django项目 5.新闻主页</center></div><div class='banquan'>原文出处:本文由博客园博主Tmclri提供。<br/>
原文连接:https://www.cnblogs.com/Tmclri/p/11545227.html</div><br>
    <h2 class="md-end-block md-heading"><span class="md-plain">一、功能需求分析</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain md-expand">1.功能</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">轮播图</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">推荐文章列表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">文章标签导航</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">文章列表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">分页</span></p>
</li>
</ol>
<h2 class="md-end-block md-heading"><span class="md-plain">二、模型设计</span></h2>
<p class="md-end-block md-p"><span class="md-plain">根据功能分析，我们需要如下表</span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">1.表和字段分析</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">文章分类表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">文章表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">文章评论表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">推荐文章表</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">轮播图表</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">2.模型定义</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">定义一个基类模型，抽取公共字段</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在utils目录下，创建一个models.py文件，在其中定义一个基类模型</span>
<span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> BaseModel(models.Model):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    基类，公共字段
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    create_time </span>= models.DateTimeField(<span style="color: #800000;">'</span><span style="color: #800000;">创建时间</span><span style="color: #800000;">'</span>, auto_now_add=<span style="color: #000000;">True)
    update_time </span>= models.DateTimeField(<span style="color: #800000;">'</span><span style="color: #800000;">更新时间</span><span style="color: #800000;">'</span>, auto_now=<span style="color: #000000;">True)
    is_delete </span>= models.BooleanField(<span style="color: #800000;">'</span><span style="color: #800000;">逻辑删除</span><span style="color: #800000;">'</span>, default=<span style="color: #000000;">False)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 抽象类，用于继承，迁移时不会创建</span>
        abstract = True</pre>
</div>
<p>定义其他模型</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news目录下的models.py文件中定义如下数据模型</span>
<span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models
</span><span style="color: #0000ff;">from</span> utils.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> BaseModel


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Tag(BaseModel):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    文章分类标签模型
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    name </span>= models.CharField(<span style="color: #800000;">'</span><span style="color: #800000;">标签名</span><span style="color: #800000;">'</span>, max_length=64, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">标签名</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        ordering </span>= [<span style="color: #800000;">'</span><span style="color: #800000;">-update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-id</span><span style="color: #800000;">'</span>]      <span style="color: #008000;">#</span><span style="color: #008000;"> 排序</span>
        db_table = <span style="color: #800000;">"</span><span style="color: #800000;">tb_tag</span><span style="color: #800000;">"</span>                     <span style="color: #008000;">#</span><span style="color: #008000;"> 指明数据库表名</span>
        verbose_name = <span style="color: #800000;">"</span><span style="color: #800000;">文章标签</span><span style="color: #800000;">"</span>                <span style="color: #008000;">#</span><span style="color: #008000;"> 在admin站点中显示的名称</span>
        verbose_name_plural = verbose_name      <span style="color: #008000;">#</span><span style="color: #008000;"> 显示的复数名称</span>

    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.name


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> News(BaseModel):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    文章模型
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    title </span>= models.CharField(<span style="color: #800000;">'</span><span style="color: #800000;">标题</span><span style="color: #800000;">'</span>, max_length=150, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">标题</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    digest </span>= models.CharField(<span style="color: #800000;">'</span><span style="color: #800000;">摘要</span><span style="color: #800000;">'</span>, max_length=200, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">摘要</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    content </span>= models.TextField(<span style="color: #800000;">'</span><span style="color: #800000;">内容</span><span style="color: #800000;">'</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">内容</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    clicks </span>= models.IntegerField(<span style="color: #800000;">'</span><span style="color: #800000;">点击量</span><span style="color: #800000;">'</span>, default=0, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">点击量</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    image_url </span>= models.URLField(<span style="color: #800000;">'</span><span style="color: #800000;">图片url</span><span style="color: #800000;">'</span>, default=<span style="color: #800000;">''</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">图片url</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    tag </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">Tag</span><span style="color: #800000;">'</span>, on_delete=models.SET_NULL, null=<span style="color: #000000;">True)

    author </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">user.User</span><span style="color: #800000;">'</span>, on_delete=models.SET_NULL, null=<span style="color: #000000;">True)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        ordering </span>= [<span style="color: #800000;">'</span><span style="color: #800000;">-update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-id</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 排序</span>
        db_table = <span style="color: #800000;">"</span><span style="color: #800000;">tb_news</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 指明数据库表名</span>
        verbose_name = <span style="color: #800000;">"</span><span style="color: #800000;">新闻</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 在admin站点中显示的名称</span>
        verbose_name_plural = verbose_name  <span style="color: #008000;">#</span><span style="color: #008000;"> 显示的复数名称</span>

    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.title


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Comments(BaseModel):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    评论模型
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    content </span>= models.TextField(<span style="color: #800000;">'</span><span style="color: #800000;">内容</span><span style="color: #800000;">'</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">内容</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    author </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">user.User</span><span style="color: #800000;">'</span>, on_delete=models.SET_NULL, null=<span style="color: #000000;">True)
    news </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">News</span><span style="color: #800000;">'</span>, on_delete=<span style="color: #000000;">models.CASCADE)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        ordering </span>= [<span style="color: #800000;">'</span><span style="color: #800000;">-update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-id</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 排序</span>
        db_table = <span style="color: #800000;">"</span><span style="color: #800000;">tb_comments</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 指明数据库表名</span>
        verbose_name = <span style="color: #800000;">"</span><span style="color: #800000;">评论</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 在admin站点中显示的名称</span>
        verbose_name_plural = verbose_name  <span style="color: #008000;">#</span><span style="color: #008000;"> 显示的复数名称</span>

    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">&lt;评论{}&gt;</span><span style="color: #800000;">'</span><span style="color: #000000;">.format(self.id)


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> HotNews(BaseModel):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    推荐文章表
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    news </span>= models.OneToOneField(<span style="color: #800000;">'</span><span style="color: #800000;">News</span><span style="color: #800000;">'</span>, on_delete=<span style="color: #000000;">models.CASCADE)
    priority </span>= models.IntegerField(<span style="color: #800000;">'</span><span style="color: #800000;">优先级</span><span style="color: #800000;">'</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">优先级</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        ordering </span>= [<span style="color: #800000;">'</span><span style="color: #800000;">-update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-id</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 排序</span>
        db_table = <span style="color: #800000;">"</span><span style="color: #800000;">tb_hotnews</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 指明数据库表名</span>
        verbose_name = <span style="color: #800000;">"</span><span style="color: #800000;">热门新闻</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 在admin站点中显示的名称</span>
        verbose_name_plural = verbose_name  <span style="color: #008000;">#</span><span style="color: #008000;"> 显示的复数名称</span>

    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">&lt;热门新闻{}&gt;</span><span style="color: #800000;">'</span><span style="color: #000000;">.format(self.id)


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Banner(BaseModel):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    轮播图
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">
    image_url </span>= models.URLField(<span style="color: #800000;">'</span><span style="color: #800000;">轮播图url</span><span style="color: #800000;">'</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">轮播图url</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    priority </span>= models.IntegerField(<span style="color: #800000;">'</span><span style="color: #800000;">优先级</span><span style="color: #800000;">'</span>, help_text=<span style="color: #800000;">'</span><span style="color: #800000;">优先级</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    news </span>= models.OneToOneField(<span style="color: #800000;">'</span><span style="color: #800000;">News</span><span style="color: #800000;">'</span>, on_delete=<span style="color: #000000;">models.CASCADE)

    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        ordering </span>= [<span style="color: #800000;">'</span><span style="color: #800000;">priority</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-update_time</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-id</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 排序</span>
        db_table = <span style="color: #800000;">"</span><span style="color: #800000;">tb_banner</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 指明数据库表名</span>
        verbose_name = <span style="color: #800000;">"</span><span style="color: #800000;">轮播图</span><span style="color: #800000;">"</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 在admin站点中显示的名称</span>
        verbose_name_plural = verbose_name  <span style="color: #008000;">#</span><span style="color: #008000;"> 显示的复数名称</span>

    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">&lt;轮播图{}&gt;</span><span style="color: #800000;">'</span>.format(self.id)</pre>
</div>
<h2 class="md-end-block md-heading md-focus"><span class="md-plain">三、文章标签导航功能</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.接口设计</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">GET</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">无参数</span></span></td>
</tr>
</tbody>
</table>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">返回结果</span></p>
<p class="md-end-block md-p"><span class="md-plain">返回新闻页面，直接在模板渲染</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">2.后端代码</span></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/views.py文件中定义如下视图</span>
<span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render

</span><span style="color: #0000ff;">from</span> .models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Tag


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    新闻首页视图
    :param request:
    :return:
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">

    tags </span>= Tag.objects.only(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>).filter(is_delete=<span style="color: #000000;">False)
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">news/index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                  context</span>=<span style="color: #000000;">{
                      </span><span style="color: #800000;">'</span><span style="color: #800000;">tags</span><span style="color: #800000;">'</span><span style="color: #000000;">: tags
                  })</span></pre>
</div>
<p>导入tag测试数据,或者直接用Navicat软件在tb_tag表中添加数据(数据见下方代码中引号里的内容,共6个),,,因为前段设置的原因,必须要跟我的内容一样,后面会用到</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"># insert news tag data

INSERT INTO tb_tag(name, create_time, update_time, is_delete) values
(</span><span style="color: #800000;">'</span><span style="color: #800000;">Python基础</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span><span style="color: #000000;">),
(</span><span style="color: #800000;">'</span><span style="color: #800000;">Python高级</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span><span style="color: #000000;">),
(</span><span style="color: #800000;">'</span><span style="color: #800000;">Python函数</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span><span style="color: #000000;">),
(</span><span style="color: #800000;">'</span><span style="color: #800000;">PythonGUI</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span><span style="color: #000000;">),
(</span><span style="color: #800000;">'</span><span style="color: #800000;">Linux教程</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span><span style="color: #000000;">),
(</span><span style="color: #800000;">'</span><span style="color: #800000;">Python框架</span><span style="color: #800000;">'</span>, now(), now(), <span style="color: #800080;">0</span>);</pre>
</div>
<h4 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">3.前端代码</span></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"># 修改templates/news/index.html中 news-nav部分代码如：
        </span><span style="color: #008000;">&lt;!--</span><span style="color: #008000;">  news-nav start</span><span style="color: #008000;">--&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">nav </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-nav"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="clearfix"</span><span style="color: #0000ff;">&gt;</span>
                  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="active"</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:void(0)"</span><span style="color: #0000ff;">&gt;</span>最新资讯<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                    {% for tag in tags %}
                        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:void(0)"</span><span style="color: #ff0000;"> data-id</span><span style="color: #0000ff;">="{{ tag.id }}"</span><span style="color: #0000ff;">&gt;</span>{{ tag.name }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
                  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
                    {% endfor %}
              </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">nav</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">  news-nav end </span><span style="color: #008000;">--&gt;</span></pre>
</div>
<h2 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">四、新闻列表功能</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1.业务流程分析</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断前端传递标签分类id是否为空，是否为整数，是否超过范围</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">判断前端传递当前文章页数是否为空，是否为整数，是否超过范围</span></p>
</li>
</ol>
<h4 class="md-end-block md-heading"><span class="md-plain">2.接口设计</span></h4>
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">GET</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/news/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">查询参数</span></span></td>
</tr>
</tbody>
</table>
<p class="md-end-block md-p"><span class="md-plain">参数说明：</span></p>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">参数名</span></span></th><th><span class="td-span"><span class="md-plain">类型</span></span></th><th><span class="td-span"><span class="md-plain">是否必须</span></span></th><th><span class="td-span"><span class="md-plain">描述</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">tag</span></span></td>
<td><span class="td-span"><span class="md-plain">整数</span></span></td>
<td><span class="td-span"><span class="md-plain">是</span></span></td>
<td><span class="td-span"><span class="md-plain">标签分类id</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">page</span></span></td>
<td><span class="td-span"><span class="md-plain">整数</span></span></td>
<td><span class="td-span"><span class="md-plain">是</span></span></td>
<td><span class="td-span"><span class="md-plain">当前文章页数</span></span></td>
</tr>
</tbody>
</table>
<p class="md-end-block md-p"><span class="md-plain">返回结果：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
    </span><span style="color: #800000;">"</span><span style="color: #800000;">errno</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">0</span><span style="color: #800000;">"</span><span style="color: #000000;">, 
     </span><span style="color: #800000;">"</span><span style="color: #800000;">errmsg</span><span style="color: #800000;">"</span>: <span style="color: #800000;">""</span><span style="color: #000000;">, 
    </span><span style="color: #800000;">"</span><span style="color: #800000;">data</span><span style="color: #800000;">"</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">"</span><span style="color: #800000;">total_pages</span><span style="color: #800000;">"</span>: <span style="color: #800080;">61</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">news</span><span style="color: #800000;">"</span><span style="color: #000000;">: [
            {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">xxx</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">digest</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">在python用import或者from...import或者from...import...as...来导入相应的模块，作用和使用方法与C语言的include头文件类似。其实就是引入...</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">title</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">import方法引入模块详解</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">author</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">python</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">image_url</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">/media/jichujiaochen.jpeg</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">tag_name</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">Python基础</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">update_time</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">2018年12月17日 14:48</span><span style="color: #800000;">"</span><span style="color: #000000;">
            },
            {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">xxx</span><span style="color: #800000;">'</span>
                <span style="color: #800000;">"</span><span style="color: #800000;">digest</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">如果你原来是一个php程序员，你对于php函数非常了解（PS：站长原来就是一个php程序员），但是现在由于工作或者其他原因要学习python，但是p...</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">title</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">给曾经是phper的程序员推荐个学习网站</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">author</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">python</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">image_url</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">/media/jichujiaochen.jpeg</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">tag_name</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">Python基础</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">update_time</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">2018年12月17日 14:48</span><span style="color: #800000;">"</span><span style="color: #000000;">
            }
        ]
    }
}</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">3.后端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">在项目根目录下创建一个media文件夹，用于存放新闻图片以及用户上传文件。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在settings.py文件中添加</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 媒体文件配置</span>
MEDIA_URL = <span style="color: #800000;">'</span><span style="color: #800000;">/media/</span><span style="color: #800000;">'</span><span style="color: #000000;">
MEDIA_ROOT </span>= os.path.join(BASE_DIR, <span style="color: #800000;">'</span><span style="color: #800000;">media</span><span style="color: #800000;">'</span>)</pre>
</div>
<p>django在调试模式下提供静态文件服务，为了能够返回media中的媒体文件还需在根urls.py中做如下配置</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在根urls.py中加上static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</span>
<span style="color: #0000ff;">from</span> django.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> path, include
</span><span style="color: #0000ff;">from</span> django.conf <span style="color: #0000ff;">import</span><span style="color: #000000;"> settings
</span><span style="color: #0000ff;">from</span> django.conf.urls.static <span style="color: #0000ff;">import</span><span style="color: #000000;"> static

urlpatterns </span>=<span style="color: #000000;"> [
    path(</span><span style="color: #800000;">''</span>, include(<span style="color: #800000;">'</span><span style="color: #800000;">news.urls</span><span style="color: #800000;">'</span><span style="color: #000000;">)),
    path(</span><span style="color: #800000;">''</span>, include(<span style="color: #800000;">'</span><span style="color: #800000;">verification.urls</span><span style="color: #800000;">'</span><span style="color: #000000;">)),
    path(</span><span style="color: #800000;">'</span><span style="color: #800000;">user/</span><span style="color: #800000;">'</span>, include(<span style="color: #800000;">'</span><span style="color: #800000;">user.urls</span><span style="color: #800000;">'</span><span style="color: #000000;">))
] </span>+ static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</pre>
</div>
<p>导入测试数据，为了测试数据的导入，请确保表名一致</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;"># 在xshell中导入测试数据，在xshell中通过rz命令，将tb_news_20181217.sql文件上传到虚拟机

mysql </span>-u 用户名 -p -D 数据库名 &lt; tb_news_20181217.sql</pre>
</div>
<p>&nbsp;文件我已经放在我的文件栏里(名字是<a id="" href="https://files.cnblogs.com/files/Tmclri/sql%E6%95%B0%E6%8D%AE%E5%8C%85.rar">sql数据包.rar</a>,解压后有4个文件,分别是标签表,新闻表,热门新闻表和轮播图表)</p>
<p>&nbsp;</p>
<p>视图代码</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging

</span><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render
</span><span style="color: #0000ff;">from</span> django.views <span style="color: #0000ff;">import</span><span style="color: #000000;"> View
</span><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator
</span><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> F

</span><span style="color: #0000ff;">from</span> .models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Tag, News
</span><span style="color: #0000ff;">from</span> . <span style="color: #0000ff;">import</span><span style="color: #000000;"> constants
</span><span style="color: #0000ff;">from</span> utils.json_res <span style="color: #0000ff;">import</span><span style="color: #000000;"> json_response

logger </span>= logging.getLogger(<span style="color: #800000;">'</span><span style="color: #800000;">django</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    新闻首页视图
    url: /
    :param request:
    :return:
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">

    tags </span>= Tag.objects.only(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>).filter(is_delete=<span style="color: #000000;">False)
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">news/index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                  context</span>=<span style="color: #000000;">{
                      </span><span style="color: #800000;">'</span><span style="color: #800000;">tags</span><span style="color: #800000;">'</span><span style="color: #000000;">: tags
                  })


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> NewsListView(View):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    新闻列表视图
    url: /news/
    args: tag, page
    </span><span style="color: #800000;">"""</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get(self, request):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 1.获取参数</span>
        <span style="color: #0000ff;">try</span><span style="color: #000000;">:
            tag_id </span>= int(request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">tag</span><span style="color: #800000;">'</span><span style="color: #000000;">, 0))
        </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
            logger.error(</span><span style="color: #800000;">'</span><span style="color: #800000;">标签错误：\n{}</span><span style="color: #800000;">'</span><span style="color: #000000;">.format(e))
            tag_id </span>=<span style="color: #000000;"> 0

        </span><span style="color: #0000ff;">try</span><span style="color: #000000;">:
            page </span>= int(request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">page</span><span style="color: #800000;">'</span><span style="color: #000000;">, 0))
        </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
            logger.error(</span><span style="color: #800000;">'</span><span style="color: #800000;">页码错误：\n{}</span><span style="color: #800000;">'</span><span style="color: #000000;">.format(e))
            page </span>= 1
        <span style="color: #008000;">#</span><span style="color: #008000;"> 使用only返回的是对象，所以传递到前端时需要迭代处理</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> news_queryset = News.objects.select_related('tag', 'author').only(</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     'title', 'digest', 'image_url', 'update_time', 'tag__name', 'author__username')</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 2.获取查询集 (values返回的是字典,only返回的是对象)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">############# 重要 start #################</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> queryset:惰性 不会去数据库 </span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 构造,切片,过滤,传递的时候通常查询集不真正的去数据库查询</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 什么时候,去数据库查呢:</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 1.迭代</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 2.切片,只要不是跳着去查就不会到数据库中查询,只有中间隔着数据切片的时候才会去数据库中查询,切出一个元素的时候</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 3.照顾会在控制台打印的时候</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 4.序列化缓存,把查询集的内容存到redis,内存</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 5.使用len()方法获取长度,count</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 6.使用list()方法转换类型</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 7.bool,去判断是否为空的时候</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> QuerySet的缓存</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 什么时候不缓存</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 只执行查询集的一部分</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 简单的打印不换车:Q = News.objects.all()        print(Q[1]) # 不会被缓存</span>
            
           
        <span style="color: #008000;">#</span><span style="color: #008000;">############# 重要 end #################</span>
        news_queryset = News.objects.values(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">digest</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">image_url</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">update_time</span><span style="color: #800000;">'</span><span style="color: #000000;">).annotate(
            tag_name</span>=F(<span style="color: #800000;">'</span><span style="color: #800000;">tag__name</span><span style="color: #800000;">'</span>), author=F(<span style="color: #800000;">'</span><span style="color: #800000;">author__username</span><span style="color: #800000;">'</span><span style="color: #000000;">))

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3.过滤</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> if tag_id:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     news = news_queryset.fileter(is_delete=False, tag_id=tag_id)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> else:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     news = news_queryset.fileter(is_delete=False)</span>
        news = news_queryset.filter(is_delete=False, tag_id=tag_id) <span style="color: #0000ff;">or</span> news_queryset.filter(is_delete=<span style="color: #000000;">False)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 4.分页</span>
        paginator = Paginator(news, constants.PER_PAGE_NEWS_COUNT) <span style="color: #008000;">#</span><span style="color: #008000;"> 见下文讲解</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 获取当前页数据 get_page 可以容错</span>
        news_info =<span style="color: #000000;"> paginator.get_page(page)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 5.返回数据</span>
        data =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">total_pages</span><span style="color: #800000;">'</span>: paginator.num_pages, <span style="color: #008000;">#</span><span style="color: #008000;"> 分了多少页</span>
            <span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span><span style="color: #000000;">:list(news_info)
        }
        </span><span style="color: #0000ff;">return</span> json_response(data=data)</pre>
</div>
<p class="md-end-block md-p"><span class="md-plain">paginator(分页器)方法：</span></p>
<p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">Paginator.get_page（number）此方法为2.0新方法。</span></span></p>
<p class="md-end-block md-p md-focus"><span class="md-tab"> <span class="md-plain md-expand">返回Page具有给定的从1开始的索引对象，同时还处理超出范围和无效页码，如果页码不是数字，则返回第一页。如果页码为负数或大于页数，则返回最后一页。</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 2.分页解析</span>
        paginator = Paginator(docs, 5) <span style="color: #008000;">#</span><span style="color: #008000;">  每5份内容分页一次</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 2.2 拿到前段发送过来的page这个查询参数的值</span>
        page = paginator.get_page(request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">page</span><span style="color: #800000;">'</span>,1<span style="color: #000000;">))
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> request.GET.get('page',1) 获取url参数，127.0.0.1:8000/?page=&lt;value&gt;</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 非法数值则返回1 数值为空也返回1 如 127.0.0.1:8000/?page=asdsa</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 获取当前(页码)所需要的文章列表 相当于一个容器</span></pre>
</div>
<p>&nbsp;</p>
<p>因为json默认不支持datetime类型数据，所以自定义json编码器(既让新闻的时间序列化)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在utils/json_res.py文件中添加自定义的json编码器以便能够序列化datetime数据类型</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> json
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> datetime
</span><span style="color: #0000ff;">from</span> django.http <span style="color: #0000ff;">import</span><span style="color: #000000;"> JsonResponse

</span><span style="color: #0000ff;">from</span> .res_code <span style="color: #0000ff;">import</span><span style="color: #000000;"> Code


</span><span style="color: #008000;">#</span><span style="color: #008000;"> json编码器</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 自定义序列化器1，处理时间字段(老一点的版本这个就会报错)</span><span style="color: #008000;">
#</span><span style="color: #008000;">class MyJSONEncoder(json.JSONEncoder):</span><span style="color: #008000;">
#</span><span style="color: #008000;">    def default(self, o):</span><span style="color: #008000;">
#</span><span style="color: #008000;">        if isinstance(o, datetime.datetime):</span><span style="color: #008000;">
#</span><span style="color: #008000;">            return o.astimezone().strftime('%Y-%m-%d %H:%M:%S')  # 转换为本地时间</span>
        
<span style="color: #008000;">#</span><span style="color: #008000;"> 自定义序列化器2，处理时间字段(2.1.10django版本 DjangoJSONEncoder能够帮我们自动的实现)</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> MyJSONEncoder(DjangoJSONEncoder):
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> default(self, o):
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> isinstance(o, datetime.datetime):
            </span><span style="color: #0000ff;">return</span> o.astimezone().strftime(<span style="color: #800000;">'</span><span style="color: #800000;">%Y-%m-%d %H:%M:%S</span><span style="color: #800000;">'</span>)  <span style="color: #008000;">#</span><span style="color: #008000;"> 转换为本地时间</span>

<span style="color: #0000ff;">def</span> json_response(errno=Code.OK, errmsg=<span style="color: #800000;">''</span>, data=None, kwargs=<span style="color: #000000;">None):
    json_dict </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">errno</span><span style="color: #800000;">'</span><span style="color: #000000;">: errno,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">errmsg</span><span style="color: #800000;">'</span><span style="color: #000000;">: errmsg,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span><span style="color: #000000;">: data
    }
    </span><span style="color: #0000ff;">if</span> kwargs <span style="color: #0000ff;">and</span><span style="color: #000000;"> isinstance(kwargs, dict) :
        json_dict.update(kwargs)

    </span><span style="color: #0000ff;">return</span> JsonResponse(json_dict, encoder=MyJSONEncoder)</pre>
</div>
<p>定义常量</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news目录下constants.py中定义如下常量：</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 每页新闻数</span>
PER_PAGE_NEWS_COUNT = 5</pre>
</div>
<p>路由配置</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">from</span> django.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> path
</span><span style="color: #0000ff;">from</span> . <span style="color: #0000ff;">import</span><span style="color: #000000;"> views
</span><span style="color: #008000;">#</span><span style="color: #008000;"> url的命名空间</span>
app_name = <span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span><span style="color: #000000;">

urlpatterns </span>=<span style="color: #000000;"> [
    path(</span><span style="color: #800000;">''</span>, views.index, name=<span style="color: #800000;">'</span><span style="color: #800000;">index</span><span style="color: #800000;">'</span>),    <span style="color: #008000;">#</span><span style="color: #008000;"> 将这条路由命名为index</span>
    path(<span style="color: #800000;">'</span><span style="color: #800000;">news/</span><span style="color: #800000;">'</span>, views.NewsListView.as_view(), name=<span style="color: #800000;">'</span><span style="color: #800000;">news_list</span><span style="color: #800000;">'</span><span style="color: #000000;">)
]</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">4.前端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">前端html页面代码修改</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news-contain start 清空 ul中的内容 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-contain"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="news-list"</span><span style="color: #0000ff;">&gt;</span>



    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> news-contain end </span><span style="color: #008000;">--&gt;</span></pre>
</div>
<p>js代码</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> static/js/news/index.js</span>
$(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 新闻列表</span>
    let $newNavLi = $('.news-nav ul li');   <span style="color: #008000;">//</span><span style="color: #008000;"> 标签li</span>
    let iPage = 1;                          <span style="color: #008000;">//</span><span style="color: #008000;"> 默认第一页</span>
    let iTotalPage = 1;                     <span style="color: #008000;">//</span><span style="color: #008000;"> 默认总页数为1</span>
    let iCurrentTagId = 0;                  <span style="color: #008000;">//</span><span style="color: #008000;"> 默认分类标签为0</span>
    let bIsLoadData = <span style="color: #0000ff;">true</span>;                 <span style="color: #008000;">//</span><span style="color: #008000;"> 是否正在向后台加载数据</span>
<span style="color: #000000;">    
    fn_load_content();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击分类标签</span>
    $newNavLi.click(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击分类标签，则为点击的标签加上一个active的class属性</span>
        <span style="color: #008000;">//</span><span style="color: #008000;"> 并移除其他兄弟元素上的active的class属性</span>
        $(<span style="color: #0000ff;">this</span>).addClass('active').siblings('li').removeClass('active'<span style="color: #000000;">);
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 获取绑定在data-id属性上的tag_id</span>
        let iClickTagId = $(<span style="color: #0000ff;">this</span>).children('a').attr('data-id'<span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span> (iClickTagId !==<span style="color: #000000;"> iCurrentTagId){
            iCurrentTagId </span>= iClickTagId;  <span style="color: #008000;">//</span><span style="color: #008000;"> 记录当前分类id</span>
            <span style="color: #008000;">//</span><span style="color: #008000;"> 重置分页参数</span>
            iPage = 1<span style="color: #000000;">;
            iTotalPage </span>= 1<span style="color: #000000;">;
            fn_load_content()
        }

    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 页面滚动加载</span>
    $(window).scroll(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
       </span><span style="color: #008000;">//</span><span style="color: #008000;"> 浏览器窗口高度</span>
        let showHeigtht =<span style="color: #000000;"> $(window).height();
       </span><span style="color: #008000;">//</span><span style="color: #008000;"> 整个网页高度</span>
        let pageHeight =<span style="color: #000000;"> $(document).height();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">页面可以滚动的距离</span>
        let canScrollHeight = pageHeight -<span style="color: #000000;"> showHeigtht;
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 页面滚动了多少， 整个是随着页面滚动实时变化的</span>
        let nowScroll =<span style="color: #000000;"> $(document).scrollTop();
        </span><span style="color: #0000ff;">if</span> ((canScrollHeight - nowScroll) &lt; 100<span style="color: #000000;">){
            </span><span style="color: #0000ff;">if</span>(!<span style="color: #000000;">bIsLoadData){
                bIsLoadData </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
                </span><span style="color: #008000;">//</span><span style="color: #008000;">判断页数，去更新新闻，小于总数才加载</span>
                <span style="color: #0000ff;">if</span>(iPage &lt;<span style="color: #000000;"> iTotalPage){
                    iPage </span>+= 1<span style="color: #000000;">;
                    fn_load_content();

                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    message.showInfo(</span>'已全部加载，没有更多内容！'<span style="color: #000000;">);
                    $(</span>'a.btn-more').html('已全部加载，没有更多内容！'<span style="color: #000000;">)
                }

            }
        }
    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 向后端获取新闻列表数据</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> fn_load_content() {
        $.ajax({
            url: </span>'/news/'<span style="color: #000000;">,
            type: </span>'GET'<span style="color: #000000;">,
            data:{
                tag: iCurrentTagId,
                page: iPage
            },
            dataType: </span>'json'<span style="color: #000000;">,
            success: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (res) {
                </span><span style="color: #0000ff;">if</span>(res.errno === '0'<span style="color: #000000;">){
                    iTotalPage </span>=<span style="color: #000000;"> res.data.total_pages;
                    </span><span style="color: #0000ff;">if</span>(iPage === 1<span style="color: #000000;">){
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 第一页清空内容</span>
                        $('.news-list').html(''<span style="color: #000000;">)
                    }
                    res.data.news.forEach(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (one_news) {
                        let content </span>= `                  &lt;li class="news-item"&gt;
                      &lt;a href="https://www.shiguangkey.com/course/2432" class="news-thumbnail"<span style="color: #000000;">
                         target</span>="_blank"&gt;
                          &lt;img src="${one_news.image_url}" alt="${one_news.title}"<span style="color: #000000;">
                               title</span>="${one_news.title}"&gt;
                      &lt;/a&gt;
                      &lt;div class="news-content"&gt;
                          &lt;h4 class="news-title"&gt;&lt;<span style="color: #000000;">a
                                  href</span>="#"&gt;${one_news.title}&lt;/a&gt;
                          &lt;/h4&gt;
                          &lt;p class="news-details"&gt;${one_news.digest}&lt;/p&gt;
                          &lt;div class="news-other"&gt;
                              &lt;span class="news-type"&gt;${one_news.tag_name}&lt;/span&gt;
                              &lt;span class="news-time"&gt;${one_news.update_time}&lt;/span&gt;
                              &lt;span class="news-author"&gt;${one_news.author}&lt;/span&gt;
                          &lt;/div&gt;
                      &lt;/div&gt;
                  &lt;/li&gt;`;
                        $('.news-list'<span style="color: #000000;">).append(content);
                    });
                  </span><span style="color: #008000;">//</span><span style="color: #008000;"> $('.news-list').append($('&lt;a href="javascript:void(0);" class="btn-more"&gt;滚动加载更多&lt;/a&gt;'));</span>
                  <span style="color: #008000;">//</span><span style="color: #008000;">数据加载完毕，设置正在加载数据变量为false，表示当前没有加载数据</span>
                  bIsLoadData = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                  $(</span>'a.btn-more').html('滚动加载更多'<span style="color: #000000;">)
                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 加载失败，打印错误信息</span>
<span style="color: #000000;">                    message.showError(res.errmsg)
                }
            },
            error: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                message.showError(</span>'服务器超时，请重试！'<span style="color: #000000;">)
            }
        });
    } 
});</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain">五、轮播图功能</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1. 接口设计</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">GET</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/news/banners/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">无参数</span></span></td>
</tr>
</tbody>
</table>
<p class="md-end-block md-p md-focus"><span class="md-plain">返回结果：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
    </span><span style="color: #800000;">"</span><span style="color: #800000;">errno</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">0</span><span style="color: #800000;">"</span><span style="color: #000000;">, 
     </span><span style="color: #800000;">"</span><span style="color: #800000;">errmsg</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">OK</span><span style="color: #800000;">"</span><span style="color: #000000;">, 
     </span><span style="color: #800000;">"</span><span style="color: #800000;">data</span><span style="color: #800000;">"</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">"</span><span style="color: #800000;">banners</span><span style="color: #800000;">"</span><span style="color: #000000;">: [
            {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">image_url</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">/media/jichujiaochen.jpeg</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">news_id</span><span style="color: #800000;">'</span>: <span style="color: #800080;">221</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">news_title</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">python 算法快速排序</span><span style="color: #800000;">"</span><span style="color: #000000;">
            },
            {
                </span><span style="color: #800000;">"</span><span style="color: #800000;">image_url</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">/media/python_advanced.jpg</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">news_id</span><span style="color: #800000;">"</span>: <span style="color: #800080;">707</span><span style="color: #000000;">,
                </span><span style="color: #800000;">"</span><span style="color: #800000;">news_title</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">Python 序列与映射的解包操作</span><span style="color: #800000;">"</span><span style="color: #000000;">
            }
        ]
    }
}</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">2.后端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">视图代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news目录下views.py中创建如下视图</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> NewsBannerView(View):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    轮播图视图
    url:/news/banners/
    </span><span style="color: #800000;">"""</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get(self, request):
        banners </span>= Banner.objects.values(<span style="color: #800000;">'</span><span style="color: #800000;">image_url</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">news_id</span><span style="color: #800000;">'</span><span style="color: #000000;">).annotate(
            news_title</span>=F(<span style="color: #800000;">'</span><span style="color: #800000;">news__title</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        ).filter(is_delete</span>=<span style="color: #000000;">False)[:constants.SHOW_BANNER_COUNT]
        data </span>=<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">banners</span><span style="color: #800000;">'</span><span style="color: #000000;">: list(banners)
        }
        </span><span style="color: #0000ff;">return</span> json_response(data=data)</pre>
</div>
<p>定义常量</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news目录下constants.py中定义如下常量</span><span style="color: #008000;">
#</span><span style="color: #008000;"> banner页展示数量</span>
SHOW_BANNER_COUNT = 6</pre>
</div>
<p>路由</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> news目录下urls.py中定义如下路由：</span>
<span style="color: #0000ff;">from</span> django.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> path
</span><span style="color: #0000ff;">from</span> . <span style="color: #0000ff;">import</span><span style="color: #000000;"> views
</span><span style="color: #008000;">#</span><span style="color: #008000;"> url的命名空间</span>
app_name = <span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span><span style="color: #000000;">

urlpatterns </span>=<span style="color: #000000;"> [
    path(</span><span style="color: #800000;">''</span>, views.index, name=<span style="color: #800000;">'</span><span style="color: #800000;">index</span><span style="color: #800000;">'</span>),    <span style="color: #008000;">#</span><span style="color: #008000;"> 将这条路由命名为index</span>
    path(<span style="color: #800000;">'</span><span style="color: #800000;">news/</span><span style="color: #800000;">'</span>, views.NewsListView.as_view(), name=<span style="color: #800000;">'</span><span style="color: #800000;">news_list</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    path(</span><span style="color: #800000;">'</span><span style="color: #800000;">news/banners/</span><span style="color: #800000;">'</span>, views.NewsBannerView.as_view(), name=<span style="color: #800000;">'</span><span style="color: #800000;">news_banner</span><span style="color: #800000;">'</span><span style="color: #000000;">)
]</span></pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">3.前端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain">html代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 修改templates/news/index.html中banner部分的代码如下 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> banner start </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="banner"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="pic"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">淡入淡出banner</span><span style="color: #008000;">--&gt;</span>

            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:void(0);"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="btn prev"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="PyWhich py-arrow-left"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">i</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:void(0);"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="btn next"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="PyWhich py-arrow-right"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">i</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="tab"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 按钮数量必须和图片一致 </span><span style="color: #008000;">--&gt;</span>

            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> banner end </span><span style="color: #008000;">--&gt;</span></pre>
</div>
<p>js代码</p>
<div class="cnblogs_code">
<pre><code>&lt;!-- static/js/news/index.js --&gt;
    $(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 新闻列表</span>
    let $newNavLi = $('.news-nav ul li');   <span style="color: #008000;">//</span><span style="color: #008000;"> 标签li</span>
    let iPage = 1;                          <span style="color: #008000;">//</span><span style="color: #008000;"> 默认第一页</span>
    let iTotalPage = 1;                     <span style="color: #008000;">//</span><span style="color: #008000;"> 默认总页数为1</span>
    let iCurrentTagId = 0;                  <span style="color: #008000;">//</span><span style="color: #008000;"> 默认分类标签为0</span>
    let bIsLoadData = <span style="color: #0000ff;">true</span>;                 <span style="color: #008000;">//</span><span style="color: #008000;"> 是否正在向后台加载数据</span>
<span style="color: #000000;">    
    fn_load_content();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击分类标签</span>
    $newNavLi.click(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击分类标签，则为点击的标签加上一个active的class属性</span>
        <span style="color: #008000;">//</span><span style="color: #008000;"> 并移除其他兄弟元素上的active的class属性</span>
        $(<span style="color: #0000ff;">this</span>).addClass('active').siblings('li').removeClass('active'<span style="color: #000000;">);
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 获取绑定在data-id属性上的tag_id</span>
        let iClickTagId = $(<span style="color: #0000ff;">this</span>).children('a').attr('data-id'<span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span> (iClickTagId !==<span style="color: #000000;"> iCurrentTagId){
            iCurrentTagId </span>= iClickTagId;  <span style="color: #008000;">//</span><span style="color: #008000;"> 记录当前分类id</span>
            <span style="color: #008000;">//</span><span style="color: #008000;"> 重置分页参数</span>
            iPage = 1<span style="color: #000000;">;
            iTotalPage </span>= 1<span style="color: #000000;">;
            fn_load_content()
        }

    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 页面滚动加载</span>
    $(window).scroll(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
       </span><span style="color: #008000;">//</span><span style="color: #008000;"> 浏览器窗口高度</span>
        let showHeigtht =<span style="color: #000000;"> $(window).height();
       </span><span style="color: #008000;">//</span><span style="color: #008000;"> 整个网页高度</span>
        let pageHeight =<span style="color: #000000;"> $(document).height();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">页面可以滚动的距离</span>
        let canScrollHeight = pageHeight -<span style="color: #000000;"> showHeigtht;
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 页面滚动了多少， 整个是随着页面滚动实时变化的</span>
        let nowScroll =<span style="color: #000000;"> $(document).scrollTop();
        </span><span style="color: #0000ff;">if</span> ((canScrollHeight - nowScroll) &lt; 100<span style="color: #000000;">){
            </span><span style="color: #0000ff;">if</span>(!<span style="color: #000000;">bIsLoadData){
                bIsLoadData </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
                </span><span style="color: #008000;">//</span><span style="color: #008000;">判断页数，去更新新闻，小于总数才加载</span>
                <span style="color: #0000ff;">if</span>(iPage &lt;<span style="color: #000000;"> iTotalPage){
                    iPage </span>+= 1<span style="color: #000000;">;
                    fn_load_content();

                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    message.showInfo(</span>'已全部加载，没有更多内容！'<span style="color: #000000;">);
                    $(</span>'a.btn-more').html('已全部加载，没有更多内容！'<span style="color: #000000;">)
                }

            }
        }
    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 向后端获取新闻列表数据</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> fn_load_content() {
        $.ajax({
            url: </span>'/news/'<span style="color: #000000;">,
            type: </span>'GET'<span style="color: #000000;">,
            data:{
                tag: iCurrentTagId,
                page: iPage
            },
            dataType: </span>'json'<span style="color: #000000;">,
            success: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (res) {
                </span><span style="color: #0000ff;">if</span>(res.errno === '0'<span style="color: #000000;">){
                    iTotalPage </span>=<span style="color: #000000;"> res.data.total_pages;
                    </span><span style="color: #0000ff;">if</span>(iPage === 1<span style="color: #000000;">){
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 第一页清空内容</span>
                        $('.news-list').html(''<span style="color: #000000;">)
                    }
                    res.data.news.forEach(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (one_news) {
                        let content </span>= `                  &lt;li class="news-item"&gt;
                      &lt;a href="https://www.shiguangkey.com/course/2432" class="news-thumbnail"<span style="color: #000000;">
                         target</span>="_blank"&gt;
                          &lt;img src="${one_news.image_url}" alt="${one_news.title}"<span style="color: #000000;">
                               title</span>="${one_news.title}"&gt;
                      &lt;/a&gt;
                      &lt;div class="news-content"&gt;
                          &lt;h4 class="news-title"&gt;&lt;<span style="color: #000000;">a
                                  href</span>="#"&gt;${one_news.title}&lt;/a&gt;
                          &lt;/h4&gt;
                          &lt;p class="news-details"&gt;${one_news.digest}&lt;/p&gt;
                          &lt;div class="news-other"&gt;
                              &lt;span class="news-type"&gt;${one_news.tag_name}&lt;/span&gt;
                              &lt;span class="news-time"&gt;${one_news.update_time}&lt;/span&gt;
                              &lt;span class="news-author"&gt;${one_news.author}&lt;/span&gt;
                          &lt;/div&gt;
                      &lt;/div&gt;
                  &lt;/li&gt;`;
                        $('.news-list'<span style="color: #000000;">).append(content);
                    });
                  </span><span style="color: #008000;">//</span><span style="color: #008000;"> $('.news-list').append($('&lt;a href="javascript:void(0);" class="btn-more"&gt;滚动加载更多&lt;/a&gt;'));</span>
                  <span style="color: #008000;">//</span><span style="color: #008000;">数据加载完毕，设置正在加载数据变量为false，表示当前没有加载数据</span>
                  bIsLoadData = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
                  $(</span>'a.btn-more').html('滚动加载更多'<span style="color: #000000;">)
                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 加载失败，打印错误信息</span>
<span style="color: #000000;">                    message.showError(res.errmsg)
                }
            },
            error: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                message.showError(</span>'服务器超时，请重试！'<span style="color: #000000;">)
            }
        })

    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 新闻轮播图功能</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> 1.加载轮播图数据 function fn_load_banner()</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> 2.点击导航按钮切换 用this的话必须写function()了不能用()=&gt;</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> 3.上一页,下一页</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> 4.自动切换</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> 5.鼠标滑入暂停自动播放</span>
<span style="color: #000000;">    
    fn_load_banner();                   </span><span style="color: #008000;">//</span><span style="color: #008000;"> 先加载banner</span>
<span style="color: #000000;">
    let $banner </span>= $('.banner');         <span style="color: #008000;">//</span><span style="color: #008000;"> banner容器div</span>
    let $picLi = $('.banner .pic li');  <span style="color: #008000;">//</span><span style="color: #008000;"> 图片li标签</span>
    let $pre = $('.banner .prev');      <span style="color: #008000;">//</span><span style="color: #008000;"> 上一张</span>
    let $next = $('.banner .next');     <span style="color: #008000;">//</span><span style="color: #008000;"> 下一张</span>
    let $tabLi = $('.banner .tab li');  <span style="color: #008000;">//</span><span style="color: #008000;"> 按钮</span>
    let index = 0;                      <span style="color: #008000;">//</span><span style="color: #008000;"> 当前索引</span>

    <span style="color: #008000;">//</span><span style="color: #008000;"> 导航小圆点</span>
    $tabLi.click(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        index </span>= $(<span style="color: #0000ff;">this</span><span style="color: #000000;">).index();
        $(</span><span style="color: #0000ff;">this</span>).addClass('active').siblings('li').removeClass('active'<span style="color: #000000;">);
        $picLi.eq(index).fadeIn(</span>1500).siblings('li').fadeOut(1500<span style="color: #000000;">);
    });
    
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击切换上一张</span>
    $pre.click(()=&gt;<span style="color: #000000;"> {
        index </span>--<span style="color: #000000;">;
        </span><span style="color: #0000ff;">if</span>(index&lt;0<span style="color: #000000;">){
            index </span>= $tabLi.length - 1       <span style="color: #008000;">//</span><span style="color: #008000;"> 最后一张</span>
<span style="color: #000000;">        }
        $tabLi.eq(index).addClass(</span>'active').siblings('li').removeClass('active'<span style="color: #000000;">);
        $picLi.eq(index).fadeIn(</span>1500).siblings('li').fadeOut(1500<span style="color: #000000;">);
    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 点击切换下一张</span>
    $next.click(()=&gt;<span style="color: #000000;">{
        auto();
    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 图片向前滑动</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> auto() {
        index </span>++<span style="color: #000000;">;
        index </span>%=<span style="color: #000000;"> $tabLi.length;
        $tabLi.eq(index).addClass(</span>'active').siblings('li').removeClass('active'<span style="color: #000000;">);
        $picLi.eq(index).fadeIn(</span>1500).siblings('li').fadeOut(1500<span style="color: #000000;">)

    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 定时器</span>
    let timer = setInterval(auto, 2500<span style="color: #000000;">);
    $banner.hover(
        ()</span>=&gt;<span style="color: #000000;">{
            clearInterval(timer)
        },
        ()</span>=&gt;<span style="color: #000000;">{
            timer </span>= setInterval(auto, 2500<span style="color: #000000;">);
        }
    );
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 定义向后端获取banner的ajax数据</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> fn_load_banner() {
        $
            .ajax({
                url: </span>'/news/banners/'<span style="color: #000000;">,
                type: </span>'GET'<span style="color: #000000;">,
                async: </span><span style="color: #0000ff;">false</span>,               <span style="color: #008000;">//</span><span style="color: #008000;"> 同步执行，下面的代码依赖banner的加载</span>
                dataType: "json"<span style="color: #000000;">,

            })
            .done( (res)</span>=&gt;<span style="color: #000000;"> {
                </span><span style="color: #0000ff;">if</span>(res.errno === '0'<span style="color: #000000;">){
                    let content </span>= ''<span style="color: #000000;">;
                    let tab_content </span>= ''<span style="color: #000000;">;
                    res.data.banners.forEach( (one_banner, index) </span>=&gt;<span style="color: #000000;">{
                        </span><span style="color: #0000ff;">if</span>(index === 0){        <span style="color: #008000;">//</span><span style="color: #008000;"> 第一页 加active属性</span>
                            content = `&lt;li style="display:block;"&gt;&lt;a href="/news/${one_banner.news_id}/"&gt;
                 &lt;img src="${one_banner.image_url}" alt="${one_banner.news_title}"&gt;&lt;/a&gt;&lt;/li&gt;<span style="color: #000000;">`;
                            tab_content </span>= '&lt;li class="active"&gt;&lt;/li&gt;'<span style="color: #000000;">;
                        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                            content </span>= `&lt;li&gt;&lt;a href="/news/${one_banner.news_id}/"&gt;&lt;img src="${one_banner.image_url}" alt="${one_banner.news_title}"&gt;&lt;/a&gt;&lt;/li&gt;<span style="color: #000000;">`;
                            tab_content </span>= '&lt;li&gt;&lt;/li&gt;'<span style="color: #000000;">;
                        }
                        $(</span>'.pic'<span style="color: #000000;">).append(content);
                        $(</span>'.tab'<span style="color: #000000;">).append(tab_content)
                    })
                    
                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    message.showError(res.errmsg)
                }
            })
            .fail(()</span>=&gt;<span style="color: #000000;">{
                message.showError(</span>'服务器超时，请重试！'<span style="color: #000000;">)
            })
    }
});</span></pre>
</div>
<h2 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">六、推荐新闻</span></h2>
<h4 class="md-end-block md-heading"><span class="md-plain">1. 接口设计</span></h4>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">接口说明：</span></p>
</li>
</ol>
<table class="md-table">
<thead>
<tr class="md-end-block"><th><span class="td-span"><span class="md-plain">类目</span></span></th><th><span class="td-span"><span class="md-plain">说明</span></span></th></tr>
</thead>
<tbody>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">请求方法</span></span></td>
<td><span class="td-span"><span class="md-plain">GET</span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">url定义</span></span></td>
<td><span class="td-span"><span><code>/</code></span></span></td>
</tr>
<tr class="md-end-block">
<td><span class="td-span"><span class="md-plain">参数格式</span></span></td>
<td><span class="td-span"><span class="md-plain">无参数</span></span></td>
</tr>
</tbody>
</table>
<p class="md-end-block md-p"><span class="md-plain">2.返回内容</span></p>
<p class="md-end-block md-p"><span class="md-plain">返回新闻页面，直接在模板渲染</span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">2.后端代码</span></h4>
<p class="md-end-block md-p"><span class="md-plain">视图代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 修改news/views.py中的index视图</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    </span><span style="color: #800000;">"""</span><span style="color: #800000;">
    新闻首页视图
    url: /
    :param request:
    :return:
    </span><span style="color: #800000;">"""</span><span style="color: #000000;">

    tags </span>= Tag.objects.only(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>).filter(is_delete=<span style="color: #000000;">False)
    
    hot_news </span>= HotNews.objects.select_related(<span style="color: #800000;">'</span><span style="color: #800000;">news</span><span style="color: #800000;">'</span>).only(<span style="color: #800000;">'</span><span style="color: #800000;">news__title</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">news__image_url</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">news_id</span><span style="color: #800000;">'</span><span style="color: #000000;">).filter(
        is_delete</span>=<span style="color: #000000;">False
    ).order_by(</span><span style="color: #800000;">'</span><span style="color: #800000;">priority</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">-news__clicks</span><span style="color: #800000;">'</span><span style="color: #000000;">)[:constants.SHOW_HOTNEWS_COUNT]
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">news/index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                  context</span>=<span style="color: #000000;">{
                      </span><span style="color: #800000;">'</span><span style="color: #800000;">tags</span><span style="color: #800000;">'</span><span style="color: #000000;">: tags,
                      </span><span style="color: #800000;">'</span><span style="color: #800000;">hot_news</span><span style="color: #800000;">'</span><span style="color: #000000;">: hot_news
                  })</span></pre>
</div>
<p>定义常量</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 在news/constants.py中定义下面的常量</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 显示热门新闻条数</span>
SHOW_HOTNEWS_COUNT = 3</pre>
</div>
<h4 class="md-end-block md-heading"><span class="md-plain">3.前端代码</span></h4>
<p class="md-end-block md-p md-focus"><span class="md-plain md-expand">html代码</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 修改templates/news/index.html </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="recommend-news"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% for item in hot_news %}
    </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="https://www.shiguangkey.com/course/2432"</span><span style="color: #ff0000;"> target</span><span style="color: #0000ff;">="_blank"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="recommend-thumbnail"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">img </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="{{ item.news.image_url }}"</span><span style="color: #ff0000;"> alt</span><span style="color: #0000ff;">="title"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="info"</span><span style="color: #0000ff;">&gt;</span>{{ item.news.title }}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    {% endfor %}
</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> recommend-news end </span><span style="color: #008000;">--&gt;</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>