<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修网络协议' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>网络协议</center></div><div class='banquan'>原文出处:本文由博客园博主626提供。<br/>
原文连接:https://www.cnblogs.com/fengqiang626/p/11347935.html</div><br>
    <div class="toc">
    <p class="toc-title">目录</p>
    <div class="toc-list">
        <ul>
        <li><a href="#cs-bs架构">1.C/S B/S架构</a></li>
        <li><a href="#网络通信原理">2.网络通信原理</a></li>
        <li><a href="#osi七层协议">3.osi七层协议</a><ul>
        <li><a href="#物理层">3.1物理层</a></li>
        <li><a href="#数据链路层">3.2数据链路层</a></li>
        <li><a href="#网络层">3.3 网络层</a></li>
        <li><a href="#传输层">3.4 传输层</a></li>
        <li><a href="#应用层">3.5 应用层</a></li>
        </ul></li>
        <li><a href="#网络通信实现">4.网络通信实现</a></li>
        <li><a href="#网络通信流程">5.网络通信流程</a><ul>
        <li><a href="#本机获取">5.1 本机获取</a></li>
        <li><a href="#打开浏览器访问">5.2 打开浏览器，访问</a></li>
        <li><a href="#dns协议基于udp协议">5.3 dns协议(基于udp协议)</a></li>
        <li><a href="#http部分的内容">5.4 HTTP部分的内容</a></li>
        <li><a href="#tcp协议-1">5.5 TCP协议</a></li>
        <li><a href="#ip协议-1">5.6 IP协议</a></li>
        <li><a href="#以太网协议-1">5.7 以太网协议</a></li>
        <li><a href="#服务器端响应">5.8 服务器端响应</a></li>
        </ul></li>
        <li><a href="#访问流程示例图">6.访问流程示例图</a></li>
        </ul>
    </div>
</div>
<h2 id="cs-bs架构">1.C/S B/S架构</h2>
<p>C: client端 B: browse 浏览器 S: server端</p>
<p><strong>C/S架构: 基于客户端与服务端之间的通信</strong></p>
<p>​ QQ, 游戏,皮皮虾, 快手,抖音.</p>
<p>​ 优点: 个性化设置,响应速度快,</p>
<p>​ 缺点: 开发成本,维护成本高,占用空间,用户固定.</p>
<p><strong>B/S架构: 基于浏览器与服务端之间的通信</strong></p>
<p>​ 谷歌浏览器,360浏览器,火狐浏览器等等.</p>
<p>​ 优点: 开发维护成本低,占用空间相对低,用户不固定.</p>
<p>​ 缺点: 功能单一,没有个性化设置,响应速度相对慢一些.</p>
<h2 id="网络通信原理">2.网络通信原理</h2>
<p>80年代,固定电话联系,(还没有推广普通话)</p>
<pre><code><code>1.两台电话之间一堆物理连接介质连接.
2.拨号,锁定对方电话的位置.</code></pre>
<p>由于当时没有统一普通话,所以你如果和河南,山西,广西,福建等朋友进行友好的沟通交流,你必须学当地的方言.</p>
<p><strong>推广普通话,统一交流方式.</strong></p>
<ol>
<li>两台电话之间一堆物理连接介质连接.</li>
<li>拨号,锁定对方电话的位置.</li>
<li>统一交流方式.</li>
</ol>
<p><strong>全球范围内交流:</strong></p>
<ol>
<li>两台电话之间一堆物理连接介质连接.</li>
<li>拨号,锁定对方电话的位置.</li>
<li>统一交流方式.(英语)</li>
</ol>
<p><strong>话题转回互联网通信:</strong></p>
<p>​ 我现在想和美国的一个girl联系.你如何利用计算机联系???</p>
<pre><code><code>1. 两台计算机要有一堆物理连接介质连接.
2. 找到对方计算机软件位置.
3. 遵循一揽子互联网通信协议.</code></pre>
<h2 id="osi七层协议">3.osi七层协议</h2>
<p><strong>互联网协议按照功能不同分为osi七层或tcp/ip五层或tcp/ip四层</strong></p>
<p><img src="./images/网络协议0.png" /></p>
<p><strong>每层运行常见的物理设备</strong></p>
<p><img src="./images/网络协议1.png" /></p>
<p>我们将应用层，表示层，会话层并作应用层，从tcp／ip五层协议的角度来阐述每层的由来与功能，搞清楚了每层的主要协议</p>
<p>就理解了整个互联网通信的原理。</p>
<p>首先，用户感知到的只是最上面一层应用层，自上而下每层都依赖于下一层，所以我们从最下一层开始切入，比较好理解</p>
<p>每层都运行特定的协议，越往上越靠近用户，越往下越靠近硬件</p>
<h3 id="物理层">3.1物理层</h3>
<p>物理层由来：上面提到，孤立的计算机之间要想一起玩，就必须接入internet，言外之意就是计算机之间必须完成组网</p>
<p><img src="./images/网络协议2.png" /></p>
<p>物理层功能：主要是基于电器特性发送高低电压(电信号)，高电压对应数字1，低电压对应数字0</p>
<p>光纤： 双绞线：</p>
<p><img src="./images/网络协议3.png" alt="img" /> <img src="./images/网络协议4.png" alt="img" /></p>
<h3 id="数据链路层">3.2数据链路层</h3>
<p>数据链路层由来：单纯的电信号0和1没有任何意义，必须规定电信号多少位一组，每组什么意思</p>
<p>数据链路层的功能：定义了电信号的分组方式</p>
<h4 id="以太网协议">3.2.1以太网协议：</h4>
<p>早期的时候各个公司都有自己的分组方式，后来形成了统一的标准，即以太网协议ethernet</p>
<p><strong>ethernet规定</strong></p>
<ul>
<li>一组电信号构成一个数据豹，叫做‘帧’</li>
<li>每一数据帧分成：报头head和数据data两部分</li>
</ul>
<table>
<thead>
<tr class="header">
<th>head</th>
<th>data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>head包含：(固定18个字节)</strong></p>
<ul>
<li>发送者／源地址，6个字节</li>
<li>接收者／目标地址，6个字节</li>
<li>数据类型，6个字节</li>
</ul>
<p><strong>data包含：(最短46字节，最长1500字节)</strong></p>
<ul>
<li>数据包的具体内容</li>
</ul>
<p>head长度＋data长度＝最短64字节，最长1518字节，超过最大限制就分片发送</p>
<h4 id="mac地址">3.2.2mac地址：</h4>
<p>head中包含的源和目标地址由来：ethernet规定接入internet的设备都必须具备网卡，发送端和接收端的地址便是指网卡的地址，即mac地址</p>
<p>mac地址：每块网卡出厂时都被烧制上一个世界唯一的mac地址，长度为48位2进制，通常由12位16进制数表示（前六位是厂商编号，后六位是流水线号）</p>
<p><img src="./images/网络协议5.png" /></p>
<h4 id="广播">3.2.3广播：</h4>
<p>有了mac地址，同一网络内的两台主机就可以通信了（一台主机通过arp协议获取另外一台主机的mac地址）</p>
<p>ethernet采用最原始的方式，广播的方式进行通信，即计算机通信基本靠吼</p>
<p><img src="./images/网络协议6.png" /></p>
<h3 id="网络层">3.3 网络层</h3>
<p>网络层由来：有了ethernet、mac地址、广播的发送方式，世界上的计算机就可以彼此通信了，问题是世界范围的互联网是由</p>
<p>一个个彼此隔离的小的局域网组成的，那么如果所有的通信都采用以太网的广播方式，那么一台机器发送的包全世界都会收到，</p>
<p>这就不仅仅是效率低的问题了，这会是一种灾难</p>
<p><img src="./images/网络协议7.png" alt="img" /></p>
<p>上图结论：必须找出一种方法来区分哪些计算机属于同一广播域，哪些不是，如果是就采用广播的方式发送，如果不是，</p>
<p>就采用路由的方式（向不同广播域／子网分发数据包），mac地址是无法区分的，它只跟厂商有关</p>
<p>网络层功能：引入一套新的地址用来区分不同的广播域／子网，这套地址即网络地址</p>
<h4 id="ip协议">3.3.1IP协议：</h4>
<ul>
<li>规定网络地址的协议叫ip协议，它定义的地址称之为ip地址，广泛采用的v4版本即ipv4，它规定网络地址由32位2进制表示</li>
<li>范围0.0.0.0-255.255.255.255</li>
<li>一个ip地址通常写成四段十进制数，例：172.16.10.1</li>
</ul>
<h4 id="ip地址分成两部分">3.3.2ip地址分成两部分:</h4>
<ul>
<li>网络部分：标识子网</li>
<li>主机部分：标识主机</li>
</ul>
<p>注意：单纯的ip地址段只是标识了ip地址的种类，从网络部分或主机部分都无法辨识一个ip所处的子网</p>
<p>例：172.16.10.1与172.16.10.2并不能确定二者处于同一子网</p>
<h4 id="子网掩码">3.3.3子网掩码:</h4>
<p>所谓”子网掩码”，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.10.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。</p>
<p>知道”子网掩码”，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。</p>
<p>比如，已知IP地址172.16.10.1和172.16.10.2的子网掩码都是255.255.255.0，请问它们是否在同一个子网络？两者与子网掩码分别进行AND运算，</p>
<p>172.16.10.1：10101100.00010000.00001010.000000001</p>
<p>255255.255.255.0:11111111.11111111.11111111.00000000</p>
<p>AND运算得网络地址结果：10101100.00010000.00001010.000000001-&gt;172.16.10.0</p>
<p>172.16.10.2：10101100.00010000.00001010.000000010</p>
<p>255255.255.255.0:11111111.11111111.11111111.00000000</p>
<p>AND运算得网络地址结果：10101100.00010000.00001010.000000001-&gt;172.16.10.0</p>
<p>结果都是172.16.10.0，因此它们在同一个子网络。</p>
<p>总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。</p>
<h4 id="ip数据包">3.3.4ip数据包:</h4>
<p>ip数据包也分为head和data部分，无须为ip包定义单独的栏位，直接放入以太网包的data部分</p>
<p>head：长度为20到60字节</p>
<p>data：最长为65,515字节。</p>
<p>而以太网数据包的”数据”部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。</p>
<table>
<thead>
<tr class="header">
<th>以太网头</th>
<th>ip 头</th>
<th>ip数据</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="arp协议">3.3.5ARP协议:</h4>
<p>arp协议由来：计算机通信基本靠吼，即广播的方式，所有上层的包到最后都要封装上以太网头，然后通过以太网协议发送，在谈及以太网协议时候，我门了解到</p>
<p>通信是基于mac的广播方式实现，计算机在发包时，获取自身的mac是容易的，如何获取目标主机的mac，就需要通过arp协议</p>
<p>arp协议功能：广播的方式发送数据包，获取目标主机的mac地址</p>
<p>协议工作方式：每台主机ip都是已知的</p>
<p>例如：主机172.16.10.10/24访问172.16.10.11/24</p>
<p>一：首先通过ip地址和子网掩码区分出自己所处的子网</p>
<table>
<thead>
<tr class="header">
<th>场景</th>
<th>数据包地址</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>同一子网</td>
<td>目标主机mac，目标主机ip</td>
</tr>
<tr class="even">
<td>不同子网</td>
<td>网关mac，目标主机ip</td>
</tr>
</tbody>
</table>
<p>二：分析172.16.10.10/24与172.16.10.11/24处于同一网络(如果不是同一网络，那么下表中目标ip为172.16.10.1,通过arp获取的是网关的mac)</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>源mac</th>
<th>目标mac</th>
<th>源ip</th>
<th>目标ip</th>
<th>数据部分</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>发送端主机</td>
<td>发送端mac</td>
<td>FF:FF:FF:FF:FF:FF</td>
<td>172.16.10.10/24</td>
<td>172.16.10.11/24</td>
<td>数据</td>
</tr>
</tbody>
</table>
<p>三：这个包会以广播的方式在发送端所处的自网内传输，所有主机接收后拆开包，发现目标ip为自己的，就响应，返回自己的mac</p>
<h3 id="传输层">3.4 传输层</h3>
<p>传输层的由来：网络层的ip帮我们区分子网，以太网层的mac帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，等多个应用程序，</p>
<p>那么我们通过ip和mac找到了一台特定的主机，如何标识这台主机上的应用程序，答案就是端口，端口即应用程序与网卡关联的编号。</p>
<p>传输层功能：建立端口到端口的通信</p>
<p>补充：端口范围0-65535，0-1023为系统占用端口</p>
<h4 id="tcp协议">3.4.1tcp协议:</h4>
<p>可靠传输，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。</p>
<table>
<thead>
<tr class="header">
<th>以太网头</th>
<th>ip 头</th>
<th>tcp头</th>
<th>数据</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td>udp协议：</td>
</tr>
</tbody>
</table>
<p>不可靠传输，”报头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。</p>
<table>
<thead>
<tr class="header">
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>数据</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>tcp报文</strong></p>
<p><img src="./images/网络协议8.png" /></p>
<p><strong>tcp三次握手和四次挥手</strong></p>
<p><img src="./images/网络协议9.png" /></p>
<h3 id="应用层">3.5 应用层</h3>
<p>应用层由来：用户使用的都是应用程序，均工作于应用层，互联网是开发的，大家都可以开发自己的应用程序，数据多种多样，必须规定好数据的组织形式</p>
<p>应用层功能：规定应用程序的数据格式。</p>
<p>例：TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了”应用层”。</p>
<p><img src="./images/网络协议10.png" /></p>
<h2 id="网络通信实现">4.网络通信实现</h2>
<p>想实现网络通信，每台主机需具备四要素</p>
<ul>
<li>本机的IP地址</li>
<li>子网掩码</li>
<li>网关的IP地址</li>
<li>DNS的IP地址</li>
</ul>
<p>获取这四要素分两种方式</p>
<p>1.静态获取</p>
<p>即手动配置</p>
<p>2.动态获取</p>
<p>通过dhcp获取</p>
<table>
<thead>
<tr class="header">
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>dhcp数据包</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>（1）最前面的”以太网标头”，设置发出方（本机）的MAC地址和接收方（DHCP服务器）的MAC地址。前者就是本机网卡的MAC地址，后者这时不知道，就填入一个广播地址：FF-FF-FF-FF-FF-FF。</p>
<p>（2）后面的”IP标头”，设置发出方的IP地址和接收方的IP地址。这时，对于这两者，本机都不知道。于是，发出方的IP地址就设为0.0.0.0，接收方的IP地址设为255.255.255.255。</p>
<p>（3）最后的”UDP标头”，设置发出方的端口和接收方的端口。这一部分是DHCP协议规定好的，发出方是68端口，接收方是67端口。</p>
<p>这个数据包构造完成后，就可以发出了。以太网是广播发送，同一个子网络的每台计算机都收到了这个包。因为接收方的MAC地址是FF-FF-FF-FF-FF-FF，看不出是发给谁的，所以每台收到这个包的计算机，还必须分析这个包的IP地址，才能确定是不是发给自己的。当看到发出方IP地址是0.0.0.0，接收方是255.255.255.255，于是DHCP服务器知道”这个包是发给我的”，而其他计算机就可以丢弃这个包。</p>
<p>接下来，DHCP服务器读出这个包的数据内容，分配好IP地址，发送回去一个”DHCP响应”数据包。这个响应包的结构也是类似的，以太网标头的MAC地址是双方的网卡地址，IP标头的IP地址是DHCP服务器的IP地址（发出方）和255.255.255.255（接收方），UDP标头的端口是67（发出方）和68（接收方），分配给请求端的IP地址和本网络的具体参数则包含在Data部分。</p>
<p>新加入的计算机收到这个响应包，于是就知道了自己的IP地址、子网掩码、网关地址、DNS服务器等等参数</p>
<h2 id="网络通信流程">5.网络通信流程</h2>
<h3 id="本机获取">5.1 本机获取</h3>
<ul>
<li>本机的IP地址：192.168.1.100</li>
<li>子网掩码：255.255.255.0</li>
<li>网关的IP地址：192.168.1.1</li>
<li>DNS的IP地址：8.8.8.8</li>
</ul>
<h3 id="打开浏览器访问">5.2 打开浏览器，访问</h3>
<p>　　想要访问Google，在地址栏输入了网址：www.google.com。</p>
<h3 id="dns协议基于udp协议">5.3 dns协议(基于udp协议)</h3>
<p><img src="./images/网络协议11.png" alt="img" /></p>
<p>13台根dns：</p>
<p>A.root-servers.net198.41.0.4美国<br />
B.root-servers.net192.228.79.201美国（另支持<a href="https://www.baidu.com/s?wd=IPv6&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br />
C.root-servers.net192.33.4.12法国<br />
D.root-servers.net128.8.10.90美国<br />
E.root-servers.net192.203.230.10美国<br />
F.root-servers.net192.5.5.241美国（另支持<a href="https://www.baidu.com/s?wd=IPv6&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br />
G.root-servers.net192.112.36.4美国<br />
H.root-servers.net128.63.2.53美国（另支持<a href="https://www.baidu.com/s?wd=IPv6&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br />
I.root-servers.net192.36.148.17瑞典<br />
J.root-servers.net192.58.128.30美国<br />
K.root-servers.net193.0.14.129英国（另支持IPv6）<br />
L.root-servers.net198.32.64.12美国<br />
M.root-servers.net202.12.27.33日本（另支持IPv6）</p>
<p>域名定义：<a href="http://jingyan.baidu.com/article/1974b289a649daf4b1f774cb.html" class="uri">http://jingyan.baidu.com/article/1974b289a649daf4b1f774cb.html</a></p>
<p>顶级域名：以.com,.net,.org,.cn等等属于国际顶级域名，根据目前的国际互联网域名体系，国际顶级域名分为两类：类别顶级域名(gTLD)和地理顶级域名(ccTLD)两种。类别顶级域名是　　　　　　　　 以&quot;COM&quot;、&quot;NET&quot;、&quot;ORG&quot;、&quot;BIZ&quot;、&quot;INFO&quot;等结尾的域名，均由国外公司负责管理。地理顶级域名是以国家或地区代码为结尾的域名，如&quot;CN&quot;代表中国，&quot;UK&quot;代表英国。地理顶级域名一般由各个国家或地区负责管理。</p>
<p>二级域名：二级域名是以顶级域名为基础的地理域名，比喻中国的二级域有，.com.cn,.net.cn,.org.cn,.gd.cn等.子域名是其父域名的子域名，比喻父域名是abc.com,子域名就是www.abc.com或者<em>.abc.com.<br />
一般来说，二级域名是域名的一条记录，比如alidiedie.com是一个域名，www.alidiedie.com是其中比较常用的记录，一般默认是用这个，但是类似</em>.alidiedie.com的域名全部称作是alidiedie.com的二级</p>
<h3 id="http部分的内容">5.4 HTTP部分的内容</h3>
<p>类似于这样的：</p>
<blockquote>
<p>GET / HTTP/1.1<br />
Host: www.google.com<br />
Connection: keep-alive<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1) ……<br />
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br />
Accept-Encoding: gzip,deflate,sdch<br />
Accept-Language: zh-CN,zh;q=0.8<br />
Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3<br />
Cookie: … …</p>
</blockquote>
<p>我们假定这个部分的长度为4960字节，它会被嵌在TCP数据包之中。</p>
<h3 id="tcp协议-1">5.5 TCP协议</h3>
<p>TCP数据包需要设置端口，接收方（Google）的HTTP端口默认是80，发送方（本机）的端口是一个随机生成的1024-65535之间的整数，假定为51775。</p>
<p>TCP数包的标头长度为20字节，加上嵌入HTTP的数据包，总长度变为4980字节。</p>
<h3 id="ip协议-1">5.6 IP协议</h3>
<p>然后，TCP数据包再嵌入IP数据包。IP数据包需要设置双方的IP地址，这是已知的，发送方是192.168.1.100（本机），接收方是172.194.72.105（Google）。</p>
<p>IP数据包的标头长度为20字节，加上嵌入的TCP数据包，总长度变为5000字节。</p>
<h3 id="以太网协议-1">5.7 以太网协议</h3>
<p>最后，IP数据包嵌入以太网数据包。以太网数据包需要设置双方的MAC地址，发送方为本机的网卡MAC地址，接收方为网关192.168.1.1的MAC地址（通过ARP协议得到）。</p>
<p>以太网数据包的数据部分，最大长度为1500字节，而现在的IP数据包长度为5000字节。因此，IP数据包必须分割成四个包。因为每个包都有自己的IP标头（20字节），所以四个包的IP数据包的长度分别为1500、1500、1500、560。</p>
<p><img src="./images/网络协议12.png" /></p>
<h3 id="服务器端响应">5.8 服务器端响应</h3>
<p>经过多个网关的转发，Google的服务器172.194.72.105，收到了这四个以太网数据包。</p>
<p>根据IP标头的序号，Google将四个包拼起来，取出完整的TCP数据包，然后读出里面的”HTTP请求”，接着做出”HTTP响应”，再用TCP协议发回来。</p>
<p>本机收到HTTP响应以后，就可以将网页显示出来，完成一次网络通信。</p>
<h2 id="访问流程示例图">6.访问流程示例图</h2>
<p><img src="./images/网络协议13.png" /></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>