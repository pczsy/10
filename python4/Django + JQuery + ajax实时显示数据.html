<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Django + JQuery + ajax实时显示数据' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Django + JQuery + ajax实时显示数据</center></div><div class='banquan'>原文出处:本文由博客园博主尼斯特瑞提供。<br/>
原文连接:https://www.cnblogs.com/nuister/p/python_Django_Ajax_JQuery.html</div><br>
    <p><span style="color: #000000;">1 创建django项目 ：NowtimeData and&nbsp; APP ：Demo</span></p>
<p>&gt;&gt;<span style="color: #ff00ff;">django-admin startproject NowtimeData</span></p>
<p><span style="color: #000000;">&gt;&gt;<span style="color: #ff00ff;">python manage.py startapp Demo</span></span></p>
<p><span style="color: #000000;">2 配置settings.py</span></p>
<p><span style="color: #000000;">①插入Demo</span></p>
<p><span style="color: #000000;">②配置模板路径</span></p>
<p><span style="color: #000000;">　　----</span><span style="color: #ff0000;">BASE_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))</span></p>
<p><span style="color: #ff0000;">　　<span style="color: #000000;">----</span></span><span style="color: #ff0000;">TEMPLATES =&nbsp;[</span></p>
<p><span style="color: #ff0000;">　　　　　　'DIRS': [os.path.join(BASE_DIR, 'templates').replace('\\', '/')], # 修改 模板目录 ]</span></p>
<p><span style="color: #ff0000;">　　</span><span style="color: #000000;">----<span style="color: #ff0000;">STATIC_URL = '/static/'</span></span></p>
<p><span style="color: #ff0000;">　　　　STATIC_ROOT = os.path.join(BASE_DIR, 'static_collected')</span></p>
<p><span style="color: #ff0000;">　　<span style="color: #000000;">----补充　　</span></span></p>
<pre><code>　　# LANGUAGE_CODE = 'en-us'<br />　　LANGUAGE_CODE = 'zh-hans'  # 简体中文<br /><br />　　# TIME_ZONE = 'UTC'<br />　　TIME_ZONE = 'Asia/Shanghai'  # 时区</pre>
<p><span style="color: #000000;">③在APP Demo里创建templates和static，templates里新建ajax_test.html</span></p>
<pre><code>&lt;!DOCTYPE html&gt;<br />&lt;html lang="en"&gt;<br />&lt;head&gt;<br />    &lt;meta charset="UTF-8"&gt;<br />    &lt;title&gt;Title&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />    &lt;form action="/api/ajax/" method="get"&gt;<br /><br />        a:&lt;input type="text" name="a" id="a"&gt;&lt;br&gt;<br />        b:&lt;input type="text" name="b" id="b"&gt;&lt;br&gt;<br />        &lt;p&gt;温度:&lt;span id="temp"&gt;&lt;/span&gt;&lt;/p&gt;<br />        &lt;p&gt;湿度:&lt;span id="hum"&gt;&lt;/span&gt;&lt;/p&gt;<br />        &lt;button type="button" id="sum"&gt;Calc&lt;/button&gt;<br />    &lt;/form&gt;<br /><br />    &lt;script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"&gt;&lt;/script&gt;<br />   <span style="color: #ff0000;"> &lt;script&gt;</span><br /><br /><br /><span style="color: #ff0000;">    setInterval(function () {</span><br /><br /><span style="color: #ff0000;">    $(document).ready(function () {</span><br /><br /><span style="color: #ff0000;">               var a = $('#a').val();</span><br /><span style="color: #ff0000;">               var b = $('#b').val();</span><br /><br /><span style="color: #ff0000;">               //add是urls.py里的路由</span><br /><span style="color: #ff0000;">               $.get("/api/ajax/", {'a':a, 'b':b}, function (ret) {</span><br /><span style="color: #ff0000;">                   //console.log(typeof ret);</span><br /><span style="color: #ff0000;">                   var data = JSON.parse(ret);</span><br /><span style="color: #ff0000;">                   //console.log(data[0]["fields"]);</span><br /><br /><span style="color: #ff0000;">                   //console.log(typeof Number(data[0]["fields"]["temp"]));</span><br /><span style="color: #ff0000;">                   temp = Number(data[0]["fields"]["temp"]).toFixed(1);</span><br /><span style="color: #ff0000;">                   hum = Number(data[0]["fields"]["hum"]).toFixed(1);</span><br /><span style="color: #ff0000;">                   $("#temp").html(temp);</span><br /><span style="color: #ff0000;">                   $("#hum").html(hum);</span><br /><span style="color: #ff0000;">               })</span><br /><br /><span style="color: #ff0000;">        });</span><br /><span style="color: #ff0000;">},1000);</span><br /><span style="color: #ff0000;">    &lt;/script&gt;</span><br />&lt;/body&gt;<br />&lt;/html&gt;</pre>
<p>&nbsp;或者通过点击事件来触发</p>
<pre><code>&lt;script&gt;<br /><br /><br /><br /><br />$(document).ready(function () {<br />     $("#sum").click(function () {<br />         var d = $('#d').val();<br />         var e = $('#e').val();<br />         //add是urls.py里的路由<br />         $.get("/add/", {'d': d, 'e': e}, function (ret) {<br />             {#console.log(typeof ret);#}<br />             console.log(ret);<br />             $("#result").html(ret);<br />         })<br />     })<br /><br />    });<br /><br />&lt;/script&gt;</pre>
<p><span style="color: #000000;">④在view.py中编辑代码</span></p>
<p><span style="color: #000000;">&nbsp;</span></p>
<pre><code>　　def adder(request):<br />   　　 # a = request.GET['a']<br />   　　 # b = request.GET['b']<br /> 　　   # a = random.randint(1, 10)<br />  　　  # b = random.randint(1, 10)<br />  　　  # c = int(a)+int(b)<br />   　　 return render(request, 'ajax_test.html')</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">⑤建立数据api接口 api.py</span></p>
<p>&nbsp;</p>
<pre><code>from rest_framework import serializers<br />from rest_framework.response import Response<br />from rest_framework.decorators import api_view<br />from website.models import Room, Recv_data, Send_data  # 得到数据库<br />from django.http import HttpResponse, JsonResponse<br /><br />class Room_Admin(serializers.ModelSerializer):<br />    class Meta:<br />        depth = 1<br />        model = Room<br />        fields = '__all__'<br /><br /><br />class Recv_Admin(serializers.ModelSerializer):<br />    class Meta:<br />        depth = 1<br />        model = Recv_data<br />        fields = '__all__'<br /><br /><br />class Send_Admin(serializers.ModelSerializer):<br />    class Meta:<br />        depth = 1<br />        model = Send_data<br />        fields = '__all__'</pre>
<p><span style="color: #000000;">　　</span></p>
<pre><code><span style="color: #ff0000;">from django.core.serializers import serialize</span><br /><span style="color: #ff0000;">@api_view(['GET', 'POST'])</span><br /><span style="color: #ff0000;">def ajaxData(request):        # 在url.py里添加路由</span><br /><br /><span style="color: #ff0000;">    # 房间管理</span><br /><span style="color: #ff0000;">    room_data = Room.objects.all()</span><br /><span style="color: #ff0000;">    roomData= Room_Admin(room_data, many=True)</span><br /><br /><span style="color: #ff0000;">    recv_data = Recv_data.objects.all()</span><br /><span style="color: #ff0000;">    recvData = Recv_Admin(recv_data, many=True)</span><br /><br /><span style="color: #ff0000;">    send_data = Send_data.objects.all()</span><br /><span style="color: #ff0000;">    sendData = Send_Admin(send_data, many=True)</span><br /><br /><span style="color: #ff0000;">    room2_info = Recv_data.objects.filter(floor=2)</span><br /><span style="color: #ff0000;">    room3_info = Recv_data.objects.filter(floor=3)</span><br /><span style="color: #ff0000;">    room4_info = Recv_data.objects.filter(floor=4)</span><br /><span style="color: #ff0000;">    room5_info = Recv_data.objects.filter(floor=5)</span><br /><span style="color: #ff0000;">    room6_info = Recv_data.objects.filter(floor=6)</span><br /><span style="color: #ff0000;">    room2_info = serialize('json', room2_info, fields=['room', 'temp', 'status', 'mode', 'level', 'hum', 'co2', 'pm25', 'tvoc'])</span><br /><span style="color: #ff0000;">    room3_info = serialize('json', room3_info, fields=['room', 'temp', 'status', 'mode', 'level', 'hum', 'co2', 'pm25', 'tvoc'])</span><br /><span style="color: #ff0000;">    room4_info = serialize('json', room4_info, fields=['room', 'temp', 'status', 'mode', 'level', 'hum', 'co2', 'pm25', 'tvoc'])</span><br /><span style="color: #ff0000;">    room5_info = serialize('json', room5_info, fields=['room', 'temp', 'status', 'mode', 'level', 'hum', 'co2', 'pm25', 'tvoc'])</span><br /><span style="color: #ff0000;">    room6_info = serialize('json', room6_info, fields=['room', 'temp', 'status', 'mode', 'level', 'hum', 'co2', 'pm25', 'tvoc'])</span><br /><span style="color: #ff0000;">    # print(room2_info)</span><br /><br /><span style="color: #ff0000;">    # return Response({'room_admin': roomData.data, 'recv_data': recvData.data, 'send_data': sendData.data})</span><br /><span style="color: #ff0000;">    # return HttpResponse(str({'room_admin': roomData.data, 'recv_data': recvData.data, 'send_data': sendData.data}))</span><br /><span style="color: #ff0000;">    return HttpResponse(room2_info)</span></pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">⑥ 添加url.py</span></p>
<p><span style="color: #000000;">　　</span><span style="color: #ff0000;">path('add/', views.adder),</span></p>
<p><span style="color: #ff0000;">　　</span><span style="color: #ff0000;">path('api/ajax/', api.ajaxData),</span></p>
<p>&nbsp;</p>
<p><span style="color: #000000;">⑦补充js for循环写数据</span></p>
<pre><code><em><em>　　</em></em></pre>
<pre><code> setInterval(function () {<br /><br />    $(document).ready(function () {<br /><br />               var a = $('#a').val();<br />               var b = $('#b').val();<br /><br />               //add是urls.py里的路由<br />               $.get("/api/ajax/", {'a':a, 'b':b}, function (ret) {<br />                   //console.log(typeof ret);<br />                   var data = JSON.parse(ret);<br />                   //console.log(data[0]["fields"]);<br />                  <span style="color: #ff00ff;"> function room(room, a){</span><br /><br /><br /><span style="color: #ff00ff;">                        var temp = Number(data[a]["fields"]["temp"]).toFixed(1);</span><br /><span style="color: #ff00ff;">                        var status = data[a]["fields"]["status"];</span><br /><span style="color: #ff00ff;">                        if (status=='0'){</span><br /><span style="color: #ff00ff;">                            status="关";</span><br /><span style="color: #ff00ff;">                            $("#"+room).css({"background": "green"});</span><br /><span style="color: #ff00ff;">                            }</span><br /><span style="color: #ff00ff;">                        else if (status=='1'){</span><br /><span style="color: #ff00ff;">                            status='开';</span><br /><span style="color: #ff00ff;">                            $("#"+room).css({"background": "grey"});</span><br /><br /><span style="color: #ff00ff;">                        }</span><br /><span style="color: #ff00ff;">                        else {</span><br /><span style="color: #ff00ff;">                            status='未知';</span><br /><span style="color: #ff00ff;">                            $("#"+room).css({"background": "purple"});</span><br /><span style="color: #ff00ff;">                        }</span><br /><span style="color: #ff00ff;">                        $("#temp_"+room).html(temp);</span><br /><span style="color: #ff00ff;">                        $("#status_"+room).html(status);</span><br /><br /><span style="color: #ff00ff;">                    }</span><br /><br />                <span style="color: #ff0000;">   for (var i=8206;i&lt;8230;i++){</span><br /><span style="color: #ff0000;">                       room(i,i-8201)</span><br /><span style="color: #ff0000;">                   }</span><br /><br />               })<br /><br />        });<br />},1000);</pre>
<pre><code><em><em><img src="./images/Django + JQuery + ajax实时显示数据0.png" alt="" /></em></em></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre><code><em id="__mceDel"><em id="__mceDel"></em><br /></em></pre>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>