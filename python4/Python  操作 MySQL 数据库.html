<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Python  操作 MySQL 数据库' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Python  操作 MySQL 数据库</center></div><div class='banquan'>原文出处:本文由博客园博主chenhongyong提供。<br/>
原文连接:https://www.cnblogs.com/chy18883701161/p/11301105.html</div><br>
    <p>&nbsp;</p>
<h3>使用示例：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,port=3306,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">字符集不是必须的</span>
cursor =<span style="color: #000000;"> conn.cursor()
sql</span>=<span style="color: #800000;">"</span><span style="color: #800000;">select * from user_info</span><span style="color: #800000;">"</span><span style="color: #000000;">
result</span>=cursor.execute(sql)   <span style="color: #008000;">#</span><span style="color: #008000;">不论增删查改，result都是受影响的记录数，int型</span>
<span style="color: #0000ff;">for</span> row <span style="color: #0000ff;">in</span> cursor:   <span style="color: #008000;">#</span><span style="color: #008000;">遍历结果集</span>
    <span style="color: #0000ff;">print</span>(row)  <span style="color: #008000;">#</span><span style="color: #008000;">输出一条记录，元组形式</span>
    <span style="color: #0000ff;">print</span>(row[0])  <span style="color: #008000;">#</span><span style="color: #008000;">输出记录中的某个字段</span>
<span style="color: #000000;">cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>提取一条记录：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">字符集不是必须的</span>
cursor =<span style="color: #000000;"> conn.cursor()
sql</span>=<span style="color: #800000;">"</span><span style="color: #800000;">select * from user_info</span><span style="color: #800000;">"</span><span style="color: #000000;">
result</span>=<span style="color: #000000;">cursor.execute(sql)
</span><span style="color: #0000ff;">print</span>(<span style="color: #ff0000;"><strong>cursor.fetchone()</strong></span>)  <span style="color: #008000;">#</span><span style="color: #008000;">提取并返回一条记录，指针会自动后移。最初指针指向第一条之前。第一条</span>
<span style="color: #0000ff;">print</span>(cursor.fetchone())  <span style="color: #008000;">#</span><span style="color: #008000;">第二条。元组形式。</span>
<span style="color: #0000ff;">print</span>(cursor.fetchone()[0])  <span style="color: #008000;">#</span><span style="color: #008000;">一个字段，不能使用字段名，只能使用索引</span>
<span style="color: #000000;">cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>提取多条记录：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">字符集不是必须的</span>
cursor =<span style="color: #000000;"> conn.cursor()
sql</span>=<span style="color: #800000;">"</span><span style="color: #800000;">select * from user_info</span><span style="color: #800000;">"</span><span style="color: #000000;">
result</span>=<span style="color: #000000;">cursor.execute(sql)
</span><span style="color: #0000ff;">print</span>(<strong><span style="color: #ff0000;">cursor.fetchmany(2)</span></strong>)   <span style="color: #008000;">#</span><span style="color: #008000;">提取指定的条数，指针会自动后移。只要是提取，指针都会自动后移。</span>
<span style="color: #0000ff;">for</span> row <span style="color: #0000ff;">in</span> cursor:  <span style="color: #008000;">#</span><span style="color: #008000;">cursor中是从第三行开始的记录</span>
    <span style="color: #0000ff;">print</span><span style="color: #000000;">(row)
</span><span style="color: #008000;">#</span><span style="color: #008000;">fetchmany()返回值是嵌套的元组形式。  ((1, 'chy', 200.0), (2, 'zhangsan', 200.0))。一个元素即一条记录。</span><span style="color: #008000;">
#</span><span style="color: #008000;">fetchall()是提取结果集的所有记录</span><span style="color: #008000;">
#</span><span style="color: #008000;">cursor存放结果集，提取就是把一些记录从cursor中提取出来（从cursor中拿出来，cursor中不再有这些记录了）</span>
<span style="color: #000000;">cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>设置sql语句参数：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">字符集不是必须的</span>
cursor =<span style="color: #000000;"> conn.cursor()
id</span>=1<span style="color: #000000;">
name</span>=<span style="color: #800000;">"</span><span style="color: #800000;">chy</span><span style="color: #800000;">"</span>
<strong><span style="color: #ff0000;"># sql="select * from user_info where id=%d and name='%s'"%(id,name)   #如果是字符串，%s要加引号
sql="select * from user_info where id={} and name='{}'".format(id,name)  #如果是字符串，{}也要加引号</span></strong>
result=<span style="color: #000000;">cursor.execute(sql)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(<strong><span style="color: #ff0000;">cursor.fetchall()</span></strong>)   #提取结果集中所有的记录数
cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>插入一条记录：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">字符集不是必须的</span>
cursor =<span style="color: #000000;"> conn.cursor()
id</span>=3<span style="color: #000000;">
name</span>=<span style="color: #800000;">"</span><span style="color: #800000;">wangwu</span><span style="color: #800000;">"</span><span style="color: #000000;">
money</span>=100<span style="color: #000000;">
sql</span>=<span style="color: #800000;">"</span><span style="color: #800000;">insert into user_info (id,name,money) values (%d,'%s',%d)</span><span style="color: #800000;">"</span>%(id,name,money)  <span style="color: #008000;">#</span><span style="color: #008000;">如果是字符串，占位的要加引号</span>
result=cursor.execute(sql)  <span style="color: #008000;">#</span><span style="color: #008000;">增删查改都是execute</span>
<span style="color: #0000ff;">print</span>(result)  <span style="color: #008000;">#</span><span style="color: #008000;">1   搜相应的记录数</span>
<span style="color: #0000ff;">print</span>(cursor.fetchall())  <span style="color: #008000;">#</span><span style="color: #008000;">不会报错，空元组</span>
conn.commit()  <span style="color: #008000;">#</span><span style="color: #008000;">需要提交才会同步到数据库。缺少此句代码，不会同步到数据库。</span>
<span style="color: #000000;">cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>增删改的操作类似，注意增删改都需要conn.commit()才会提交到数据库。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>另一种设置参数的方式：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">)
cursor </span>=<span style="color: #000000;"> conn.cursor()
<strong><span style="color: #ff0000;">sql</span></strong></span><strong><span style="color: #ff0000;">="insert into user_info (id,name,money) values (%s,%s,%s)"  #如果是在execute()中注入数据，不管是什么类型，都必须写成%s，且不能加引号
result=cursor.execute(sql,(5,"name",10))  #在execute()中注入数据。在这里区分数据类型。使用元组、列表均可
#</span><span style="color: #008000;"><span style="color: #ff0000;">result=cursor.execute(sql,[5,"name",10])</span> </span></strong>
<span style="color: #000000;">conn.commit()
cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>批量操作：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span> pymysql  <span style="color: #008000;">#</span><span style="color: #008000;">python3</span>
conn=pymysql.connect(host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>,user=<span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span>,password=<span style="color: #800000;">"</span><span style="color: #800000;">abcd</span><span style="color: #800000;">"</span>,database=<span style="color: #800000;">"</span><span style="color: #800000;">bank</span><span style="color: #800000;">"</span>,charset=<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">)
cursor </span>=<span style="color: #000000;"> conn.cursor()
sql</span>=<span style="color: #800000;">"</span><span style="color: #800000;">insert into user_info (id,name,money) values (%s,%s,%s)</span><span style="color: #800000;">"</span> <span style="color: #008000;">#</span><span style="color: #008000;">如果是在execute()中注入数据，不管是什么类型，都必须写成%s，且不能加引号</span>
<strong><span style="color: #ff0000;">data=((17,"chy",90),(18,"chy",99))  #至少2个元素，使用嵌套的元组、列表均可
#data=[[17,"chy",90],[18,"chy",99]]</span></strong>
<span style="color: #0000ff;">try</span><span style="color: #000000;">:
    <strong><span style="color: #ff0000;">result</span></strong></span><strong><span style="color: #ff0000;">=cursor.executemany(sql,data)  #批量操作，注入嵌套的元组。注意是executemany()，且必须是嵌套的元组，元组中至少要有2个元组（记录），只有一条会出错。</span></strong>
    conn.commit()   <span style="color: #008000;">#</span><span style="color: #008000;">executemany()是执行2条及以上的操作，所以至少2个元素</span>
<span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(e)
    conn.rollback()  </span><span style="color: #008000;">#</span><span style="color: #008000;">失败就回滚</span>
<span style="color: #000000;">cursor.close()
conn.close()</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>