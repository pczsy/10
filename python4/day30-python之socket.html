<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修day30-python之socket' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>day30-python之socket</center></div><div class='banquan'>原文出处:本文由博客园博主有猿人提供。<br/>
原文连接:https://www.cnblogs.com/sqy-yyr/p/11406106.html</div><br>
    <p>1.iter补充</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> l=['a','b','c','d']</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> def test():</span><span style="color: #008000;">
#</span><span style="color: #008000;">     return l.pop()</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> x=iter(test,'b')</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(x.__next__())</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(x.__next__())</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(x.__next__())</span>
<span style="color: #0000ff;">from</span> functools <span style="color: #0000ff;">import</span><span style="color: #000000;"> partial
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> add(x,y):
    </span><span style="color: #0000ff;">return</span> x+<span style="color: #000000;">y

func </span>= partial(add,1<span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span>(func(1<span style="color: #000000;">))
</span><span style="color: #0000ff;">print</span>(func(2<span style="color: #000000;">))

</span><span style="color: #008000;">#</span><span style="color: #008000;"> from functools import partial</span><span style="color: #008000;">
#</span><span style="color: #008000;"> def add(x,y):</span><span style="color: #008000;">
#</span><span style="color: #008000;">     return x+y</span><span style="color: #008000;">
#</span><span style="color: #008000;"> # print(add(1,2))</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> func=partial(add,1) #偏函数</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(func(1))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(func(2))</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> recv_size = 0</span><span style="color: #008000;">
#</span><span style="color: #008000;"> recv_msg = b''</span><span style="color: #008000;">
#</span><span style="color: #008000;"> while recv_size &lt; length:</span><span style="color: #008000;">
#</span><span style="color: #008000;">     recv_msg += tcp_client.recv(buffer_size)</span><span style="color: #008000;">
#</span><span style="color: #008000;">     recv_size = len(recv_msg)  #1024</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> ''.join(iter(partial(tcp_client.recv,1024),b''))</span></pre>
</div>
<p>2.ntp_client和ntp_server</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> from socket import *</span><span style="color: #008000;">
#</span><span style="color: #008000;"> import time</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ip_port=('127.0.0.1',8080)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> buffer_size=1024</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> udp_server=socket(AF_INET,SOCK_DGRAM) #数据报</span><span style="color: #008000;">
#</span><span style="color: #008000;"> udp_server.bind(ip_port)</span>
<span style="color: #0000ff;">from</span> socket <span style="color: #0000ff;">import</span> *
<span style="color: #0000ff;">import</span><span style="color: #000000;"> time
ip_port </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8080<span style="color: #000000;">)
buffer_size </span>= 1024<span style="color: #000000;">

udp_server </span>=<span style="color: #000000;"> socket(AF_INET,SOCK_DGRAM)
udp_server.bind(ip_port)

</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
    data,addr </span>=<span style="color: #000000;">udp_server.recvfrom(buffer_size)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data)

    </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> data:
        fmt </span>= <span style="color: #800000;">'</span><span style="color: #800000;">%Y-%m-%d %X</span><span style="color: #800000;">'</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        fmt </span>= data.decode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    back_time </span>=<span style="color: #000000;"> time.strftime(fmt)

    udp_server.sendto(back_time.encode(</span><span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">),addr)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> while True:</span><span style="color: #008000;">
#</span><span style="color: #008000;">     data,addr=udp_server.recvfrom(buffer_size)</span><span style="color: #008000;">
#</span><span style="color: #008000;">     print(data)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">     if not data:</span><span style="color: #008000;">
#</span><span style="color: #008000;">         fmt='%Y-%m-%d %X'</span><span style="color: #008000;">
#</span><span style="color: #008000;">     else:</span><span style="color: #008000;">
#</span><span style="color: #008000;">         fmt=data.decode('utf-8')</span><span style="color: #008000;">
#</span><span style="color: #008000;">     back_time=time.strftime(fmt)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">     udp_server.sendto(back_time.encode('utf-8'),addr)</span></pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> from socket import *</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ip_port=('127.0.0.1',8080)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> buffer_size=1024</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> udp_client=socket(AF_INET,SOCK_DGRAM) #数据报</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> while True:</span><span style="color: #008000;">
#</span><span style="color: #008000;">     msg=input('&gt;&gt;: ').strip()</span><span style="color: #008000;">
#</span><span style="color: #008000;">     udp_client.sendto(msg.encode('utf-8'),ip_port)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">     data,addr=udp_client.recvfrom(buffer_size)</span><span style="color: #008000;">
#</span><span style="color: #008000;">     print('ntp服务器的标准时间是',data.decode('utf-8'))</span>

<span style="color: #0000ff;">from</span> socket <span style="color: #0000ff;">import</span>  *<span style="color: #000000;">
ip_port </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8080<span style="color: #000000;">)
buffer_size </span>= 1024<span style="color: #000000;">

udp_client </span>=<span style="color: #000000;"> socket(AF_INET,SOCK_DGRAM)
</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
    msg </span>= input(<span style="color: #800000;">'</span><span style="color: #800000;">&gt;&gt;: </span><span style="color: #800000;">'</span><span style="color: #000000;">).strip()
    udp_client.sendto(msg.encode(</span><span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">),ip_port)

    data,addr</span>=<span style="color: #000000;">udp_client.recvfrom(buffer_size)
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">ntp服务器的标准时间是</span><span style="color: #800000;">'</span>,data.decode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span>))</pre>
</div>
<p>3.time复习</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> import time</span>


<span style="color: #0000ff;">import</span><span style="color: #000000;">  time
</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(time.time())</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.localtime(time.time()))</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> print(time.gmtime(time.time()+28800))</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> print(time.mktime(time.localtime()))</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> print(time.strftime('%Y-%m-%d %X',time.localtime()))</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> print(time.strftime('%F %X',time.localtime()))</span>

<span style="color: #0000ff;">print</span><span style="color: #000000;">(time.ctime())
</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(time.time()) #用于计算</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.localtime(time.time()))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.gmtime(time.time()+28800))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.mktime(time.localtime())) #格式化--&gt;时间戳</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.strftime('%Y-%m-%d %X',time.localtime())) #格式化--》字符串时间</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.strftime('%F %X',time.localtime()))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.strptime('2017-01-03 09:37:06','%Y-%m-%d %X')) #字符串--》格式化</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print(time.ctime())</span></pre>
</div>
<p>4.udp的客户端与服务端通信</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">from</span> socket <span style="color: #0000ff;">import</span> *<span style="color: #000000;">
ip_port</span>=(<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8081<span style="color: #000000;">)
buffer_size</span>=1024<span style="color: #000000;">

udp_client</span>=socket(AF_INET,SOCK_DGRAM) <span style="color: #008000;">#</span><span style="color: #008000;">数据报</span>

<span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
    msg</span>=input(<span style="color: #800000;">'</span><span style="color: #800000;">&gt;&gt;: </span><span style="color: #800000;">'</span><span style="color: #000000;">).strip()
    udp_client.sendto(msg.encode(</span><span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">),ip_port)

    data,addr</span>=<span style="color: #000000;">udp_client.recvfrom(buffer_size)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> print(data.decode('utf-8'))</span>
    <span style="color: #0000ff;">print</span>(data)</pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> from socket import *</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ip_port=('127.0.0.1',8080)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> buffer_size=1024</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> udp_server=socket(AF_INET,SOCK_DGRAM) #数据报</span><span style="color: #008000;">
#</span><span style="color: #008000;"> udp_server.bind(ip_port)</span><span style="color: #008000;">
#
</span>
<span style="color: #0000ff;">from</span>  socket <span style="color: #0000ff;">import</span>  *<span style="color: #000000;">
ip_port </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8081<span style="color: #000000;">)
buffer_size </span>= 1024<span style="color: #000000;">
udp_server </span>=<span style="color: #000000;"> socket(AF_INET,SOCK_DGRAM)
udp_server.bind(ip_port)
</span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
    data,addr </span>=<span style="color: #000000;"> udp_server.recvfrom(buffer_size)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data)

    udp_server.sendto(data.upper(),addr)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> while True:</span><span style="color: #008000;">
#</span><span style="color: #008000;">     data,addr=udp_server.recvfrom(buffer_size)</span><span style="color: #008000;">
#</span><span style="color: #008000;">     print(data)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">     udp_server.sendto(data.upper(),addr)</span></pre>
</div>
<p>5.解决粘包</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('35824656-cc86-43a0-ba4c-82c4c723c58c')"><img id="code_img_closed_35824656-cc86-43a0-ba4c-82c4c723c58c" class="code_img_closed" src="./images/day30-python之socket0.png" alt="" /><img id="code_img_opened_35824656-cc86-43a0-ba4c-82c4c723c58c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('35824656-cc86-43a0-ba4c-82c4c723c58c',event)" src="./images/day30-python之socket1.png" alt="" />
<div id="cnblogs_code_open_35824656-cc86-43a0-ba4c-82c4c723c58c" class="cnblogs_code_hide">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> from socket import *</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ip_port=('127.0.0.1',8080)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> back_log=5</span><span style="color: #008000;">
#</span><span style="color: #008000;"> buffer_size=1024</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> tcp_server=socket(AF_INET,SOCK_STREAM)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> tcp_server.bind(ip_port)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> tcp_server.listen(back_log)</span><span style="color: #008000;">
#
</span><span style="color: #0000ff;">from</span> socket <span style="color: #0000ff;">import</span>  *<span style="color: #000000;">
ip_port </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8082<span style="color: #000000;">)
back_log </span>= 5<span style="color: #000000;">
buffer_size </span>= 1024<span style="color: #000000;">
tcp_server </span>=<span style="color: #000000;"> socket(AF_INET,SOCK_STREAM)
tcp_server.bind(ip_port)
tcp_server.listen(back_log)

conn,addr </span>=<span style="color: #000000;"> tcp_server.accept()
data1 </span>= conn.recv(5<span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">第一次数据</span><span style="color: #800000;">'</span><span style="color: #000000;">,data1)
data2 </span>= conn.recv(5<span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">第二次数据</span><span style="color: #800000;">'</span><span style="color: #000000;">,data2)
data3 </span>= conn.recv(5<span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">第三次数据</span><span style="color: #800000;">'</span><span style="color: #000000;">,data3)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> conn,addr=tcp_server.accept()</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> data1=conn.recv(5)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print('第一次数据',data1)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> data2=conn.recv(5)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print('第2次数据',data2)</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> data3=conn.recv(5)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> print('第3次数据',data3)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> from socket import *</span><span style="color: #008000;">
#</span><span style="color: #008000;"> import time</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ip_port=('127.0.0.1',8080)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> back_log=5</span><span style="color: #008000;">
#</span><span style="color: #008000;"> buffer_size=1024</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> tcp_client=socket(AF_INET,SOCK_STREAM)</span><span style="color: #008000;">
#</span><span style="color: #008000;"> tcp_client.connect(ip_port)</span><span style="color: #008000;">
#
</span>
<span style="color: #0000ff;">from</span>  socket <span style="color: #0000ff;">import</span> *
<span style="color: #0000ff;">import</span><span style="color: #000000;"> time
ip_port </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1</span><span style="color: #800000;">'</span>,8082<span style="color: #000000;">)
back_log </span>= 5<span style="color: #000000;">
buffer_size </span>= 1024<span style="color: #000000;">

tcp_client </span>=<span style="color: #000000;"> socket(AF_INET,SOCK_STREAM)
tcp_client.connect(ip_port)
tcp_client.send(</span><span style="color: #800000;">'</span><span style="color: #800000;">hello</span><span style="color: #800000;">'</span>.encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">))
tcp_client.send(</span><span style="color: #800000;">'</span><span style="color: #800000;">world</span><span style="color: #800000;">'</span>.encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf=8</span><span style="color: #800000;">'</span><span style="color: #000000;">))
tcp_client.send(</span><span style="color: #800000;">'</span><span style="color: #800000;">egon</span><span style="color: #800000;">'</span>.encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span><span style="color: #000000;">))
</span><span style="color: #008000;">#</span><span style="color: #008000;"> tcp_client.send('hello'.encode('utf-8'))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> tcp_client.send('world'.encode('utf-8'))</span><span style="color: #008000;">
#</span><span style="color: #008000;"> tcp_client.send('egon'.encode('utf-8'))</span><span style="color: #008000;">
#
#
#</span><span style="color: #008000;"> # time.sleep(1000)</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>