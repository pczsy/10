<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修文件的读取' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>文件的读取</center></div><div class='banquan'>原文出处:本文由博客园博主薛定谔的python提供。<br/>
原文连接:https://www.cnblogs.com/gd-vera/p/11575243.html</div><br>
    <p>在做数据分析的过程中，经常会遇到文件的读取。我想很多人都在这个环节遇到过问题，所以就把自己掌握的一些文件读取方法记录下来，以及过程中遇到的一些状况和解决方法列出来，以便交流。</p>
<h2>open</h2>
<p>open()&nbsp;函数用于创建或打开指定文件，该函数的语法格式如下：</p>
<div class="cnblogs_code">
<pre><code>file = open(file_name [, mode[, buffering]])</pre>
</div>
<p><strong>参数说明：</strong></p>
<ul>
<li>file：表示要创建的文件对象。</li>
<li>file_name：要创建或打开文件的文件名称。</li>
<li>mode：可选参数，用于指定文件的打开模式。默认以只读（r）模式打开文件。</li>
<li>buffing：可选参数，用于指定对文件做读写操作时，是否使用缓冲区。如果 buffering 的值被设为 0，就不会有寄存。如果 buffering 的值取 1，访问文件时会寄存行。如果将 buffering 的值设为大于 1 的整数，表明了这就是的寄存区的缓冲大小。如果取负值，寄存区的缓冲大小则为系统默认。</li>
</ul>
<p>不同模式打开文件的完全列表：</p>
<table class="reference">
<tbody>
<tr><th>模式</th><th>描述</th></tr>
<tr>
<td>r</td>
<td>以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td>
</tr>
<tr>
<td>rb</td>
<td>以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。</td>
</tr>
<tr>
<td>r+</td>
<td>打开一个文件用于读写。文件指针将会放在文件的开头。</td>
</tr>
<tr>
<td>rb+</td>
<td>以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。</td>
</tr>
<tr>
<td>w</td>
<td>打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>w+</td>
<td>打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>wb+</td>
<td>以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>a</td>
<td>打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>
</tr>
<tr>
<td>a+</td>
<td>打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</td>
</tr>
<tr>
<td>ab+</td>
<td>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</td>
</tr>
</tbody>
</table>
<p><strong>基本用法如下：</strong></p>
<div class="cnblogs_code">
<pre><code>f = open(<span style="color: #800000;">'</span><span style="color: #800000;">filename</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">r</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(f.read())
f.close()  </span><span style="color: #008000;">#</span><span style="color: #008000;"> 释放文件</span></pre>
</div>
<p><strong>简易写法：</strong>with语句结束会自动关闭文件</p>
<div class="cnblogs_code">
<pre><code>with open(<span style="color: #800000;">'</span><span style="color: #800000;">filename</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">r</span><span style="color: #800000;">'</span><span style="color: #000000;">) as f:
    </span><span style="color: #0000ff;">print</span>(f.read())</pre>
</div>
<h3>file 对象方法</h3>
<ul>
<li>
<p><strong>file.read([size])</strong>：size 未指定则返回整个文件，如果文件大小 &gt;2 倍内存则有问题，f.read()读到文件尾时返回""(空字串)。</p>
</li>
<li>
<p><strong>file.readline()</strong>：返回一行。</p>
</li>
<li>
<p><strong>file.readlines([size])&nbsp;</strong>：返回包含size行的列表, size 未指定则返回全部行。</p>
</li>
<li>
<p><strong>for line in f: print(line)&nbsp;</strong>：通过迭代器访问。</p>
</li>
<li>
<p><strong>f.write("hello\n")</strong>：如果要写入字符串以外的数据,先将他转换为字符串。</p>
</li>
<li>
<p><strong>f.tell()</strong>：返回一个整数,表示当前文件指针的位置(就是到文件头的比特数)。</p>
</li>
<li>
<p><strong>f.seek(偏移量,[起始位置])</strong>：用来移动文件指针。</p>
<ul>
<li>偏移量: 单位为比特，可正可负</li>
<li>起始位置: 0 - 文件头, 默认值; 1 - 当前位置; 2 - 文件尾</li>
</ul>
</li>
<li>
<p><strong>f.close()</strong>&nbsp;关闭文件</p>
</li>
</ul>
<h3>文件的编码问题</h3>
<p>在读取文件的时候，容易出现编码问题，例如：</p>
<div class="cnblogs_code">
<pre><code>UnicodeDecodeError: 'utf-8' codec can't decode byte 0xb8 in position 0: invalid start byte</pre>
</div>
<p>这是因为open()函数在读取文件时默认使用utf-8编码，当文件编码不匹配时，就会报类似上面的编码错误。这时可以通过指定编码类型来解决，例如：</p>
<div class="cnblogs_code">
<pre><code>with open('filename', 'r', encoding='gbk'<span>) as file: 
    file.read()</span></pre>
</div>
<h3>大文件的读取技巧</h3>
<p>python读取文件一般情况是利用open()函数以及read()函数来完成，但这种方法适用于读取小文件，因为read()函数会将数据读入内存。当需读取文件大于内存的大小时，会造成MemoryError，也就是发生内存溢出。所以需要一定的技巧来实现大文件的读取。</p>
<p><strong>解决方法：</strong></p>
<p>（1）read(参数)：通过参数指定每次读取的大小长度，循环读取</p>
<div class="cnblogs_code">
<pre><code>with open(<span style="color: #800000;">'</span><span style="color: #800000;">filename</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">r</span><span style="color: #800000;">'</span><span style="color: #000000;">) as file:
    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
        block </span>= file.read(1024<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> block:
            </span><span style="color: #0000ff;">break</span></pre>
</div>
<p>（2）readline()：每次获取一行数据</p>
<div class="cnblogs_code">
<pre><code>with open(<span style="color: #800000;">'</span><span style="color: #800000;">filename</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">r</span><span style="color: #800000;">'</span><span style="color: #000000;">) as file:
    </span><span style="color: #0000ff;">for</span> line <span style="color: #0000ff;">in</span><span style="color: #000000;"> file.readline():
        </span><span style="color: #0000ff;">pass</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 对应操作</span></pre>
</div>
<p>（3）对可迭代对象file进行迭代，这样会自动的使用buffered IO以及内存管理</p>
<div class="cnblogs_code">
<pre><code>with open(<span style="color: #800000;">'</span><span style="color: #800000;">filename</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">r</span><span style="color: #800000;">'</span><span style="color: #000000;">) as file:
    </span><span style="color: #0000ff;">for</span> line <span style="color: #0000ff;">in</span><span style="color: #000000;"> file:
        </span><span style="color: #0000ff;">pass</span>    <span style="color: #008000;">#</span><span style="color: #008000;">   对应操作</span></pre>
</div>
<h2>json</h2>
<p>当我们读取的文件是Json格式的时候，利用json包可以方便的将数据转换为python的字典格式</p>
<p>Json模块提供了四个功能：dumps、dump、loads、load</p>
<ul class="ul-level-0">
<li>dumps把数据类型转换成字符串</li>
<li>dump把数据类型转换成字符串并存储在文件中</li>
<li>loads把字符串转换成数据类型</li>
<li>load把文件打开从字符串转换成数据类型</li>
</ul>
<p>示例，将一个字符串转换为字典：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> json
string </span>= <span style="color: #800000;">'</span><span style="color: #800000;">{"name":"张三", "age":24}</span><span style="color: #800000;">'</span><span style="color: #000000;">
dict1 </span>= json.loads(string)</pre>
</div>
<p>&nbsp;</p>
<style><!--
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #000000; background-color: #ffffff}
span.s1 {font-variant-ligatures: no-common-ligatures; color: #c33720}
span.s2 {font-variant-ligatures: no-common-ligatures}
--></style>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>