<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Python标准模块--logging' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Python标准模块--logging</center></div><div class='banquan'>原文出处:本文由博客园博主piecesof提供。<br/>
原文连接:https://www.cnblogs.com/deliaries/p/11454270.html</div><br>
    <h1><span style="font-family: Microsoft YaHei;"><span style="font-size: 18px;">原文：<a title="Python标准模块--logging" href="https://www.cnblogs.com/zhbzz2007/p/5943685.html" target="_blank">https://www.cnblogs.com/zhbzz2007/p/5943685.html</a></span></span></h1>
<h1 id="logging模块简介">1 logging模块简介</h1>
<p>logging模块是Python内置的标准模块，主要用于输出运行日志，可以设置输出日志的等级、日志保存路径、日志文件回滚等；相比print，具备如下优点：</p>
<ol>
<li>可以通过设置不同的日志等级，在release版本中只输出重要信息，而不必显示大量的调试信息；</li>
<li>print将所有信息都输出到标准输出中，严重影响开发者从标准输出中查看其它数据；logging则可以由开发者决定将信息输出到什么地方，以及怎么输出；</li>
</ol>
<h1 id="logging模块使用">2 logging模块使用</h1>
<h2 id="基本使用">2.1 基本使用</h2>
<p>配置logging基本的设置，然后在控制台输出日志，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
logging.basicConfig(level </span>= logging.INFO,format = <span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
logger </span>= logging.getLogger(<span style="color: #800080;">__name__</span><span style="color: #000000;">)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Start print log</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">Do something</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.warning(</span><span style="color: #800000;">"</span><span style="color: #800000;">Something maybe fail.</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Finish</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>运行时，控制台输出，</p>
<div class="cnblogs_code">
<pre><code><code><span class="hljs-selector-tag">2016-10-09 <span class="hljs-selector-tag">19<span class="hljs-selector-pseudo">:11<span class="hljs-selector-pseudo">:19,<span class="hljs-selector-tag">434 <span class="hljs-selector-tag">- <span class="hljs-selector-tag">__main__ <span class="hljs-selector-tag">- <span class="hljs-selector-tag">INFO <span class="hljs-selector-tag">- <span class="hljs-selector-tag">Start <span class="hljs-selector-tag">print <span class="hljs-selector-tag">log
<span class="hljs-selector-tag">2016-10-09 <span class="hljs-selector-tag">19<span class="hljs-selector-pseudo">:11<span class="hljs-selector-pseudo">:19,<span class="hljs-selector-tag">434 <span class="hljs-selector-tag">- <span class="hljs-selector-tag">__main__ <span class="hljs-selector-tag">- <span class="hljs-selector-tag">WARNING <span class="hljs-selector-tag">- <span class="hljs-selector-tag">Something <span class="hljs-selector-tag">maybe <span class="hljs-selector-tag">fail.
<span class="hljs-selector-tag">2016-10-09 <span class="hljs-selector-tag">19<span class="hljs-selector-pseudo">:11<span class="hljs-selector-pseudo">:19,<span class="hljs-selector-tag">434 <span class="hljs-selector-tag">- <span class="hljs-selector-tag">__main__ <span class="hljs-selector-tag">- <span class="hljs-selector-tag">INFO <span class="hljs-selector-tag">- <span class="hljs-selector-tag">Finish</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
</div>
<p>logging中可以选择很多消息级别，如debug、info、warning、error以及critical。通过赋予logger或者handler不同的级别，开发者就可以只输出错误信息到特定的记录文件，或者在调试时只记录调试信息。</p>
<p>例如，我们将logger的级别改为DEBUG，再观察一下输出结果，</p>
<div class="cnblogs_code">
<pre><code>logging.basicConfig(level = logging.DEBUG,format = <span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span>)</pre>
</div>
<p>控制台输出，可以发现，输出了debug的信息。</p>
<div class="cnblogs_code">
<pre><code>2016-10-09 19:12:08,289 - <span style="color: #800080;">__main__</span> - INFO - Start <span style="color: #0000ff;">print</span><span style="color: #000000;"> log
</span>2016-10-09 19:12:08,289 - <span style="color: #800080;">__main__</span> - DEBUG -<span style="color: #000000;"> Do something
</span>2016-10-09 19:12:08,289 - <span style="color: #800080;">__main__</span> - WARNING -<span style="color: #000000;"> Something maybe fail.
</span>2016-10-09 19:12:08,289 - <span style="color: #800080;">__main__</span> - INFO - Finish</pre>
</div>
<p>logging.basicConfig函数各参数：</p>
<p>filename：指定日志文件名；</p>
<p>filemode：和file函数意义相同，指定日志文件的打开模式，'w'或者'a'；</p>
<p>format：指定输出的格式和内容，format可以输出很多有用的信息，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">参数：作用

</span>%<span style="color: #000000;">(levelno)s：打印日志级别的数值
</span>%<span style="color: #000000;">(levelname)s：打印日志级别的名称
</span>%<span style="color: #000000;">(pathname)s：打印当前执行程序的路径，其实就是sys.argv[0]
</span>%<span style="color: #000000;">(filename)s：打印当前执行程序名
</span>%<span style="color: #000000;">(funcName)s：打印日志的当前函数
</span>%<span style="color: #000000;">(lineno)d：打印日志的当前行号
</span>%<span style="color: #000000;">(asctime)s：打印日志的时间
</span>%<span style="color: #000000;">(thread)d：打印线程ID
</span>%<span style="color: #000000;">(threadName)s：打印线程名称
</span>%<span style="color: #000000;">(process)d：打印进程ID
</span>%(message)s：打印日志信息</pre>
</div>
<p>datefmt：指定时间格式，同time.strftime()；</p>
<p>level：设置日志级别，默认为logging.WARNNING；</p>
<p>stream：指定将日志的输出流，可以指定输出到sys.stderr，sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略；</p>
<h2 id="将日志写入到文件">2.2 将日志写入到文件</h2>
<p><strong>2.2.1 将日志写入到文件</strong></p>
<p>设置logging，创建一个FileHandler，并对输出消息的格式进行设置，将其添加到logger，然后将日志写入到指定的文件中，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
logger </span>= logging.getLogger(<span style="color: #800080;">__name__</span><span style="color: #000000;">)
logger.setLevel(level </span>=<span style="color: #000000;"> logging.INFO)
handler </span>= logging.FileHandler(<span style="color: #800000;">"</span><span style="color: #800000;">log.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">)
handler.setLevel(logging.INFO)
formatter </span>= logging.Formatter(<span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
handler.setFormatter(formatter)
logger.addHandler(handler)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Start print log</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">Do something</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.warning(</span><span style="color: #800000;">"</span><span style="color: #800000;">Something maybe fail.</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Finish</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>log.txt中日志数据为，</p>
<div class="cnblogs_code">
<pre><code>2016-10-09 19:01:13,263 - <span style="color: #800080;">__main__</span> - INFO - Start <span style="color: #0000ff;">print</span><span style="color: #000000;"> log
</span>2016-10-09 19:01:13,263 - <span style="color: #800080;">__main__</span> - WARNING -<span style="color: #000000;"> Something maybe fail.
</span>2016-10-09 19:01:13,263 - <span style="color: #800080;">__main__</span> - INFO - Finish</pre>
</div>
<p><strong>2.2.2 将日志同时输出到屏幕和日志文件</strong></p>
<p>logger中添加StreamHandler，可以将日志输出到屏幕上，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
logger </span>= logging.getLogger(<span style="color: #800080;">__name__</span><span style="color: #000000;">)
logger.setLevel(level </span>=<span style="color: #000000;"> logging.INFO)
handler </span>= logging.FileHandler(<span style="color: #800000;">"</span><span style="color: #800000;">log.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">)
handler.setLevel(logging.INFO)
formatter </span>= logging.Formatter(<span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
handler.setFormatter(formatter)

console </span>=<span style="color: #000000;"> logging.StreamHandler()
console.setLevel(logging.INFO)

logger.addHandler(handler)
logger.addHandler(console)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Start print log</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">Do something</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.warning(</span><span style="color: #800000;">"</span><span style="color: #800000;">Something maybe fail.</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Finish</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>可以在log.txt文件和控制台中看到，</p>
<div class="cnblogs_code">
<pre><code>2016-10-09 19:20:46,553 - <span style="color: #800080;">__main__</span> - INFO - Start <span style="color: #0000ff;">print</span><span style="color: #000000;"> log
</span>2016-10-09 19:20:46,553 - <span style="color: #800080;">__main__</span> - WARNING -<span style="color: #000000;"> Something maybe fail.
</span>2016-10-09 19:20:46,553 - <span style="color: #800080;">__main__</span> - INFO - Finish</pre>
</div>
<p>可以发现，logging有一个日志处理的主对象，其他处理方式都是通过addHandler添加进去，logging中包含的handler主要有如下几种，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">handler名称：位置；作用

StreamHandler：logging.StreamHandler；日志输出到流，可以是sys.stderr，sys.stdout或者文件
FileHandler：logging.FileHandler；日志输出到文件
BaseRotatingHandler：logging.handlers.BaseRotatingHandler；基本的日志回滚方式
RotatingHandler：logging.handlers.RotatingHandler；日志回滚方式，支持日志文件最大数量和日志文件回滚
TimeRotatingHandler：logging.handlers.TimeRotatingHandler；日志回滚方式，在一定时间区域内回滚日志文件
SocketHandler：logging.handlers.SocketHandler；远程输出日志到TCP</span>/<span style="color: #000000;">IP sockets
DatagramHandler：logging.handlers.DatagramHandler；远程输出日志到UDP sockets
SMTPHandler：logging.handlers.SMTPHandler；远程输出日志到邮件地址
SysLogHandler：logging.handlers.SysLogHandler；日志输出到syslog
NTEventLogHandler：logging.handlers.NTEventLogHandler；远程输出日志到Windows NT</span>/2000/<span style="color: #000000;">XP的事件日志
MemoryHandler：logging.handlers.MemoryHandler；日志输出到内存中的指定buffer
HTTPHandler：logging.handlers.HTTPHandler；通过</span><span style="color: #800000;">"</span><span style="color: #800000;">GET</span><span style="color: #800000;">"</span>或者<span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span>远程输出到HTTP服务器</pre>
</div>
<p><strong>2.2.3 日志回滚</strong></p>
<p>使用RotatingFileHandler，可以实现日志回滚，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
</span><span style="color: #0000ff;">from</span> logging.handlers <span style="color: #0000ff;">import</span><span style="color: #000000;"> RotatingFileHandler
logger </span>= logging.getLogger(<span style="color: #800080;">__name__</span><span style="color: #000000;">)
logger.setLevel(level </span>=<span style="color: #000000;"> logging.INFO)
</span><span style="color: #008000;">#</span><span style="color: #008000;">定义一个RotatingFileHandler，最多备份3个日志文件，每个日志文件最大1K</span>
rHandler = RotatingFileHandler(<span style="color: #800000;">"</span><span style="color: #800000;">log.txt</span><span style="color: #800000;">"</span>,maxBytes = 1*1024,backupCount = 3<span style="color: #000000;">)
rHandler.setLevel(logging.INFO)
formatter </span>= logging.Formatter(<span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
rHandler.setFormatter(formatter)

console </span>=<span style="color: #000000;"> logging.StreamHandler()
console.setLevel(logging.INFO)
console.setFormatter(formatter)

logger.addHandler(rHandler)
logger.addHandler(console)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Start print log</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">Do something</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.warning(</span><span style="color: #800000;">"</span><span style="color: #800000;">Something maybe fail.</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Finish</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>可以在工程目录中看到，备份的日志文件，</p>
<div class="cnblogs_code">
<pre><code>2016/10/09  19:36               732<span style="color: #000000;"> log.txt
</span>2016/10/09  19:36               967 log.txt.1
2016/10/09  19:36               985 log.txt.2
2016/10/09  19:36               976 log.txt.3</pre>
</div>
<h2 id="设置消息的等级">2.3 设置消息的等级</h2>
<p>可以设置不同的日志等级，用于控制日志的输出，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">日志等级：使用范围

FATAL：致命错误
CRITICAL：特别糟糕的事情，如内存耗尽、磁盘空间为空，一般很少使用
ERROR：发生错误时，如IO操作失败或者连接问题
WARNING：发生很重要的事件，但是并不是错误时，如用户登录密码错误
INFO：处理请求或者状态变化等日常事务
DEBUG：调试过程中使用DEBUG等级，如算法中每个循环的中间状态</span></pre>
</div>
<h2 id="捕获traceback">2.4 捕获traceback</h2>
<p>Python中的traceback模块被用于跟踪异常返回信息，可以在logging中记录下traceback，</p>
<p>代码，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
logger </span>= logging.getLogger(<span style="color: #800080;">__name__</span><span style="color: #000000;">)
logger.setLevel(level </span>=<span style="color: #000000;"> logging.INFO)
handler </span>= logging.FileHandler(<span style="color: #800000;">"</span><span style="color: #800000;">log.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">)
handler.setLevel(logging.INFO)
formatter </span>= logging.Formatter(<span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
handler.setFormatter(formatter)

console </span>=<span style="color: #000000;"> logging.StreamHandler()
console.setLevel(logging.INFO)

logger.addHandler(handler)
logger.addHandler(console)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Start print log</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">Do something</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.warning(</span><span style="color: #800000;">"</span><span style="color: #800000;">Something maybe fail.</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">try</span><span style="color: #000000;">:
    open(</span><span style="color: #800000;">"</span><span style="color: #800000;">sklearn.txt</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">except</span><span style="color: #000000;"> (SystemExit,KeyboardInterrupt):
    </span><span style="color: #0000ff;">raise</span>
<span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception:
    logger.error(</span><span style="color: #800000;">"</span><span style="color: #800000;">Faild to open sklearn.txt from logger.error</span><span style="color: #800000;">"</span>,exc_info =<span style="color: #000000;"> True)

logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">Finish</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>控制台和日志文件log.txt中输出，</p>
<div class="cnblogs_code">
<pre><code>Start <span style="color: #0000ff;">print</span><span style="color: #000000;"> log
Something maybe fail.
Faild to open sklearn.txt </span><span style="color: #0000ff;">from</span><span style="color: #000000;"> logger.error
Traceback (most recent call last):
  File </span><span style="color: #800000;">"</span><span style="color: #800000;">G:\zhb7627\Code\Eclipse WorkSpace\PythonTest\test.py</span><span style="color: #800000;">"</span>, line 23, <span style="color: #0000ff;">in</span> &lt;module&gt;<span style="color: #000000;">
    open(</span><span style="color: #800000;">"</span><span style="color: #800000;">sklearn.txt</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
IOError: [Errno </span>2] No such file <span style="color: #0000ff;">or</span> directory: <span style="color: #800000;">'</span><span style="color: #800000;">sklearn.txt</span><span style="color: #800000;">'</span><span style="color: #000000;">
Finish</span></pre>
</div>
<p>也可以使用logger.exception(msg,_args)，它等价于logger.error(msg,exc_info = True,_args)，</p>
<p>将</p>
<div class="cnblogs_code">
<pre><code>logger.error(<span style="color: #800000;">"</span><span style="color: #800000;">Faild to open sklearn.txt from logger.error</span><span style="color: #800000;">"</span>,exc_info = True)</pre>
</div>
<p>替换为，</p>
<div class="cnblogs_code">
<pre><code>logger.exception(<span style="color: #800000;">"</span><span style="color: #800000;">Failed to open sklearn.txt from logger.exception</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>控制台和日志文件log.txt中输出，</p>
<div class="cnblogs_code">
<pre><code>Start <span style="color: #0000ff;">print</span><span style="color: #000000;"> log
Something maybe fail.
Failed to open sklearn.txt </span><span style="color: #0000ff;">from</span><span style="color: #000000;"> logger.exception
Traceback (most recent call last):
  File </span><span style="color: #800000;">"</span><span style="color: #800000;">G:\zhb7627\Code\Eclipse WorkSpace\PythonTest\test.py</span><span style="color: #800000;">"</span>, line 23, <span style="color: #0000ff;">in</span> &lt;module&gt;<span style="color: #000000;">
    open(</span><span style="color: #800000;">"</span><span style="color: #800000;">sklearn.txt</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
IOError: [Errno </span>2] No such file <span style="color: #0000ff;">or</span> directory: <span style="color: #800000;">'</span><span style="color: #800000;">sklearn.txt</span><span style="color: #800000;">'</span><span style="color: #000000;">
Finish</span></pre>
</div>
<h2 id="多模块使用logging">2.5 多模块使用logging</h2>
<p>主模块mainModule.py，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> subModule
logger </span>= logging.getLogger(<span style="color: #800000;">"</span><span style="color: #800000;">mainModule</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.setLevel(level </span>=<span style="color: #000000;"> logging.INFO)
handler </span>= logging.FileHandler(<span style="color: #800000;">"</span><span style="color: #800000;">log.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">)
handler.setLevel(logging.INFO)
formatter </span>= logging.Formatter(<span style="color: #800000;">'</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">'</span><span style="color: #000000;">)
handler.setFormatter(formatter)

console </span>=<span style="color: #000000;"> logging.StreamHandler()
console.setLevel(logging.INFO)
console.setFormatter(formatter)

logger.addHandler(handler)
logger.addHandler(console)


logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">creating an instance of subModule.subModuleClass</span><span style="color: #800000;">"</span><span style="color: #000000;">)
a </span>=<span style="color: #000000;"> subModule.SubModuleClass()
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">calling subModule.subModuleClass.doSomething</span><span style="color: #800000;">"</span><span style="color: #000000;">)
a.doSomething()
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">done with  subModule.subModuleClass.doSomething</span><span style="color: #800000;">"</span><span style="color: #000000;">)
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">calling subModule.some_function</span><span style="color: #800000;">"</span><span style="color: #000000;">)
subModule.som_function()
logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">done with subModule.some_function</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>子模块subModule.py，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging

module_logger </span>= logging.getLogger(<span style="color: #800000;">"</span><span style="color: #800000;">mainModule.sub</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> SubModuleClass(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.logger </span>= logging.getLogger(<span style="color: #800000;">"</span><span style="color: #800000;">mainModule.sub.module</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        self.logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">creating an instance in SubModuleClass</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> doSomething(self):
        self.logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">do something in SubModule</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        a </span>=<span style="color: #000000;"> []
        a.append(</span>1<span style="color: #000000;">)
        self.logger.debug(</span><span style="color: #800000;">"</span><span style="color: #800000;">list a = </span><span style="color: #800000;">"</span> +<span style="color: #000000;"> str(a))
        self.logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">finish something in SubModuleClass</span><span style="color: #800000;">"</span><span style="color: #000000;">)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> som_function():
    module_logger.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">call function some_function</span><span style="color: #800000;">"</span>)</pre>
</div>
<p>执行之后，在控制和日志文件log.txt中输出，</p>
<div class="cnblogs_code">
<pre><code>2016-10-09 20:25:42,276 - mainModule - INFO -<span style="color: #000000;"> creating an instance of subModule.subModuleClass
</span>2016-10-09 20:25:42,279 - mainModule.sub.module - INFO - creating an instance <span style="color: #0000ff;">in</span><span style="color: #000000;"> SubModuleClass
</span>2016-10-09 20:25:42,279 - mainModule - INFO -<span style="color: #000000;"> calling subModule.subModuleClass.doSomething
</span>2016-10-09 20:25:42,279 - mainModule.sub.module - INFO - do something <span style="color: #0000ff;">in</span><span style="color: #000000;"> SubModule
</span>2016-10-09 20:25:42,279 - mainModule.sub.module - INFO - finish something <span style="color: #0000ff;">in</span><span style="color: #000000;"> SubModuleClass
</span>2016-10-09 20:25:42,279 - mainModule - INFO -<span style="color: #000000;"> done with  subModule.subModuleClass.doSomething
</span>2016-10-09 20:25:42,279 - mainModule - INFO -<span style="color: #000000;"> calling subModule.some_function
</span>2016-10-09 20:25:42,279 - mainModule.sub - INFO -<span style="color: #000000;"> call function some_function
</span>2016-10-09 20:25:42,279 - mainModule - INFO - done with subModule.some_function</pre>
</div>
<p>首先在主模块定义了logger'mainModule'，并对它进行了配置，就可以在解释器进程里面的其他地方通过getLogger('mainModule')得到的对象都是一样的，不需要重新配置，可以直接使用。定义的该logger的子logger，都可以共享父logger的定义和配置，所谓的父子logger是通过命名来识别，任意以'mainModule'开头的logger都是它的子logger，例如'mainModule.sub'。</p>
<p>实际开发一个application，首先可以通过logging配置文件编写好这个application所对应的配置，可以生成一个根logger，如'PythonAPP'，然后在主函数中通过fileConfig加载logging配置，接着在application的其他地方、不同的模块中，可以使用根logger的子logger，如'PythonAPP.Core'，'PythonAPP.Web'来进行log，而不需要反复的定义和配置各个模块的logger。</p>
<h1 id="通过json或者yaml文件配置logging模块">3 通过JSON或者YAML文件配置logging模块</h1>
<p>尽管可以在Python代码中配置logging，但是这样并不够灵活，最好的方法是使用一个配置文件来配置。在Python 2.7及以后的版本中，可以从字典中加载logging配置，也就意味着可以通过JSON或者YAML文件加载日志的配置。</p>
<h2 id="通过json文件配置">3.1 通过JSON文件配置</h2>
<p>JSON配置文件，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
    </span><span style="color: #800000;">"</span><span style="color: #800000;">version</span><span style="color: #800000;">"</span>:1<span style="color: #000000;">,
    </span><span style="color: #800000;">"</span><span style="color: #800000;">disable_existing_loggers</span><span style="color: #800000;">"</span><span style="color: #000000;">:false,
    </span><span style="color: #800000;">"</span><span style="color: #800000;">formatters</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
        </span><span style="color: #800000;">"</span><span style="color: #800000;">simple</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">"</span><span style="color: #800000;">format</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">"</span><span style="color: #000000;">
        }
    },
    </span><span style="color: #800000;">"</span><span style="color: #800000;">handlers</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
        </span><span style="color: #800000;">"</span><span style="color: #800000;">console</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">"</span><span style="color: #800000;">class</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">logging.StreamHandler</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">level</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">DEBUG</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">formatter</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">simple</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">stream</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">ext://sys.stdout</span><span style="color: #800000;">"</span><span style="color: #000000;">
        },
        </span><span style="color: #800000;">"</span><span style="color: #800000;">info_file_handler</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">"</span><span style="color: #800000;">class</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">logging.handlers.RotatingFileHandler</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">level</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">INFO</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">formatter</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">simple</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">filename</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">info.log</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">maxBytes</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">10485760</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">backupCount</span><span style="color: #800000;">"</span>:20<span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">encoding</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">
        },
        </span><span style="color: #800000;">"</span><span style="color: #800000;">error_file_handler</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">"</span><span style="color: #800000;">class</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">logging.handlers.RotatingFileHandler</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">level</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">ERROR</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">formatter</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">simple</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">filename</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">errors.log</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">maxBytes</span><span style="color: #800000;">"</span>:10485760<span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">backupCount</span><span style="color: #800000;">"</span>:20<span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">encoding</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">
        }
    },
    </span><span style="color: #800000;">"</span><span style="color: #800000;">loggers</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
        </span><span style="color: #800000;">"</span><span style="color: #800000;">my_module</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">"</span><span style="color: #800000;">level</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">ERROR</span><span style="color: #800000;">"</span><span style="color: #000000;">,
            </span><span style="color: #800000;">"</span><span style="color: #800000;">handlers</span><span style="color: #800000;">"</span>:[<span style="color: #800000;">"</span><span style="color: #800000;">info_file_handler</span><span style="color: #800000;">"</span><span style="color: #000000;">],
            </span><span style="color: #800000;">"</span><span style="color: #800000;">propagate</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">no</span><span style="color: #800000;">"</span><span style="color: #000000;">
        }
    },
    </span><span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
        </span><span style="color: #800000;">"</span><span style="color: #800000;">level</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">INFO</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">handlers</span><span style="color: #800000;">"</span>:[<span style="color: #800000;">"</span><span style="color: #800000;">console</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">info_file_handler</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">error_file_handler</span><span style="color: #800000;">"</span><span style="color: #000000;">]
    }
}</span></pre>
</div>
<p>通过JSON加载配置文件，然后通过logging.dictConfig配置logging，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> json
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging.config
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> os

</span><span style="color: #0000ff;">def</span> setup_logging(default_path = <span style="color: #800000;">"</span><span style="color: #800000;">logging.json</span><span style="color: #800000;">"</span>,default_level = logging.INFO,env_key = <span style="color: #800000;">"</span><span style="color: #800000;">LOG_CFG</span><span style="color: #800000;">"</span><span style="color: #000000;">):
    path </span>=<span style="color: #000000;"> default_path
    value </span>=<span style="color: #000000;"> os.getenv(env_key,None)
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> value:
        path </span>=<span style="color: #000000;"> value
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> os.path.exists(path):
        with open(path,</span><span style="color: #800000;">"</span><span style="color: #800000;">r</span><span style="color: #800000;">"</span><span style="color: #000000;">) as f:
            config </span>=<span style="color: #000000;"> json.load(f)
            logging.config.dictConfig(config)
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        logging.basicConfig(level </span>=<span style="color: #000000;"> default_level)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">start func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">exec func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">end func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">"</span><span style="color: #800000;">__main__</span><span style="color: #800000;">"</span><span style="color: #000000;">:
    setup_logging(default_path </span>= <span style="color: #800000;">"</span><span style="color: #800000;">logging.json</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    func()</span></pre>
</div>
<h2 id="通过yaml文件配置">3.2 通过YAML文件配置</h2>
<p>通过YAML文件进行配置，比JSON看起来更加简介明了，</p>
<div class="cnblogs_code">
<pre><code>version: 1<span style="color: #000000;">
disable_existing_loggers: False
formatters:
        simple:
            format: </span><span style="color: #800000;">"</span><span style="color: #800000;">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span style="color: #800000;">"</span><span style="color: #000000;">
handlers:
    console:
            </span><span style="color: #0000ff;">class</span><span style="color: #000000;">: logging.StreamHandler
            level: DEBUG
            formatter: simple
            stream: ext:</span>//<span style="color: #000000;">sys.stdout
    info_file_handler:
            </span><span style="color: #0000ff;">class</span><span style="color: #000000;">: logging.handlers.RotatingFileHandler
            level: INFO
            formatter: simple
            filename: info.log
            maxBytes: </span>10485760<span style="color: #000000;">
            backupCount: </span>20<span style="color: #000000;">
            encoding: utf8
    error_file_handler:
            </span><span style="color: #0000ff;">class</span><span style="color: #000000;">: logging.handlers.RotatingFileHandler
            level: ERROR
            formatter: simple
            filename: errors.log
            maxBytes: </span>10485760<span style="color: #000000;">
            backupCount: </span>20<span style="color: #000000;">
            encoding: utf8
loggers:
    my_module:
            level: ERROR
            handlers: [info_file_handler]
            propagate: no
root:
    level: INFO
    handlers: [console,info_file_handler,error_file_handler]</span></pre>
</div>
<p>通过YAML加载配置文件，然后通过logging.dictConfig配置logging，</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> yaml
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> logging.config
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> os

</span><span style="color: #0000ff;">def</span> setup_logging(default_path = <span style="color: #800000;">"</span><span style="color: #800000;">logging.yaml</span><span style="color: #800000;">"</span>,default_level = logging.INFO,env_key = <span style="color: #800000;">"</span><span style="color: #800000;">LOG_CFG</span><span style="color: #800000;">"</span><span style="color: #000000;">):
    path </span>=<span style="color: #000000;"> default_path
    value </span>=<span style="color: #000000;"> os.getenv(env_key,None)
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> value:
        path </span>=<span style="color: #000000;"> value
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> os.path.exists(path):
        with open(path,</span><span style="color: #800000;">"</span><span style="color: #800000;">r</span><span style="color: #800000;">"</span><span style="color: #000000;">) as f:
            config </span>=<span style="color: #000000;"> yaml.load(f)
            logging.config.dictConfig(config)
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        logging.basicConfig(level </span>=<span style="color: #000000;"> default_level)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">start func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">exec func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

    logging.info(</span><span style="color: #800000;">"</span><span style="color: #800000;">end func</span><span style="color: #800000;">"</span><span style="color: #000000;">)

</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">"</span><span style="color: #800000;">__main__</span><span style="color: #800000;">"</span><span style="color: #000000;">:
    setup_logging(default_path </span>= <span style="color: #800000;">"</span><span style="color: #800000;">logging.yaml</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    func()</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>